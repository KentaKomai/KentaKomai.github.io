
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>KentaKomai's BLOG</title>
  <meta name="author" content="Kenta Komai">

  
  <meta name="description" content="前回に引き続き、AnguarJSに関しての自習 前回・前々回で、基本的なmoduleAPIとdirectiveに関してある程度調べたので、 次は実際にプロジェクトで記述されているレベルのものを、読みといていこうと思います。 本当はserviceに関して($http, $rocate, $ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://KentaKomai.github.io/blog/page/3">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="KentaKomai's BLOG" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46297904-1', 'tamago-mago-mago.com');
  ga('send', 'pageview');

  </script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46297904-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner">
	<div class="header-title"><a href="/">KentaKomai's BLOG</a></div>


	<br><div class="header-subtitle">自分用備忘録の延長</div>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss email">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
    <li><a href="kaede06152000@gmail.com" rel="subscribe-email" title="subscribe via email">Email</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:KentaKomai.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/07/29/wordpress58/">[AugularJS]todomvcのソースコードで基本的な使い方を確認・復習(夏休み企画3)</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-07-29T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前回に引き続き、AnguarJSに関しての自習</p>

<p>前回・前々回で、基本的なmoduleAPIとdirectiveに関してある程度調べたので、 次は実際にプロジェクトで記述されているレベルのものを、読みといていこうと思います。</p>

<p>本当はserviceに関して($http, $rocate, $routeProviderなど)に関して書こうと 思ってたんですが、ググってたらとてもいいサンプルがあったので、読んでみました。</p>

<p>公式で紹介されている、シンプルなtodoアプリを自分で機能追加したものも書いてみたんですが、 それは機会があれば。</p>

<p><a href="https://github.com/tastejs/todomvc/tree/gh-pages/architecture-examples/angularjs">tastejs/todomvc -github-</a></p>

<p>様々なフレームワークを利用してTODOアプリを書いてみたものが、豊富に公開されています。 backborn.jsとかknockout.js、jqueryまでありますので、比較すると面白いかもしれません。</p>

<p>実際に動いている状態のものは<a href="http://todomvc.com/architecture-examples/angularjs/#/">こちら</a></p>

<p>今回は無論AngularJSのサンプルを見ていきます。</p>

<h3>まずはindex.htmlで呼び出されているjsファイルを確認</h3>

<pre></pre>


<p>こんな感じ。</p>

<p>公式で推奨されているように、それぞれファイルを分割していますね。</p>

<p>app.jsでmouduleをグローバルで定義して、各ファイルでそのmoduleを拡張しています。</p>

<p>外部moduleなどを使っていない点、チュートリアルとして、とても良いと思います。</p>

<h3>AngularJS関連のファイルの構成を確認</h3>

<h4>●app.js</h4>

<pre>var todomvc = angular.module('todomvc', []);
</pre>


<p>todomvcというmoduleを定義するだけのファイル。</p>

<h4>●jsディレクトリ内のサブディレクトリ</h4>

<pre>todomvc.directive('todoFocus', function ($timeout) {
    return function (scope, elem, attrs) {
        scope.$watch(attrs.todoFocus, function (newVal) {
            if (newVal) {
                $timeout(function () {
                    elem[0].focus();
                }, 0, false);
            }
        });
    };
});
</pre>


<p>複数ファイルがあるうちの１つを取り上げますが、内容はだいたい同じ。</p>

<p>&#8216;todoFocus&#8217;というattributreを定義しています。todoFocusというプロパティの変化に応じて、 処理を行うdirectiveのようです。 詳細は後ほど。今はザックリと構成を追っていきます。</p>

<p>todomvcというapp.jsで定義されたmoduleを他のファイルで拡張している点に注目です。</p>

<p>この辺は使われているプロジェクトによって、結構違いがあるんですが、こういう拡張もいいですね。 こういう形式にしたほうが、directive専用のmoduleを定義して、 app.jsでインポートするより、変更は少ないし、拡張はしやすいかもしれません。</p>

<p>その代わり、他のプロジェクトに、このmoduleの一部を持ち出したいときは、ソースの変更が必要になりますが。</p>

<h3>index.htmlを確認して、処理を追いかける。</h3>

<h4>bodyタグすぐ下のsectionタグでコントローラーを指定</h4>

<pre>&lt;section id="todoapp" ng-controller="TodoCtrl">
</pre>


<p>このページのほとんど全体を含んでいるタグです。 このページでは&#8217;TodoCtrl&#8217;というコントローラー１つで全ての処理を行うようです。</p>

<h4>id=&#8221;header&#8221;の箇所</h4>

<pre>&lt;header id="header">
    <h1>
  todos
</h1>
    
&lt;/header>
</pre>


<p>簡単ですね。TodoCtrlの$scope.newTodoに、input#new-todoが対応しています。formのsubmitが行われると TodoCtrlの$scope.addTodo()が実行される、という流れ。</p>

<p>それでは$scope.addTodo()の中身を確認。</p>

<pre>$scope.addTodo = function () {
    var newTodo = $scope.newTodo.trim();
    if (!newTodo.length) {
        return;
    }

    todos.push({
        title: newTodo,
        completed: false
    });

    $scope.newTodo = '';
};
</pre>


<p>これも簡単ですね。$scope.newTodo（つまり、input#new-todoのvalue）から 空白文字と終端文字を削除(trim()関数)して、newTodo変数に格納。</p>

<p>それから、newTodoの入力チェックして(!newTodo.length)ちゃんと入力があれば todo一覧にnewTodoの中身をpush(todos.push)して、あとは$scope.newTodoの中身をリセット($scope.newTodo = &#8221;;)</p>

<p>いたってシンプルです。</p>

<h4>section#mainの箇所</h4>

<pre>&lt;section id="main" ng-show="todos.length" ng-cloak>
</pre>


<p>ng-show=&#8221;todos.length&#8221;は、todosの要素数が1以上なら、このElement内を表示、って感じです。</p>

<p>ここから順番に見ていきます。</p>

<pre><input id="toggle-all" type="checkbox" ng-model="allChecked" ng-click="markAll(allChecked)" />
<label for="toggle-all">Mark all as complete</label>
</pre>


<p>またinputタグ。チェックボックスですね。$scope.allCheckedに対応。クリックすることで、$scope.markAll(allChecked)が 実行されます。</p>

<p>大体予想がつきますが、一応、$scope.markAll()の処理を確認してみます。</p>

<pre>$scope.markAll = function (completed) {
    todos.forEach(function (todo) {
        todo.completed = completed;
    });
};
</pre>


<p>$scope.totodsをforEachで回して、それぞれの要素をtodoとして、その中のcompletedを チェックボックス(引数にあるcompletedで、 つまりinput#toggle-all)にチェックがあれば、true、なければfalseを設定しています。</p>

<p>これによって、全ての要素に対して一度にチェックしたり、外したりしていますね。</p>

<p>angular.forEach(objects, function(){&#8230;})の形式は多用されるので覚えておくと便利です。</p>

<p>※個人的には、引数の名前がcompletedというのはミスなのかな・・・と思ってます。 生意気ですが、isAllCheckedとかのほうがいいんじゃないかな・・・。と個人的には思います・・・。</p>

<p>更に進んでいきます。</p>

<pre><ul id="todo-list">
  <li ng-repeat="todo in todos | filter:statusFilter" ng-class="{completed: todo.completed, editing: todo == editedTodo}">
    <div class="view">
      <input class="toggle" type="checkbox" ng-model="todo.completed" />
                  <label ng-dblclick="editTodo(todo)"></label>
                  <button class="destroy" ng-click="removeTodo(todo)"></button>
              
    </div>
            
        
  </li>
  
</ul>
</pre>


<p>このアプリ最大のキモである、todo一覧を表示する箇所です。(view)</p>

<p>上から順番に</p>

<pre><li ng-repeat="todo in todos | filter:statusFilter" ng-class="{completed: todo.completed, editing: todo == editedTodo}">
  </pre>


<p>  <p></p>

<pre><code>$scope.todosの要素数だけ繰り返します。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>ポイントは、filter:statusFilterの部分。
</code></pre>

<p>  </p></p>

<p>  <pre>
$scope.$watch(&lsquo;location.path()&rsquo;, function (path) {</p>

<pre><code>$scope.statusFilter = (path === '/active') ?
    { completed: false } : (path === '/completed') ?
    { completed: true } : null;
</code></pre>

<p>});
</pre></p>

<p>  <p></p>

<pre><code>ここで、何をしているか、というとlocation.path()を監視して、変化があれば$scope.statusFilterを常に切り替えてます。
具体的に言うと
</code></pre>

<p>  </p></p>

<p>  <ul></p>

<pre><code>&lt;li&gt;
  URL が****/activeならcompleted:false
&lt;/li&gt;

&lt;li&gt;
  URL が****/completedならcompleted:true
&lt;/li&gt;

&lt;li&gt;
  それ以外は全てnull
&lt;/li&gt;
</code></pre>

<p>  </ul></p>

<p>  <p></p>

<pre><code>を設定しています。これによって、URLによって
</code></pre>

<p>  </p></p>

<p>  <ul></p>

<pre><code>&lt;li&gt;
  終了していないtodoの一覧を表示する
&lt;/li&gt;

&lt;li&gt;
  終了したtodoの一覧を表示する
&lt;/li&gt;

&lt;li&gt;
  全て表示する
&lt;/li&gt;
</code></pre>

<p>  </ul></p>

<p>  <p></p>

<pre><code>を切り替えています。かしこいー。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>URLの切り替えは
</code></pre>

<p>  </p></p>

<p>  <pre>
&lt;footer id=&ldquo;footer&rdquo; ng-show=&ldquo;todos.length&rdquo; ng-cloak></p>

<pre><code>&lt;span id="todo-count"&gt;&lt;strong&gt;&lt;/strong&gt;
    &amp;lt;ng-pluralize count="remainingCount" when="{ one: 'item left', other: 'items left' }"&gt;&amp;lt;/ng-pluralize&gt;
&lt;/span&gt;
&lt;ul id="filters"&gt;
</code></pre>

<p>  <li></p>

<pre><code>&lt;a ng-class="{selected: location.path() == '/'} " href="#/"&gt;All&lt;/a&gt;
</code></pre>

<p>  </li></p>

<p>  <li></p>

<pre><code>&lt;a ng-class="{selected: location.path() == '/active'}" href="#/active"&gt;Active&lt;/a&gt;
</code></pre>

<p>  </li></p>

<p>  <li></p>

<pre><code>&lt;a ng-class="{selected: location.path() == '/completed'}" href="#/completed"&gt;Completed&lt;/a&gt;
</code></pre>

<p>  </li></p>

<p></ul></p>

<p><button id="clear-completed" ng-click="clearCompletedTodos()" ng-show="completedCount">Clear completed ()</button>
&lt;/footer>
</pre></p>

<p>  <p></p>

<pre><code>この部分のaタグで切り替えてますね。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>つぎは、いよいよtodoそのものが表示されている部分
</code></pre>

<p>  </p></p>

<p>  <pre></p>

<div class="view">
  <input class="toggle" type="checkbox" ng-model="todo.completed" />
      <label ng-dblclick="editTodo(todo)"></label>
      <button class="destroy" ng-click="removeTodo(todo)"></button>
  
</div>


<p></pre></p>

<p>  <p></p>

<pre><code>上から順番に。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>最初はチェックボックス、モデルは$scope.todo.completedです。このチェックボックスを切り替えることに
よって、対象のtodoが完了か、そうでないかを判断・切替ができるようになってます。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>つぎはtodoの内容()です。ダブルクリックすると(ng-dblclick)すると$scope.editTodo(todo)
が動作するようになっていますね。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>$scope.editTodo()を見てみます。
</code></pre>

<p>  </p></p>

<p>  <pre>
$scope.editTodo = function (todo) {</p>

<pre><code>$scope.editedTodo = todo;
// Clone the original todo to restore it on demand.
$scope.originalTodo = angular.extend({}, todo);
</code></pre>

<p>};
</pre></p>

<p>  <p></p>

<pre><code>ダブルクリックされた$scope.todoを引数に受け取り、$scope.editedTodoにコピーしてますね。
これ、ちょっと、いまは意味不明ですが、angular.extend({}, todo)で、これまた$scope.originalTodoに
todoオブジェクトをコピーしています。これの違いは後ほど。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>最後はボタン。クリックするとremoveTodo(todo)が実行されます。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>処理内容は以下
</code></pre>

<p>  </p></p>

<p>  <pre>
$scope.removeTodo = function (todo) {</p>

<pre><code>todos.splice(todos.indexOf(todo), 1);
</code></pre>

<p>};
</pre></p>

<p>  <p></p>

<pre><code>これはそのまんま。todosのなかからtodoと同じものを探して、そこから１つを削除。
つまり、todosのなかのtodoのみを削除。それだけです。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>そして最後。
</code></pre>

<p>  </p></p>

<p>  <pre></p>

<p></pre></p>

<p>  <p></p>

<pre><code>ここに今回、説明がめんどくさい部分が全て集結していると言っても
過言ではない。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>まずは見慣れない、attirbuteが３つ。todo-blurとtodo-escapeとtodo-focus。
それぞれに何かしらのイベントかなんかが、設定されています。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>これは最初のほうに説明した、独自directiveです。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>これらが何をしているか、それぞれのファイルを見てみます。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>まずはtodo-escape.js
</code></pre>

<p>  </p></p>

<p>  <pre>
todomvc.directive(&lsquo;todoBlur&rsquo;, function () {</p>

<pre><code>var ESCAPE_KEY = 27;
return function (scope, elem, attrs) {
    elem.bind('keydown', function (event) {
        if (event.keyCode === ESCAPE_KEY) {
            scope.$apply(attrs.todoEscape);
        }
    });
};
</code></pre>

<p>});
</pre></p>

<p>  <p></p>

<pre><code>ごめんなさい、初見だと意味わかんない。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>要するに、keydownされたときのeventを監視してるんですが、押されたkeyがESCだったときに
scope.$apply(attrs.todoEscape);を実行する、感じですね。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>じゃぁ$applyとは何か。ものすごくざっくり言うと、引数に受け取った関数を実行する、的な感じ。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>面白いな、と思ったのが、todo-escapeもtodo-blurもtodoBlurとして定義されているんですね。
それで、ESCが押されたか、そうでないかで実行する処理を変えてます。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>上記のtodo-escape.jsでは&amp;#8217;todoBlur&amp;#8217;というattirbuteがついたDOMエレメントが、keydownでESCが押された場合は
そのDOMエレメントのtodoEscapeというattributeの内容が関数として実行されます。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>つまり、上記の場合だとrevertEditing(todo)という処理が実行される。うまくできてるなー・・・。
</code></pre>

<p>  </p></p>

<p>  <pre>
$scope.revertEditing = function (todo) {</p>

<pre><code>todos[todos.indexOf(todo)] = $scope.originalTodo;
$scope.doneEditing($scope.originalTodo);
</code></pre>

<p>};
</pre></p>

<p>  <p></p>

<pre><code>ここでの処理は、todos内のtodoと同じオブジェクトに、編集前のオブジェクトを挿入しています。
その後は$scope.doneEditing($scope.originalTodo)を実行。これは後ほど。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>うまく説明できてないと思いますが、ソースコード読んでもらえれば納得できると思います。
todo-escape.jsというファイルでありながら、todoEscapeというdirectiveが定義されているわけではないんですね。
あくまで、todoEscapeという属性に書かれた関数を取るため。イベントの監視自体はtodoBlurという属性で監視しています。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>次はtodo-blur.js
</code></pre>

<p>  </p></p>

<p>  <pre>
todomvc.directive(&lsquo;todoBlur&rsquo;, function () {</p>

<pre><code>return function (scope, elem, attrs) {
    elem.bind('blur', function () {
        scope.$apply(attrs.todoBlur);
    });
};
</code></pre>

<p>});
</pre></p>

<p>  <p></p>

<pre><code>これはシンプルですね。対象のDOMエレメントに対して、blurのイベントをbindして、
todoBlurに設定された関数を実行する、という感じです。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>この形式は、非常に汎用性が高いので、覚えておくと便利かもしれません。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>todoBlurに設定されているイベントはdoneEditing(todo)ですね。さきほどの$scope.revertEditing()
内でも呼び出されていました。
</code></pre>

<p>  </p></p>

<p>  <pre>
$scope.doneEditing = function (todo) {</p>

<pre><code>$scope.editedTodo = null;
todo.title = todo.title.trim();

if (!todo.title) {
    $scope.removeTodo(todo);
}
</code></pre>

<p>};
</pre></p>

<p>  <p></p>

<pre><code>こちらは$scope.editedTodo（編集中のtodo）をnullにして、todo.titleから空白文字、終端文字を削除。
最後に、todo.titleが空っぽなら、$scope.removeTodo(todo);を実行。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>最後にtodo-focus.js
</code></pre>

<p>  </p></p>

<p>  <pre>
todomvc.directive(&lsquo;todoFocus&rsquo;, function todoFocus($timeout) {</p>

<pre><code>return function (scope, elem, attrs) {
    scope.$watch(attrs.todoFocus, function (newVal) {
        if (newVal) {
            $timeout(function () {
                elem[0].focus();
            }, 0, false);
        }
    });
};
</code></pre>

<p>});
</pre></p>

<p>  <p></p>

<pre><code>これも、よく見かける形式です。todoFocusに設定された値（&amp;#8221;todo == editedTodo&amp;#8221;）を監視して、
この値がtrueなら
</code></pre>

<p>  </p></p>

<p>  <pre>
$timeout(function () {</p>

<pre><code>elem[0].focus();
</code></pre>

<p>}, 0, false);
</pre></p>

<p>  <p></p>

<pre><code>を実行します。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>これで、先ほど後回しにした
</code></pre>

<p>  </p></p>

<p>  <pre>
$scope.editTodo = function (todo) {</p>

<pre><code>$scope.editedTodo = todo;
// Clone the original todo to restore it on demand.
$scope.originalTodo = angular.extend({}, todo);
</code></pre>

<p>};
</pre></p>

<p>  <p></p>

<pre><code>の話が出てきます。
要素をダブルクリックすると$scope.editTodoに、クリックしたtodoが設定されます。(変更前のものも、$scope.originalTodoにコピーしておきます)
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>これが変更されると、todoFocusというattributeによって、&amp;#8221;todo == editedTodo&amp;#8221;が評価されます。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>editedTodoはtodoがコピーされているので、対象のDOMエレメントがfocus()されます。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>これによって、ユーザがテキストボックスに入力できるようになります。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>入力が終了して、blurされるか、ESCキーがkeydownされると、前述した、それぞれの処理へ。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>こんな感じです。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>これで全部。
</code></pre>

<p>  </p></p>

<p>  <h3></p>

<pre><code>今回説明しなかったところをざっくりと。
</code></pre>

<p>  </h3></p>

<p>  <ol></p>

<pre><code>&lt;li&gt;
  データは全てlocal strageに保存されている。
&lt;/li&gt;

&lt;li&gt;
  データの新規作成、詳細の取得、編集、削除はfactoryのgetとputで管理している
&lt;/li&gt;

&lt;li&gt;
  TodoCtrl内でtodos(todoの一覧)のデータを$watch(変更の監視)をすることによって、各種処理で変更があった場合は
  factoryを通してデータを処理している
&lt;/li&gt;
</code></pre>

<p>  </ol></p>

<p>  <p></p>

<pre><code>これでソースコードの全部を説明終わり。
上記３点によって、完全にHTML/CSS/javascriptのアプリケーションになってますね。
local strageを利用しているのでオフラインでも利用できます。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>絶対わかりづらいと思うけど、ごめんなさい。
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>このソースコードが実際に動作しているのは
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>&lt;a href="http://todomvc.com/architecture-examples/angularjs/#/"&gt;todos&lt;/a&gt;
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>にて、確認できます。ソースコードと並べて動作を見ると本当に勉強になります。
</code></pre>

<p>  </p></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/07/29/wordpress57/">『プログラマの考え方がおもしろいほど身につく本』読み終わりました。</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-07-29T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>読んだ本、全部レビューとして残したいなぁ、と思ったけど、さすがにしんどいですね。</p>

<p>それに最近ちゃんと読めてないです・・・。最後の夏休みを利用して、積み本消化したいなぁ。 いい本いっぱいあるのに読まないんじゃ意味ないですね・・・。</p>

<p>今日紹介するのはこちら。先日参加させていただいているCTFチーム、よかろうもんの勉強会でも 一部だけ紹介させていただきました。</p>

<p><a href="http://www.amazon.co.jp/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9E%E3%81%AE%E8%80%83%E3%81%88%E6%96%B9%E3%81%8C%E3%81%8A%E3%82%82%E3%81%97%E3%82%8D%E3%81%84%E3%81%BB%E3%81%A9%E8%BA%AB%E3%81%AB%E3%81%A4%E3%81%8F%E6%9C%AC-%E5%95%8F%E9%A1%8C%E8%A7%A3%E6%B1%BA%E8%83%BD%E5%8A%9B%E3%82%92%E9%8D%9B%E3%81%88%E3%82%88%E3%81%86-V-Anton-Spraul/dp/4048869558">プログラマの考え方がおもしろいほど身につく本</a></p>

<p>７月頭くらいから、通学の電車の中で読んでました。</p>

<p>このレビューは、あくまで僕の主観です。内容の正確さや、クオリティは保証できません。あくまで自分自身のための記録です。 気になる方は、自分で読んで理解していただければと思います。</p>

<p>構成は</p>

<ol>
<li>１章と２章で問題解決へのアプローチの基礎とヒント(戦略、パズル)</li>
<li>３〜６章で問題に対するプログラミングからのアプローチ(配列、ポインタ、クラス、再帰)</li>
<li>７章でよりよいコードの再利用</li>
<li>優秀なプログラマの考え方</li>
</ol>


<p>とおおまかになっています。</p>

<p>ちなみに、３〜６章に書かれているサンプルコードは全てC/C++で記述されています。 Cをやったことのない人でも、全編通して読むことはできますが、やったことあればスムーズだと思います。</p>

<p>ただ、僕個人としては、Cなどの言語を触った経験がなく、ポインタの概念が全くない人にこそ、役に立つのではないかな、と思いました。</p>

<p>ポインタ（参照）の概念については、詳しく解説がされており、更に有効な使い方なども一緒に紹介されています。 クラスにしても、リストにしても、スタック、キューなどのデータ構造も『ポインタってこうやって有効活用されて いるんだなぁ』と納得できると思います。（ポインタ（参照）をプログラマが触らないにしても、内部的には利用されているので 勉強になると思います。）</p>

<p>あと、本書は『プログラミングが出来るようになる』ことを目的としているのではなく 『プログラマーらしい問題解決へのアプローチのヒント』の紹介が目的（だと僕は思う）なので さらっと一回読むだけだと、あんまり何も残らないかもしれません。第一章にある</p>

<ul>
<li>常に計画を持て</li>
<li>問題を分割する</li>
<li>問題を簡略化する</li>
</ul>


<p>この３点が個人的には印象に残っています。</p>

<p>『XXXXのプログラムを書いてくれ』と言われたとき（または必要になったとき）に なんとなくキーワードを拾って調べなんとなく使えそうなライブラリを見つけて、 なんとなく動かしてみる、というフローを、ダラダラと、いつの間にか繰り返している時って結構あると思うのですが、 上記のフローで作業を進めると、見つけたライブラリでどうにか成らなかった時に、 しばらく手が止まっちゃうんですよね（僕の場合）</p>

<p>分割と簡略化に関しては、僕はよくペーパープロトタイピングを用いてます。 プログラミングに起こす前に、流れや、処理を紙に列挙してみてます。</p>

<p>その段階でゴールまで書けたら初めて処理を書きます。人によって向き不向きはあると思いますが、 僕はこれが習慣になってて、よかったなぁ、とよく思ってます。</p>

<p>計画・設計の大切さを再認識しました。</p>

<hr />

<p>あと取り上げたいのは、６章の再帰の活用に関してです。</p>

<p>ここで、再帰を用いるメリット・デメリット、そして手法がかなり解りやすく書かれています。</p>

<p>再帰って、ぱっとコード見ただけだと、処理を追いかけるのがしんどいし、 自分で書け、といわれると簡単な処理でも手が止まってしまうことばかりで、 再帰が大の苦手でした。</p>

<p>全てのパターンに当てはまるはずはないですが、再帰を使った処理を自分で実装するときの ヒントが大いに含まれています。再帰に苦手意識のある方はヒントになるかもしれません。</p>

<p>僕は、この本にあるポイントを注意して、コードを読む、書くをしていたら かなり理解が進みました。使いドコロは限られますが、ビビらずに使いたいなぁ、と思うようになりました。</p>

<p>おすすめです。</p>

<hr />

<p>8章の『プログラマの考え方』は、この本の一番根幹にあたる部分かもしれません。</p>

<p>優れたプログラマが、どのようにして問題解決に挑んでいるのか、学習を続けるべきなのか、なんていう部分があります。</p>

<p>このへんは、オライリーの『プログラマのためのサバイバルマニュアル』やオーム社の『アジャイルプラクティス』なんか で紹介されていたものと共通のものがありました。（より『計画的に』というキーワードにフォーカスしていますが。）</p>

<hr />

<p>各章には、『結論』と『演習問題』が章末に含まれていて、それらを全て網羅すると、本自体は薄いですが、結構な ボリュームになります。※ぼくも演習問題は、全部でなく、自分で好きなものを選んで実践しました。</p>

<p>プログラムをとりあえずできるようになったけど、もっともっと生産的に、効率的に、クールに書きたい、なんていう人のヒントになると思います。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/07/26/wordpress56/">[AugularJS]moduleAPIに関してまとめ(夏休み企画２)</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-07-26T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前回の記事の続き</p>

<p>前回はdirectiveの定義のためだけに、とりあえずmoduleを作成しましたが、 今回はmoduleを定義することで出来ること、つまりmoduleAPIに関して 調べてまとめて、可能ならサンプルを用意して再現してみたいと思います。</p>

<h3>公式リファレンスで紹介されているAPI群</h3>

<p>公式リファレンスを見たところ、そこまで量が多いわけでもなさそうなので moduleAPIで提供している全てのメソッドをザックリと訳していきます。</p>

<h4>●config(configFn) *</h4>

<blockquote><p>Use this method to register work which needs to be performed on module loading. Execute this function on module load. Useful for service configuration.</p></blockquote>

<p>モジュールがロードされたときに実行される処理を記述します。 通常、serviceの設定をするときに利用します。</p>

<h4>●constant(name, object)</h4>

<blockquote><p>Because the constant are fixed, they get applied before other provide methods. See $provide.constant().</p></blockquote>

<p>ここ、よくわからないんですが、多分 他の関数が提供される前に、objectが宣言できる、とかそんな感じ、だと思う。 他の関数で共通で利用したいobjectとかをここで宣言したらいい、のかな・・・。</p>

<h4>●controller(name, constructor) *</h4>

<p>コントローラーの定義を行います。</p>

<ul>
<li>第一引数：コントローラー名</li>
<li>第二引数：コントローラーの生成の関数</li>
</ul>


<h4>●directive(name, directiveFactory) *</h4>

<p>独自directiveの定義</p>

<ul>
<li>第一引数：directive名</li>
<li>第二引数：directiveのインスタンス生成の関数</li>
</ul>


<h4>●factory(name, providerFunction)</h4>

<p>独自のserviceの定義</p>

<ul>
<li>第一引数：service名</li>
<li>第二引数：servideで提供する処理</li>
</ul>


<p>※serviceと違い、インスタンスではなく結果が返される</p>

<h4>●filter(name, filterFactory)</h4>

<p>独自filterの定義</p>

<ul>
<li>第一引数：filter名</li>
<li>第二引数：filterのインスタンス生成の関数</li>
</ul>


<h4>●provider(name, providerType)</h4>

<p>独自のserviceの定義</p>

<ul>
<li>第一引数：service名</li>
<li>第二引数：servideで提供する処理</li>
</ul>


<p>※serviceと違い、インスタンスではなく$get()メソッドの結果が返される</p>

<h4>●run(initializationFn)</h4>

<blockquote><p>Use this method to register work which should be performed when the injector is done loading all modules. Execute this function after injector creation. Useful for application initialization.</p></blockquote>

<p>全てのmoduleのロードが終わった後に、実行する処理を記述します。configと違い、通常アプリケーションの 初期化に、runメソッドを利用する。</p>

<h4>●service(name, constructor)</h4>

<p>独自のserviceの定義</p>

<ul>
<li>第一引数：service名</li>
<li>第二引数：servideのインスタンス生成の処理</li>
</ul>


<p>※factoryと違い第二引数で作られたインスタンスそのものが返されることに注意</p>

<h4>●value(name, object)</h4>

<p>アプリケーション内の定数を定義するときなどに利用</p>

<hr />

<p>※比較的よく見かけるものには*をつけています。</p>

<hr />

<h3>factory, service, providerの違い</h3>

<p>３つとも独自のserviceを提供するものです。それではこの３つは、それぞれ何が違うのでしょう。</p>

<p>結論から言うと、すいません、僕も言葉でハッキリ説明することはできません・・・。</p>

<p>ですが、同様の疑問は多く寄せられていて、議論されているようです。</p>

<ol>
<li><a href="http://stackoverflow.com/questions/15666048/angular-js-service-vs-provide-vs-factory">Angular.js: service vs provide vs factory?</a></li>
<li><a href="http://jsfiddle.net/pkozlowski_opensource/PxdSP/14/">Difference between Service, Factory and Provider in AngularJS</a></li>
<li><a href="http://jsbin.com/ohamub/709/edit">同じ関数をそれぞれ３つのAPI渡したときの違い</a></li>
</ol>


<p>これらを見れば、おおまかに違いがわかると思います。</p>

<ol>
<li>serviceはインスタンスを返す(第二引数内のconstructorでreturnしても無意味)</li>
<li>factoryはデータを返す(第二引数のproviderFunction内のreturnが全て取得できる)</li>
<li>providerは$get()メソッドの結果を返す($get()メソッドのreturnのみ取得でき、moduleAPIのconfigで 更に設定・アクセスすることができる)</li>
</ol>


<p>前回の記事で、moduleを定義を</p>

<ol>
<li>serviceの定義</li>
<li>directiveの定義</li>
<li>filterの定義</li>
<li>アプリケーションの設定と1-3をインポートするmoduleの定義</li>
</ol>


<p>を推奨している、と書きましたが、汎用的なproviderを1で定義して 細かい設定をmodule.configを使って4で追加すると、良い感じに処理とデータを 分離できるかもしれません。(見当違いなこと言ってる気もします。)</p>

<p>こんな感じ・・・？もうちょっとソースコード収集して、比較すれば更に詳しく理解できるかも・・・。 意味不明、という状況ではなくなったので、とりあえずここまで。</p>

<hr />

<h3>実際に使ってみる</h3>

<h4>●まずは公式が推奨している形でそれぞれを定義してみる</h4>

<p>filter, directive, serviceにファイルを分けて、それぞれで、対応するAPIを 利用してみました。</p>

<p><a href="http://embed.plnkr.co/WA4fNk/preview">サンプル２</a></p>

<pre>angular.module('myApp', ['myDirective', 'myFilter', 'myService']){....}</pre>


<p>こんな感じで、他で定義したmoduleをインポートしています。</p>

<h4>●filter使ってみた</h4>

<p><a href="http://embed.plnkr.co/WA4fNk/preview">サンプル２(filter.js)</a></p>

<pre>myFilterModule.filter('greet', function(){
  return function(name) {
    return 'Hello, ' + name + '!';
  };
});

myFilterModule.filter('sample', function(){
  return function(user) {
    console.dir(user);
    return user.id + ':' + user.name;
  }
});</pre>


<p>公式のチュートリアルにもあった、文字を受け取って、Hello &#8216;text&#8217; !の形式にして 返すfilterです。</p>

<p>もうひとつは、userというオブジェクトを受け取って、IDと名前を連結して 返すだけのfilter。簡単ですね。</p>

<p>データベースや、jsonから取得したデータがフラグ(true/falseとか1/0)だったときに このfilterを使って出力を変えてあげたりすれば便利ですね。 (male/famaleを男性/女性に変えたり誕生日のフォーマットを変換したり、などなど)</p>

<h4>●directive使ってみた</h4>

<p><a href="http://embed.plnkr.co/WA4fNk/preview">サンプル２(directive.js)</a></p>

<pre>var myDirectiveModule = angular.module('myDirective', []);

myDirectiveModule.directive('myHeader', function(){
  return {
    restrict : 'E',
    link : function(scope, element, attr){
    },
    template : 
      '&lt;header&gt;' +
      ' &lt;div class=\'container\' id=\'mainHeader\'&gt;' +
      '</pre>


<h1>HEADER</h1>

<pre>' +
      ' &lt;/div&gt;' +
      '&lt;/header&gt;'
  };
});

myDirectiveModule.directive('myFooter', function(){
  return {
    restrict : 'E',
    link : function(scope, element, attr){
    },
    template :
      '&lt;footer&gt;' +
      ' &lt;div class=\'container\' id=\'mainFooter\'&gt;' +
      '</pre>


<h1>FOOTER</h1>

<pre>' +
      ' &lt;/div&gt;' +
      '&lt;/footer&gt;'
  };
});

myDirectiveModule.directive('myCurrentTime', function($timeout, dateFilter) {
    return function(scope, element, attrs) {
      var format='';
      var timeoutId; 

      function updateTime() {
        element.text(dateFilter(new Date(), 'yyyy/MM/dd H:ss Z'));
      }

      function updateLater() {
        timeoutId = $timeout(function() {
          //console.log('time');
          updateTime(); 
          updateLater();
        }, 1000);
      }

      element.bind('$destroy', function() {
        $timeout.cancel(timeoutId);
      });

      updateLater();
    };
});</pre>


<p>これは前回の記事と同じ。 公式の書き方を真似して、今回はtemplateUrlではなくtemplateに文字列連結で書いてみました。</p>

<p>やってることは全く同じ。それに加えて、公式チュートリアルにあるmy-current-timeのdirectiveを ちょいと改造したものを追加してみました。任意のタグにmy-current-timeをつけるだけで 現在時刻をリアルタイム表示してくれるattributeです。</p>

<p>directive()の中のreturnで、restrictなどを指定しなければデフォルトでは&#8217;A&#8217;になり、template もナシです。</p>

<p>宣言したdirectiveの名前を含んだDOMエレメントに対して、return内の関数が実行される、っていう感じかな・・・？（なんかうまく説明できないし、そもそも理解できてるか不安・・・）</p>

<p>updateTime()関数はdirectiveの名前が指定されたDOMエレメント内を、dataFilterで整形して テキストを更新する関数</p>

<p>updateLaterは$timeoutというserviceを利用して1000ミリ秒ごとにupdateTime()とupdateLater()を 呼び出しています。</p>

<p>まずmy-current-timeというattributeがついたDOMエレメントがあると、updateLater()を呼び出して、 その中で更にupdateLater()を再帰呼び出しが行われることで、 リアルタイムに時刻がカウントされています。</p>

<h4>●serviceを使ってみた(factory, service, provider, config)</h4>

<p><a href="http://embed.plnkr.co/WA4fNk/preview">サンプル２ service.js</a></p>

<p>僕の中で、MVCモデルにおけるserviceのポジションが、controllerをサポートする、みたいな感覚なんですが、 まずそれ合ってますかね・・・。</p>

<p>開発の過程でcontrollerに複数のモデルのインポートが必要になったときや、 複雑な処理が複数必要になったときに それらをまとめて代わりに引き受けて、わかりやすいインターフェースを提供する、みたいな。</p>

<p>その認識が合ってるか、どうかはまぁ置いといて、とりあえず使ってみました。</p>

<p>先ほど挙げた参考リンクと同じように、factory,service,providerをそれぞれ、同じ用途で 書いてみました。書き方や使い方に違いがあることを確認できると思います。</p>

<pre>var myServiceModule = angular.module('myService', []);

myServiceModule.factory('booksFactory', function(){
  var BookList = [
    {id:1, name:'The Racketeer: A Novel', isbn:'978-0553840926'},
    {id:2, name:'Calico Joe: A Novel ', isbn:'978-0553841275'},
    {id:3, name:'Theodore Boone: The Abduction', isbn:'978-0142421376'},
    {id:4, name:'The Racketeer', isbn:'978-1444730623'},
    {id:5, name:'Theodore Boone: Kid Lawyer', isbn:'978-0142417225'},
    {id:6, name:'The Sins of the Father', isbn:'978-1250010407'},
    {id:7, name:'Best Kept Secret (Clifton Chronicles)', isbn:'978-1250040770'}
  ];
  return {
    bookList: function(){ return BookList; }
  };
});

myServiceModule.service('booksService', function(){
  var BookList = [
    {id:8, name:'The Racketeer: A Novel', isbn:'978-0553840926'},
    {id:9, name:'Calico Joe: A Novel ', isbn:'978-0553841275'},
    {id:10, name:'Theodore Boone: The Abduction', isbn:'978-0142421376'},
    {id:11, name:'The Racketeer', isbn:'978-1444730623'},
    {id:12, name:'Theodore Boone: Kid Lawyer', isbn:'978-0142417225'},
    {id:13, name:'The Sins of the Father', isbn:'978-1250010407'},
    {id:14, name:'Best Kept Secret (Clifton Chronicles)', isbn:'978-1250040770'}
  ];
  this.bookList = function(){
    return BookList;
  };
});

myServiceModule.provider('book', function(){
  this.books = [
    {id:15, name:'The Racketeer: A Novel', isbn:'978-0553840926'},
    {id:16, name:'Calico Joe: A Novel ', isbn:'978-0553841275'},
    {id:17, name:'Theodore Boone: The Abduction', isbn:'978-0142421376'},
    {id:18, name:'The Racketeer', isbn:'978-1444730623'},
    {id:19, name:'Theodore Boone: Kid Lawyer', isbn:'978-0142417225'},
    {id:20, name:'The Sins of the Father', isbn:'978-1250010407'},
    {id:21, name:'Best Kept Secret (Clifton Chronicles)', isbn:'978-1250040770'}
  ];

  this.$get = function(){
    var BookList = this.books;
    return {
      bookList: function(){
        return BookList;
      }
    };
  };

  this.addBook = function(book){
    this.books.push(book);
  };
});

myServiceModule.config(function(bookProvider){
  book = {id:99, name:'hacking', isbn:'999-9999999999'};
  bookProvider.addBook(book);
});</pre>


<p>ID以外はデータの中身そのまんまですが、コメントアウトとかして、利用するserviceを 切り替えると、取得できるデータが違うことが確認できます。</p>

<h4>●controllerを使ってみた</h4>

<p><a href="http://embed.plnkr.co/WA4fNk/preview">サンプル２ app.js</a></p>

<p>これはもう今さらですね・・・。前回の記事でも書きました。</p>

<p>ずっと使ってるサンプル内のコントローラー。</p>

<p>RailsやPlay,strutsでいうアクションみたいなものを書きたければ</p>

<pre>$scope.[アクション名] = function($scope){...}</pre>


<p>のように書けばOKです。 (※アクションっていうよりイベントっていうのかな・・？)</p>

<pre>myAppModule.controller('mainCtrl', function($scope, $http, book, booksFactory, booksService){
  $scope.name = 'Komai';
  $scope.users = [
    {id:100, age:25, name:'Kenta Komai'},
    {id:101, age:20, name:'Masami Nagasawa'},
    {id:102, age:17, name:'Erika Toda'},
    {id:103, age:14, name:'Nozomi Sasaki'},
    {id:104, age:34, name:'Aoi Miyazaki'}
  ];
  $scope.books = booksService.bookList(); //use service
  $scope.books = booksFactory.bookList(); //use factory
  $scope.books = book.bookList();         //use provider

  $scope.event = function($scope){
    alert('click!');  
  }
});</pre>




<pre><button class="btn">button</button></pre>


<p>これでボタンクリックしたらevent()が動作します。</p>

<p>ちなみに公式チュートリアルや多くのサンプルではコントローラーをグローバル関数として 定義していますが、あくまでサンプル用に簡易に定義するためのものです。</p>

<p>本来はmodule.controller()でコントローラー定義することが推奨されています。</p>

<h4>●run, valueを使ってみた</h4>

<p><a href="http://embed.plnkr.co/WA4fNk/preview">サンプル２ app.js</a></p>

<pre>myAppModule.run(['$location', function ($location) {
  alert($location.$$host);  
}]);</pre>


<p>これ、全然いいサンプルじゃないんですが、とりあえずrun()を使う &amp; 次回以降のどこかで ちゃんと調べたいと思ってる$location serviceをとりあえず使う、サンプルにしました。</p>

<p>アプリが起動(サンプル内のmyApp moduleが読み込まれると)すると、現在のページのhostを alert()で出力するだけです。</p>

<p>アプリケーション起動時の設定や処理をここに記述します。</p>

<p>サーバサイドのフレームワークでいうbootstrapみたいなものだと思います。</p>

<p>valueを使うのは簡単です。簡単ですが、これ、わざわざ使うことがあるのかな・・・って ちょっと思ってるんですけど、明確に定数を定義したいとき、なんかに使うのかなぁ・・・。</p>

<pre>myAppModule.value('AdminName', 'KENTA KOMAI');</pre>


<p>全部を１つのコントローラーで無理矢理使おうと、サンプルを書いてるから、なのかもしれませんが いろんなmodule, serviceなどなどが、コントローラーの引数にどんどん増えていくんですよねぇ・・・。</p>

<hr />

<p>constant以外はこれで、とりあえず使ってみた形になります。ざっくりとした用途・使い方は確認できました。</p>

<p>なんか調べれば調べるほど、『これも知らないと理解できないな』っていうことが増えてきてますが、 まぁ前進はしてます。夏休み中にまとまった知識がつけばいいけど・・・。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/07/25/wordpress55/">[AngularJS]独自module + Directiveを試してみる(夏休み企画１)</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-07-25T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>学生生活最後の夏休みに入りました。</p>

<p>アルバイト先の社員さんに相談して、たくさんお休みをいただいたので 遊びに勉強に充実させたいです。</p>

<p>とりあえず夏休み中にどうにかまとめて時間を取りたいなぁ、と考えていることが いくつかあります。そのうちの一つがJavascriptのMVCフレームワークであるAngularJSに 関しての調査です。</p>

<ul>
<li><a href="http://docs.angularjs.org/">AngularJS</a></li>
<li><a href="http://dotinstall.com/lessons/basic_angularjs">DotInstall</a></li>
</ul>


<p>ドットインストールのAngularJS関連のコースや、公式サイトのチュートリアルなんか を、一応終えたり、実際に使ったりもしてはいるんですが、正直あんまり ピンときていない・・・・。</p>

<p>個人的に長く使いたいと考えているフレームワークなので、掘り下げて調べたいと考えました。</p>

<p>とは言っても、公式チュートリアルの延長線ですが・・・。</p>

<p>制作を進めていく上で疑問に思っている、理解して書いてない部分をなくすためのもの なので、どういう順番で、どういう内容をやっていこう、という明確な目標が 現段階であるわけではありませんが、疑問がなくなるまでは続けてみようと思います。</p>

<p>現段階でちゃんと分かるまでやりたいな、と思ってるのは</p>

<ol>
<li>module + directiveについて</li>
<li>$scopeについて</li>
<li>$onと$watchについて</li>
<li>$routeProviderについて</li>
<li>ngViewとtemplateについて</li>
</ol>


<p>順番は変わると思いますが、最低限これに関しては自分の 中で整理したいと思ってます。</p>

<p>今回はmoduleの作成とdirectiveに関して。</p>

<hr />

<p>既存のチュートリアルでは、ng-model、ng-controllerの説明は、大体どのページにもあるんですが moduleとdirectiveに関して、あんまり理解が進みませんでした・・・。 （※英語の理解が追いついてない、ということも大きく影響してるんですが・・・。）</p>

<p>というわけで、その辺をざっくりと。 (※最初のほうの内容はtutorialにも同じようなことが書いてあります)</p>

<p>まずはスタートはこちら。ヘッダとフッタがあって、その中に、コンテンツがあって・・・ そんな感じです。</p>

<p>ダミーテキストは<a href="http://www.blindtextgenerator.com/lorem-ipsum">blindtextgenerator.com</a>で生成してました。 今は適当なテキストですが、後ほどコンテンツもモデル化した何かに変えようと思います。</p>

<p>加えて、ソースコードとプレビューには<a href="http://plnkr.co/">Plunker</a>を利用しています。 似たようなサービスはいくつかあり、僕の周りでは<a href="http://jsfiddle.net/">JSFIDDLE</a>を利用している 人が多いのですが、見た目がかっこいいので今回はPlunkerを試してみました。</p>

<p>リンクを開いて、デフォルトで表示されているのが、プレビュー画面で、ソースコードを見たければ左上の『source code』を選択すれば見たいソースコードを選ぶことができます。</p>

<p><a href="http://embed.plnkr.co/7bLRD6qcEN8AkT4PK2dw/preview">サンプル１</a></p>

<p>スタートはこちらから。本来は埋め込みで、このサイト上に表示したかったんだけど、 wordpressのiframe制約が多くて、埋め込み上手く行かなかった・・・。</p>

<p>というわけで別リンクで、少し見づらいかもしれませんがご了承ください・・・。</p>

<p>本当は<a href="http://willvincent.com/blog/angularjs-and-twitter-bootstrap-playing-nicely">こんな感じ</a>にしたかった・・・</p>

<h3>サンプル１に対してやりたいこと</h3>

<ol>
<li>header, footerをテンプレート化</li>
<li>コンテンツのモデル化と、テンプレート化</li>
</ol>


<p>まず、オリジナルのdirectiveを定義するには、独自moduleを定義する必要があります。 というわけで作成したのが、こちら。<a href="http://embed.plnkr.co/WG3lk7xpJLUsSKWijdIZ/preview">サンプル２</a></p>

<pre>var MyModule = angular.module('MyModule', []);
</pre>


<p>これでmoduleを定義します。angular.module()の第二引数はインポートする他のmoduleを記述します。 今回はサンプルなので、何もなし。ngResourceを使ったサンプルを今度ちゃんと作りたいです。</p>

<pre>MyModule.directive('userList', function(){
  return {
    restrict : 'E',
    link : function(scope, element, attr){
    },
    templateUrl : 'userlist.html'
  };
});

MyModule.directive('title', function(){
  return {
    restrict : 'E',
    link : function(scope, element, attr){
    },
    template : '<div>
  <h1>
    App Title
                      
                  
              
          
      
  </h1>
          
        
      
    
  
</div>'
  };
});
</pre>


<p>これでdirectiveを定義。restrictは&#8217;E&#8217;がelement、&#8217;A&#8217;がattributeです。他にもあるけどとりあえずこの二つで。</p>

<p>linkの部分は、このdirectiveに紐づくメソッドなどを定義するところ。 ここにEventListenerなんかを定義すると、便利です。<a href="https://gist.github.com/KentaKomai/5974506">Gist</a></p>

<p>例えばjqueryと組み合わせて、特定のイベントや動作に独自の関数を紐付けたりが可能になってます。</p>

<p>templateは直接テンプレートをjs内に記述するならtemplate: &#8220;</p>

<p>hogehoge</p>

<p>&#8220;とすればOKですが 今回はheaderまるごと、なので別ファイルにしました。</p>

<p>ng-includeというattributeでも、templateの呼び出しができます。</p>

<p>これを利用すれば、HTML/CSS + Javascriptだけでも、テンプレートを用いて効率的にページを量産すること ができます。</p>

<p>これでfooter,headerそしてコンテンツをモデル化し、それをテンプレートで呼び出す、 というところまで実現できました。</p>

<h3>moduleを定義することのメリット</h3>

<p>module化しなくても、チュートリアルにあるような基本機能は利用できますが、 moduleを定義することで可能になることも多くあるので、明確にしておきます。</p>

<blockquote><p>Most applications have a main method which instantiates, wires, and bootstraps the application. Angular apps don&#8217;t have a main method. Instead modules declaratively specify how an application should be bootstrapped.(※AngularJS公式より引用)<a href="http://docs.angularjs.org/guide/module">Link</a></p></blockquote>

<p>つまり、アプリケーション起動時に、特有の設定などを呼び出すためのもの、ということらしいです。</p>

<p>ほかに挙がってるメリットとして</p>

<ol>
<li>独自のdirevtive、filterの定義</li>
<li>Routeの設定</li>
<li>テストがmoudle単位で行える</li>
<li>サードパーティ製のコードを含めることに便利(moduleのインポート)</li>
</ol>


<p><a href="http://docs.angularjs.org/api/angular.Module">ここ</a>に載ってるmoduleAPIで指定できる ようなことが、独自に設定できる、ということがメリットです。</p>

<p>AngularJSではmoduleの定義に関して、以下の内容を推奨しています。</p>

<ol>
<li>Serviceを提供するｍoduleを定義する</li>
<li>Directiveを提供するmoduleを定義する</li>
<li>Filterを定義するmoduleを定義する</li>
<li>アプリケーションの初期化や1-3のmoduleをインポートするmoduleを定義する</li>
</ol>


<p>確かに、Githubなどで、AngularJSを利用しているプロジェクトのコードを見ると、このように分離されている ことが多いです。</p>

<h5>今後の課題</h5>

<p>今回はmodulenとdirectiveの定義をざっくりと書きましたが、moduleAPIを利用した アプリケーション独自の設定を、掘り下げて調べたいと思ってます。</p>

<p>ただ、間違いなく感じるのは、『便利な機能は多いけど、書式は独特で学習コストは高い』 という点です。僕がアホなだけかもしれませんが・・・。</p>

<p>サーバサイド、クライアントサイド関係なく、今まで触れたフレームワークのなかでは一番 難しいです・・・。（javascriptだから、っていう部分も僕にとってはあるかもしれません）</p>

<p>次回はmoduleAPIの利用を掘り下げて、サンプルを用意してみます。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/07/19/wordpress54/">最近vimいっぱいいじったので、設定おぼえがきと、text-objectに関してまとめ</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-07-19T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>vim大好き、といいつつ特別プラグイン導入してたわけでもないし、自分でvim-script書いたり するわけでもなかったのですが</p>

<p>脱・vim初心者になりたいなー・・・と思って、設定とか色々見直しました。</p>

<p>自分でプラグイン書いたりとか、そういうのは全然できないですが（というより現状必要 だと感じもしませんが）様々なvimmerの方の設定やら、プラグインやらを拝借して、 なんだかんだで、以前と比べ物にならないくらい便利になったので紹介します。</p>

<p>自分でも一気にいじりすぎて、それぞれの機能を全然使いこなせてないし、覚書ついでに書きます。</p>

<h3>とりあえずvimrc公開</h3>

<pre>filetype indent plugin on
syntax on
set wildmenu " ナビゲーションバー有効
set autoindent " 自動インデントの有効
set smartindent " 更に賢いらしいインデントの有効
set number " 行番号の表示
set tabstop=4 " インデントのスペース指定
set tw=0 " 自動改行オフ
set shiftwidth=4 " 自動インデントのスペース指定
set whichwrap=b,s,h,l,&lt;,>,[,] " カーソルを行頭、行末で止まらないようにする
set showmatch " 括弧が閉じられたときに対応する括弧をハイライトする
set incsearch " インクリメンタルサーチをON
set wrapscan " 循環検索ON
set list " TAB, 行末の半角スペースを可視化
set listchars=tab:>\ ,trail:~,eol:$
set cursorline " カレント行のハイライト
"set cursorcolumn "カレント列のハイライト
set termencoding=utf-8 "vimのコマンド入力などに利用される文字コード
set encoding=utf-8 " デフォルトのエンコード
set fileencoding=utf-8 " ファイルのデフォルトのエンコード
" set nowrap "自動折り返しを無効
set wrap "自動折り返しを有効
set backup " バックアップを有効にする
set backupdir=~/Documents/vim_backups/ "バックアップファイル保存場所の指定
set directory=~/Documents/vim_backups/ "スワップファイルの保存場所の指定
set autoread " ファイル変更があった場合に自動再読み込み
set diffopt=vertical " diffを常に縦分割

" setting markdown filetype
autocmd BufNewFile,BufRead *.md set filetype=markdown
" Enable omni completion.
autocmd FileType eruby,html,markdown setlocal omnifunc=htmlcomplete#CompleteTags
autocmd FileType xml setlocal omnifunc=xmlcomplete#CompleteTags
autocmd FileType css setlocal omnifunc=csscomplete#CompleteCSS
autocmd FileType javascript setlocal omnifunc=javascriptcomplete#CompleteJS
autocmd FileType php setlocal omnifunc=phpcomplete#Complete
autocmd FileType python setlocal omnifunc=pythoncomplete#Complete
autocmd FileType ruby setlocal expandtab tabstop=2 shiftwidth=2 softtabstop=2 omnifunc=rubycomplete#Complete

" End insert mode by typing ;;
inoremap &lt;silent> ;; &lt;ESC>

" NOTE: -------------PLUGIN SETTINGS------------------ """
" for vim-powerline plugin
let g:Powerline_symbols='fancy'
set guifont=Source\ Code\ Pro\ Black\ for\ Powerline:h11

" for vimshell plugin
let g:vimproc_dll_path = $HOME. '/.vim/autoload/vimproc_mac.so'

" for open-browser plugin
let g:netrw_nogx = 1 " disable netrw's gx mapping.
nmap gx &lt;Plug>(openbrowser-smart-search)
vmap gx &lt;Plug>(openbrowser-smart-search)

" for  ### unite.vim ###
let g:unite_enable_start_insert=1
let g:unite_enable_split_vertically = 1 "縦分割で開く
let g:unite_winwidth = 25
"
" The unite vim prefix key.
nnoremap    [unite]   &lt;Nop>
nmap    &lt;Leader>f [unite]
 
" unite.vim keymap
autocmd FileType unite inoremap &lt;silent> &lt;buffer> &lt;ESC>&lt;ESC> &lt;ESC>q
autocmd FileType unite inoremap &lt;silent> &lt;buffer> &lt;ESC>&lt;ESC> &lt;ESC>q

nnoremap [unite]u  :&lt;C-u>Unite -no-split&lt;Space>
nnoremap &lt;silent> [unite]f :&lt;C-u>Unite&lt;Space>buffer&lt;CR>
nnoremap &lt;silent> [unite]b :&lt;C-u>Unite&lt;Space>bookmark&lt;CR>
nnoremap &lt;silent> [unite]m :&lt;C-u>Unite&lt;Space>file_mru&lt;CR>
nnoremap &lt;silent> [unite]o :&lt;C-u>Unite&lt;Space>outline&lt;CR>
nnoremap &lt;silent> [unite]c :&lt;C-u>Unite&lt;Space>-auto-preview&lt;Space>colorscheme&lt;CR>
nnoremap &lt;silent> [unite]r :&lt;C-u>UniteWithBufferDir file&lt;CR>
nnoremap &lt;silent> ,vr :UniteResume&lt;CR>
 
" unite.vim grep -> ag command
let g:unite_source_grep_command = 'ag'
let g:unite_source_grep_default_opts = '--nocolor --nogroup'
let g:unite_source_grep_recursive_opt = ''
let g:unite_source_grep_max_candidates = 200

" vinarise
let g:vinarise_enable_auto_detect = 1

" for gist-vim
let g:github_user='github user name'
let g:github_token='github access token'

" easy-motionのprefixキーバインドを &lt;SPACE>eにする。
let g:EasyMotion_leader_key = '&lt;SPACE>e'

" for Vundle plugin
" install Vundle.vim
" % git clone http://github.com/gmarik/vundle.git ~/.vim/bundle/vundle
set nocompatible               " be iMproved
filetype off                   " required!
set rtp+=~/.vim/bundle/vundle/
call vundle#rc()
" let Vundle manage Vundle
" required!
Bundle 'gmarik/vundle'
" ---- My Bundles here -----:
Bundle 'The-NERD-tree'
Bundle 'open-browser.vim'
Bundle 'Lokaltog/vim-powerline'
Bundle 'kannokanno/previm'
Bundle 'gregsexton/gitv'
Bundle 'Shougo/vimshell.vim'
Bundle 'Shougo/unite.vim'
Bundle 'Shougo/unite-outline'
Bundle 'soh335/unite-qflist'
Bundle 'Shougo/unite-ssh'
Bundle 'Shougo/neosnippet'
Bundle 'ujihisa/unite-colorscheme'
Bundle 'ujihisa/quicklearn'
Bundle 'tsukkee/unite-tag'
Bundle 'guns/xterm-color-table.vim'
Bundle 'thinca/vim-quickrun'
Bundle 'thinca/vim-ref'
Bundle 'errormarker.vim'
Bundle 'Gist.vim'
Bundle 'cakephp.vim'
Bundle 'rails.vim'
Bundle 'Python-Syntax'
Bundle 'vim-scripts/Align'
Bundle 'rizzatti/funcoo.vim'
Bundle 'rizzatti/dash.vim'
Bundle 'Lokaltog/vim-easymotion'
Bundle 'elzr/vim-json'

" ---- colorschemes -----:
Bundle 'nanotech/jellybeans.vim'
Bundle 'w0ng/vim-hybrid'
Bundle 'vim-scripts/twilight'
Bundle 'jonathanfilip/vim-lucius'
Bundle 'jpo/vim-railscasts-theme'
Bundle 'altercation/vim-colors-solarized'
Bundle 'vim-scripts/Wombat'
Bundle 'tomasr/molokai'
Bundle 'vim-scripts/rdark'

" original repos on github
Bundle 'tpope/vim-fugitive'
Bundle 'Lokaltog/vim-easymotion'
Bundle 'rstacruz/sparkup', {'rtp': 'vim/'}
Bundle 'tpope/vim-rails.git'
" vim-scripts repos
Bundle 'L9'
Bundle 'FuzzyFinder'
" non github repos
Bundle 'git://git.wincent.com/command-t.git'
" ...
filetype plugin indent on     " required!
filetype on
</pre>


<p>なんか便利そうだからとりあえず入れた、っていうプラグインもあるけど 使ってないまま放置してます。(おい)</p>

<h3>vim本体の設定</h3>

<p>「set *****&#8230;」というタイプの設定は、大体コメント書いてあるので割愛。</p>

<p>僕はこのブログをmarkdownで記述していて、vimでそれを書いているのですが 拡張子がmdのファイルはデフォルトだとmodula2のfiletypeが設定されてしまうので そこをmarkdownに変更しています。</p>

<pre>autocmd BufNewFile,BufRead *.md set filetype=markdown
</pre>


<p>以降は、オートコンプリートの設定です。 autocmd Filetype hogehoge xxxxxx これでFiletypeがhogehogeのときxxxxを実行、という感じです。</p>

<pre>autocmd FileType eruby,html,markdown setlocal omnifunc=htmlcomplete#CompleteTags
autocmd FileType xml setlocal omnifunc=xmlcomplete#CompleteTags
autocmd FileType css setlocal omnifunc=csscomplete#CompleteCSS
autocmd FileType javascript setlocal omnifunc=javascriptcomplete#CompleteJS
autocmd FileType php setlocal omnifunc=phpcomplete#Complete
autocmd FileType python setlocal omnifunc=pythoncomplete#Complete
autocmd FileType ruby setlocal expandtab tabstop=2 shiftwidth=2 softtabstop=2 omnifunc=rubycomplete#Complete
</pre>


<p>インサートモードから抜けるときにEscキーが遠いなーと思ったので</p>

<pre>inoremap &lt;silent> ;; &lt;ESC>
</pre>


<p>これでセミコロン２回でEscキーを押したことにしてます。</p>

<hr />

<p>以降はプラグインのための設定</p>

<h3>vim-powerlineのための設定</h3>

<pre>" for vim-powerline plugin
let g:Powerline_symbols='fancy'
set guifont=Source\ Code\ Pro\ Black\ for\ Powerline:h11
</pre>


<p>個人的にはデフォルトでも十分にかっこいいし、使えるのですがpowerline導入してる人は だいたい、この設定してるのでやってみました。</p>

<p>fontforgeというソフトを使って、専用のフォントを作成しないとこの設定は使えません。</p>

<p>ちょっと面倒だったけど、確かにかっこよくなっし、行番号、列番号やモードの表示は 使ってみると、本当に便利です。</p>

<p>こんな感じになります。</p>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-18-at-22.59.21.png" rel="image_group"><img src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-18-at-22.59.21.png?resize=955%2C64" alt="Screen Shot 2013-07-18 at 22.59.21" class="alignnone size-large wp-image-667" data-recalc-dims="1" /></a></p>

<h3>opwn-browserの設定</h3>

<p>このプラグインは編集しているソースコードやテキスト内のURLをコマンドで開いてくれたり、 キーワードをgoogle検索してくれたりします。</p>

<pre>" for open-browser plugin
let g:netrw_nogx = 1 " disable netrw's gx mapping.
nmap gx &lt;Plug>(openbrowser-smart-search)
vmap gx &lt;Plug>(openbrowser-smart-search)
</pre>


<p>テキストを選択してgxを押すと、デフォルトのブラウザで選択されたテキストがURLなら 直接URLへアクセス、URLでなければgoogle検索してくれます。</p>

<h3>Unite.vimの設定</h3>

<p>長いので、コメントに書き足します。よく使うやつだけ</p>

<pre>" for  ### unite.vim ###
let g:unite_enable_start_insert=1
let g:unite_enable_split_vertically = 1 "縦分割で開く
let g:unite_winwidth = 25 "uniteのウィンドウサイズ
"
" The unite vim prefix key.
nnoremap    [unite]   &lt;Nop>
nmap    &lt;Leader>f [unite] " \ + f を [unite]というコマンドとして定義
 
" unite.vim keymap
autocmd FileType unite inoremap &lt;silent> &lt;buffer> &lt;ESC>&lt;ESC> &lt;ESC>q
autocmd FileType unite inoremap &lt;silent> &lt;buffer> &lt;ESC>&lt;ESC> &lt;ESC>q

""" [unite] + キー　でそれぞれのsourceを展開
nnoremap [unite]u  :&lt;C-u>Unite -no-split&lt;Space>
nnoremap &lt;silent> [unite]f :&lt;C-u>Unite&lt;Space>buffer&lt;CR> " [unite] + u で バッファを表示
nnoremap &lt;silent> [unite]b :&lt;C-u>Unite&lt;Space>bookmark&lt;CR>
nnoremap &lt;silent> [unite]m :&lt;C-u>Unite&lt;Space>file_mru&lt;CR> "[unite] + m で 最近開いたファイル
nnoremap &lt;silent> [unite]o :&lt;C-u>Unite&lt;Space>outline&lt;CR>  "[unite] + o で アウトラインを表示
nnoremap &lt;silent> [unite]c :&lt;C-u>Unite&lt;Space>-auto-preview&lt;Space>colorscheme&lt;CR> "[unite] + c で カラースキーマのオートプレビュー
nnoremap &lt;silent> [unite]r :&lt;C-u>UniteWithBufferDir file&lt;CR>
nnoremap &lt;silent> ,vr :UniteResume&lt;CR>

""" Unite grepではagコマンドを使う、という設定(grepの代わりがackで、それを更に高速化したのがag)
" unite.vim grep -> ag command
let g:unite_source_grep_command = 'ag'
let g:unite_source_grep_default_opts = '--nocolor --nogroup'
let g:unite_source_grep_recursive_opt = ''
let g:unite_source_grep_max_candidates = 200
</pre>


<p>Unite grepでは外部grepを使うので、vimgrepより高速です。僕が設定していないだけなんだろうけど vimgrep+Quickfixのほうが見やすい、という事も多いので、</p>

<ul>
<li>大量のソースコードから検索したいときはUnite grep(ag)</li>
<li>ちょっとしたモジュール、プロジェクト内ならvimgrep</li>
</ul>


<p>という感じで使い分けてます。</p>

<h3>easy-motionの設定</h3>

<pre>" easy-motionのprefixキーバインドを &lt;SPACE>eにする。
let g:EasyMotion_leader_key = '&lt;SPACE>e'
</pre>


<p>ここは書いてある通り。 space + e押してから k か j 押すと、各行がインデックスされ 一発でジャンプできるようになります。これは使うまでナメてた。本当に便利。</p>

<p><a href="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-19-at-12.31.51.png" rel="image_group"><img src="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-19-at-12.31.51.png?resize=716%2C756" alt="Screen Shot 2013-07-19 at 12.31.51" class="alignnone size-full wp-image-668" data-recalc-dims="1" /></a></p>

<h3>Vundleで管理してるプラグインいろいろ</h3>

<p>使ってないのも結構まじってるけど・・・colorschemeは省略してます</p>

<pre>Bundle 'The-NERD-tree'
Bundle 'open-browser.vim'
Bundle 'Lokaltog/vim-powerline'
Bundle 'kannokanno/previm'
Bundle 'gregsexton/gitv'
Bundle 'Shougo/vimshell.vim'
Bundle 'Shougo/unite.vim'
Bundle 'Shougo/unite-outline'
Bundle 'soh335/unite-qflist'
Bundle 'Shougo/unite-ssh'
Bundle 'Shougo/neosnippet'
Bundle 'ujihisa/unite-colorscheme'
Bundle 'ujihisa/quicklearn'
Bundle 'tsukkee/unite-tag'
Bundle 'guns/xterm-color-table.vim'
Bundle 'thinca/vim-quickrun'
Bundle 'thinca/vim-ref'
Bundle 'errormarker.vim'
Bundle 'Gist.vim'
Bundle 'cakephp.vim'
Bundle 'rails.vim'
Bundle 'Python-Syntax'
Bundle 'vim-scripts/Align'
Bundle 'rizzatti/funcoo.vim'
Bundle 'rizzatti/dash.vim'
Bundle 'Lokaltog/vim-easymotion'
Bundle 'elzr/vim-json'
</pre>


<p>上記で挙げてないもので、特別便利なやつだけちょっと紹介</p>

<h5>●NERD-tree</h5>

<p>ファイラーといえばいいんですかね。指定したディレクトリのファイル構造を開いて クリックとかEnterとかで開けるようにしてくれる</p>

<p>こんな感じ</p>

<p><a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-19-at-12.32.56.png" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-19-at-12.32.56.png?resize=437%2C1024" alt="Screen Shot 2013-07-19 at 12.32.56" class="alignnone size-large wp-image-669" data-recalc-dims="1" /></a></p>

<h5>●vimshell.vim</h5>

<p>vimからシェルを叩けるコマンド。僕は主にログ監視とかしたいときにはじっこで起動して使ってます。</p>

<h5>●Gitv</h5>

<p>これ便利すぎてびびる。vimからgitのpush,pullしたり、diffやログの確認などなど。 git周りはなんでもこれで完結</p>

<h5>●vim-quickrun</h5>

<p>ド定番プラグイン。書いてるプログラムを:QuickRunコマンドだけで実行してくれる。 ただc++書いてたときはSegmentation Errorが表示されなくて、ちょっとだけ困った。 色々な言語に対応してるし、サクっと確認したいときにはすごく便利です。</p>

<h5>●Gist.vim</h5>

<p>vimで開いているファイルを、ダイレクトにgistに投稿するプラグイン。 使うかなー、と思って入れたけど、実際いれたらちょっとしたメモはすぐにgistにアップロードするようになった</p>

<h5>●dash.vim</h5>

<p>MacOSXで動作する、オフラインでも様々なリファレンスを参照できるDashというアプリケーションに対して vimのコマンドから関数などを検索できて、一発表示できるプラグイン。Dash使ってるvimmerは必見</p>

<h5>●previm</h5>

<p>僕はmarkdownをリアルタイムにブラウザで確認するために使ってますが、javascriptで色々拡張できるらしい。</p>

<h5>●vim-json</h5>

<p>jsonを扱うときに、色分けしたり、結構見やすくしてくれる。jsonをよくいじる人は入れたほうがいいかも。</p>

<hr />

<h3>割と最近になって使うようになったコマンド(pluginのコマンド以外で)</h3>

<h5>●カーソル移動に w e b _</h5>

<p>基本的にhjklばかりでしたが、だんだん遅くてイライラしてきたので、なんとなくこっちの頻度が増えました。 easy-motionと組み合わせると、あっという間に目的地に辿り着ける</p>

<h5>●数字押してからインサートモードに入って、なにか入力して、ESC</h5>

<p>例えば30と入力してからiとかuでインサートモードに入って、「-」をタイピングして、ESCを押します。 すると、「-」が30個挿入されます。 コメントアウトで、いい感じに線を引きたいときとか、ブロッキングしたいときなんかに使ってます。</p>

<h5>●最後に編集した場所に戻る g;</h5>

<p>色々ソースコード見渡した後で、前にいじってたところに戻りたい、なんてときに使います。</p>

<h5>●タグジャンプのための Ctrl+t　Ctrl+]</h5>

<p>ctagsコマンドと併用しないと、利用できないのでIDEに比べると手間ですが、あると便利です。(カレントディレクトリの.ctagsを作成 するだけなら:!ctags -RでOK)※変数や関数の定義元にジャンプしたりするあれです。 <a href="http://qiita.com/soramugi/items/7014c866b705e2cd0b95">http://qiita.com/soramugi/items/7014c866b705e2cd0b95</a>がとても 参考になりました。 よく使うプロジェクトやディレクトリは.ctagファイルを作成しておいて損はないと思います。</p>

<h5>●ヘルプの参照に :help [コマンド]</h5>

<p>そのまんまです。プラグイン入れたときとか、コマンドの詳細をど忘れしたときなんかに。 基本的にコマンド自体を覚えてる前提なので、用途別に逆引きとかもあったらいいですけどね。</p>

<p>これ以外だとvimgrepとargsが慣れてきたかなー、という感じです。</p>

<hr />

<h3>text-objectに関して</h3>

<p>ずっと見て見ないフリをしてきたんですが、便利そうなのでこれを期にまとめてみましたー。</p>

<p>とりあえず:help text-object@jaすると、日本語のtext-objectに関するヘルプが読めます。 読めばすぐ使えるようになるかなー、とか思ってたら結構充実してて、覚えるの大変そうでした・・・。</p>

<p>ざっくり概要</p>

<ol>
<li>viにはない機能</li>
<li>(動作) + (a or i) + (対象箇所) というコマンド構成が基本</li>
</ol>


<h5>●(a or i)について</h5>

<ul>
<li>[a]は[a 対象箇所] &ndash;>対象箇所全体を (動作)　する</li>
<li>[i]は[inner 対象箇所] &ndash;>対象箇所の中身を　（動作）する</li>
</ul>


<h5>●対象箇所について</h5>

<ul>
<li>w : word</li>
<li>W : WORD</li>
<li>s : sentence</li>
<li>p : paragraph</li>
<li>t : tag</li>
<li>[ or ]: []block</li>
<li>{ or } : {}block</li>
<li>( or ) or b : ()block ()</li>
<li>&lt; or > : &lt;>block</li>
<li>&#8216; or &#8221; : &#8220;&#8221; or &#8221; block</li>
</ul>


<p>ちゃんと読んだら、結構シンプルですね。</p>

<h5>●使い方サンプル</h5>

<p>公式ヘルプにあったサンプル</p>

<pre>"dl"    1文字削除 ("x" と同じです)       |dl|
"diw"   inner word を削除          *diw*
"daw"   a word を削除              *daw*
"diW"   inner WORD を削除 (参照: |WORD|) *diW*
"daW"   a WORD を削除 (参照: |WORD|)     *daW*
"dgn"   次に検索パターンにマッチするものを削除  *dgn*
"dd"    1行削除                    |dd|
"dis"   inner sentence を削除          *dis*
"das"   a sentence を削除          *das*
"dib"   inner '(' ')' block を削除     *dib*
"dab"   a '(' ')' block を削除         *dab*
"dip"   inner paragraph を削除         *dip*
"dap"   a paragraph を削除         *dap*
"diB"   inner '{' '}' Block を削除     *diB*
"daB"   a '{' '}' Block を削除         *daB*
</pre>


<p>あと簡単なやつ</p>

<pre>vi" : ""の内部だけを選択
viw : 1単語を選択
vit : tag内を選択(のhogeだけを選択)
vat : tag内を選択(の全体を選択)
cit : tag内を削除(のhogeだけを削除)
</pre>


<hr />

<p>こんな感じですね。我ながら結構一気にvim力あがった感あります・・・ｗ 脱初心者できたかな・・・？でも中級者はまだまだ・・・って感じです。</p>

<hr />

<h3>初心者ながらアドバイス</h3>

<p>とりあえずvim触ってみたいって人が、いろんなvimmerの方が入れてるプラグインを片っ端からいれて 使いこなせずにvim使わなくなっちゃう、っていうパターンが僕の周りでは多いです。</p>

<p>僕の場合、今思えばラッキーで</p>

<ol>
<li>強制的にvimを使わないといけない環境になる</li>
<li>とりあえずサーバ管理するときには使うようになる(mode切り替えが違和感なく行える)</li>
<li>コーディングとかでも不自由なく使えるようになってくる(テキスト編集が効率的に行えるようになってくる)</li>
<li>ここでようやくプラグインに関心を持つ</li>
<li>長ったらしいコマンドはキーバインド設定すればいいかな、って思うようになる</li>
</ol>


<p>という流れでのめり込んでいきました。</p>

<p>プラグインを導入したほうが便利なのは間違いないのですが、まずは基本的なキーバインドに 慣れて、vim独特のテキスト編集に慣れることをおすすめしたいです （ここまで来て、vimが自分に合うかどうか判断できると思う）</p>

<p>更に便利にしたい場合はプラグイン入れるといいかなー、と。</p>

<p>結局は全ての操作がコマンドなので、プラグイン入れれば入れるほど 覚えることは増えていきます。</p>

<hr />

<h3>課題</h3>

<ol>
<li>NeoBundleへの以降</li>
<li>Unite.vimのカスタマイズ</li>
<li>オリジナルカラースキーマの作成</li>
<li>キーバインドを増やす＆見直す</li>
</ol>


<p>上記の課題のいずれかがクリアできたら、また記事書きたいです。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/07/17/wordpress53/">RegexCrosswordという正規表現パスルで遊んでみました。</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-07-17T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>以前、正規表現に関するブログを書いたときにも同じようなこと書いた気がしますが</p>

<p><strong>正規表現ってよく使うのに、なんか忘れちゃう！</strong></p>

<p>ということが僕の場合、往々にしてあります。</p>

<p>今回、面白いサイトをRSSから知って遊んでみました。</p>

<p>正規表現のクロスワードパズルです。</p>

<p><a href="http://regexcrossword.com/">RegexCrossword</a></p>

<p>遊び方は簡単で、facebookアカウントでログインして（ログインしなくても遊べるけど）問題を解くだけ。 縦と横に様々な正規表現パターンが表示されるので、それら全てにマッチングするものを 四角の中にタイピングしていきます。</p>

<p>問題は５問１セットで、１セットクリアするごとに、バッジのようなものをもらえます。(特に役に立つわけじゃないけど、こういうのは ユーザのモチベーションを保つのにいいですよね。)</p>

<p><a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-17-at-19.31.11.png" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-17-at-19.31.11.png?resize=955%2C547" alt="Screen Shot 2013-07-17 at 19.31.11" class="alignnone size-large wp-image-658" data-recalc-dims="1" /></a></p>

<p>おすすめの問題は</p>

<p><a href="http://regexcrossword.com/challenges/experienced/puzzles/4">Experienced 4</a>と、 <a href="http://regexcrossword.com/challenges/palindromeda/puzzles/4">Palindromeda 4</a>です。</p>

<p>今まで必要になったときにGoogle検索しながら、とりあえずマッチングするパターンを 作成して・・・というような感じでしたが、がっつり復習・勉強になりました。</p>

<p>特に</p>

<ol>
<li>()の使い方</li>
<li>\1\2などのメタ文字</li>
<li>.や*がどのパターンに対して有効になっているか</li>
</ol>


<p>など、注意深く見て行かないと複雑で難しい問題も含まれてます。</p>

<p>僕のように「とりあえず知ってるけど、使う時はとりあえずぐぐってる」というような 正規表現の使い方をしている方にはおすすめです。</p>

<p>全部の問題を解くのに、３時間弱程度でした。</p>

<p>以下スクリーンショット(問題の解答が含まれるので、ご注意を)</p>

<p><a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-17-at-15.41.49.png" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-17-at-15.41.49.png?resize=906%2C878" alt="Screen Shot 2013-07-17 at 15.41.49" class="alignnone size-full wp-image-657" data-recalc-dims="1" /></a></p>

<p><a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-17-at-16.45.35.png" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-17-at-16.45.35.png?resize=920%2C776" alt="Screen Shot 2013-07-17 at 16.45.35" class="alignnone size-full wp-image-656" data-recalc-dims="1" /></a></p>

<p>問題に登場したパターンの一部を参考に紹介します。(なんとなくコピペしただけで、このパターンを 選んだ意味はないです。)</p>

<ul>
<li>[A-O]{2}(AR|AJ)*</li>
<li>(BA|TH|TU)*</li>
<li>(EM|FE)(IT|IP)</li>
<li>[^F-KM-Z] と [D-HJ-M]</li>
<li>.*C+[TIF]</li>
<li>[^RO\sE]*(WHE|WHO)</li>
</ul>


<hr />

<p>問題を解いている過程で、非常に使いやすい正規表現のチェッカーも見つけたので貼っておきます。</p>

<p><a href="http://scriptular.com/">scriptular</a></p>

<p>簡単に遊べて、楽しくとても勉強になったのでおすすめです。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/07/17/wordpress52/">centos6.4 + PHP5.3 + Php-fpm + APC + Nginxを構成したときのメモ</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-07-17T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>先日、トラしゅという（クラウドに関する勉強会＋小規模な障害対応の実践コンテスト）に参加させていただきました。<br/>
<a href="https://twitter.com/search/%23%E3%83%88%E3%83%A9%E3%81%97%E3%82%85">twitter #トラしゅ</a></p>

<p>会場はニフティさんのオフィスと会議室の一部で開催され、障害対応の実践にもニフティクラウド上に構築されたネットワークインフラ上で行われました。</p>

<p>午前中はニフティクラウドの紹介と体験 午後は、５人～６人でチームが構成され、そのメンバーが協力してインフラ上の障害に対応し、その対応の優劣を競う、というものでした。</p>

<p>結果から言うと、優勝しちゃったんですが、僕は全く役に立てず・・・。 勉強させてもらって、優勝商品までいただいて・・・感無量ですが、次はせめて少しでも役に立ちたいです・・・。</p>

<hr />

<p>というわけで少し復習を兼ねて、このブログの本題です。</p>

<p>午後の障害対応の実践では、簡単に言うと、与えられたWEBサーバ（ロードバランサやDBサーバなども含）に、大量のHTTPリクエストがきたときに、可能な限りダウンしないようにチューニングしてください、というお題でした。 （※ダウンしてしまった場合は、それらのいち早い復旧と、報告なども含みます。）</p>

<p>WEBサーバの構成はapache上でwordpressが動いているシンプルなものでした。</p>

<p>それらを、できるだけレスポンス早く、負荷の少ないものにチューニングしてみよう、ということで、このブログ記事ではタイトルの構成</p>

<ul>
<li>CentOS minimal 6.4</li>
<li>PHP 5.3</li>
<li>php-fpm(Alternative PHP Cache)</li>
<li>APC(FastCGI Process Manager)</li>
<li>nginx(http server)</li>
</ul>


<p>この構成にwordpress + mysqlを動かしてみます。</p>

<h2>1.nginxをインストールする</h2>

<p>defaultではCentOSのパッケージ管理を行なってくれるyumにnginxのリポジトリは含まれていませんので、まずは それらを追加していきます。</p>

<p>/etc/yum.repos.dディレクトリ内にファイルを作成しておけば、yumを利用するときに自動的にそこから検索されます。</p>

<pre>$touch nginx.repo
    $vim nginx.repo
</pre>


<p>これでnginx.repoというnginxのリポジトリのURLなどを書いておくファイルを作成します。</p>

<pre>[nginx]
    name=nginx repo
    baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
    gpgcheck=0
    enabled=1
</pre>


<p>僕の環境ではこんな感じです。設定の内容とかは忘れちゃった・・・。 後々調べて追記すると思います。</p>

<p>ここまでできたら</p>

<pre>$sudo yum update
    $sudo yum install nginx
</pre>


<p>これでnginxのインストールはOKです。 起動はおなじみserveiceコマンドから</p>

<pre>$sudo service nginx on
</pre>


<h2>2.php-fpmをインストールする</h2>

<p>※補足 php-fpmとは</p>

<p>php FPM(FastCGI Process Manager)の略で単体で動作するアプリケーションサーバであり Webサーバとアプリケーションサーバのやり取りをするためのプロトコルがFastCGIで、それの実装。</p>

<p>今回はよく見かけるApache + mod_phpという１サーバ構成と違い、nginx(WEBサーバ) + php-fpm(APサーバ) という構成になります。</p>

<p><a href="http://se-suganuma.blogspot.jp/2012/04/centosnginx-php-fpminstallwordpress.html">参考にさせていただいたサイト1</a><br/>
<a href="http://d.hatena.ne.jp/hnw/20130328">参考にさせていただいたサイト2</a></p>

<p>インストールは簡単です。</p>

<pre>$sudo yum install php php-devel php-fpm php-mysql php-mbstring
</pre>


<p>これだけ。後々必要になりそうなやつは一緒に入れちゃってます。 php-fpmの起動は</p>

<pre>$sudo service php-fpm on
</pre>


<p>でOKです。</p>

<h2>3.nginxにphp-fpmを設定する</h2>

<p>で、ここが一番時間かかった・・・。正直今もあんまりわかってないんですが、nginxに関しては 改めてブログ書きたいと思います。今は「これで動きました」という設定のみ公開しておきます。 あくまで僕の環境で、ですが・・・。</p>

<p>編集するのは /etc/nginx/conf.d/default.confです。その親ディレクトリにある/etc/nginx/nginx.confを見るとわかるようにconf.dディレクトリ内の設定ファイルは全てインクルードされるようです。</p>

<pre>server {
        listen       80;
        server_name  localhost;
        index  index.php index.html index.htm;

        #charset koi8-r;
        #access_log  /var/log/nginx/log/host.access.log  main;
        root   /usr/share/nginx/html;

        location ~ \.php {
            fastcgi_pass    127.0.0.1:9000;
            fastcgi_index   index.php;
            fastcgi_param   SCRIPT_FILENAME $document_root$fastcgi_script_name;
            include     fastcgi_params;
        }
    }
</pre>


<p>一応ポイントなのはlocation ~ &#46;php {&#8230;}の内部で自分自身の9000番ポートをFastCGIのポートとして指定しています。APサーバを別サーバにするなら、適宣、対応するアドレスを入れてあげてください。</p>

<p>fastcgi_paramってところが、色々エラー出まくりで、ようやくこれで正常に動きました・・・。</p>

<p>ここは別記事で今度まとめます</p>

<hr />

<h4>ここまでの動作確認をしておく</h4>

<p>ここまでできたら、動作確認をしてみます。</p>

<p>rootに指定してある/usr/share/nginx/htmlディレクトリ内にindex.phpを作成します。</p>

<pre>$sudo vim /usr/share/nginx/html/index.php
</pre>




<pre><?php
    phpinfo();
    ?>
</pre>


<p>これでOK</p>

<p>サーバにブラウザからアクセスして、phpinfo()の画面が正常に動くかを確認します。</p>

<p>こんな感じにちゃんと表示されたら</p>

<ul>
<li>Server API</li>
<li>&#95;SERVER[&ldquo;SERVER_SOFTWARE&rdquo;]</li>
</ul>


<p>の２項を確認して、nginxとphp-fpmが動作しているかを確認します。</p>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-17-at-0.09.40.png" rel="image_group"><img src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-17-at-0.09.40.png?resize=636%2C262" alt="Screen Shot 2013-07-17 at 0.09.40" class="alignnone size-full wp-image-647" data-recalc-dims="1" /></a></p>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-17-at-0.10.01.png" rel="image_group"><img src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-17-at-0.10.01.png?resize=746%2C212" alt="Screen Shot 2013-07-17 at 0.10.01" class="alignnone size-full wp-image-648" data-recalc-dims="1" /></a></p>

<hr />

<h2>4.APCをインストールする</h2>

<p>これもyumでインストールするだけ！しかも動かすだけなら特別な設定とかも別に要らない。</p>

<pre>$sudo yum install php-pecl-apc
</pre>


<p>これでインストールが終わると、/usr/share/php-pecl-apc/ディレクトリ内にapc.phpというものが 出来ます。これはapcでどれだけキャッシュを行なっているかを確認するためのファイルで、ブラウザから 確認できるところにコピーしておくと便利です。</p>

<pre><code>$sudo cp /usr/share/php-pecl-apc/apc.php /usr/share/nginx/html/
</code></pre>

<p>これをやっておいて、ブラウザで <a href="http://">http://</a>[ipaddress]/apc.phpにアクセスすると、下記のようなグラフが確認 できます。簡単ですね</p>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-17-at-0.22.17.png" rel="image_group"><img src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-17-at-0.22.17.png?resize=955%2C720" alt="Screen Shot 2013-07-17 at 0.22.17" class="alignnone size-large wp-image-649" data-recalc-dims="1" /></a></p>

<h2>5.mysqlのインストールと設定</h2>

<p>別に書く必要ないかなー、と思ったけど自分がちょいちょい忘れてたので、復習がてら書いておきます。</p>

<pre>$sudo yum install mysql-server
</pre>


<p>インストールはこれだけ。でもインストールが終わったら初期設定とかをまとめてやってくれるmysql_secure_installationを実行すると、結構便利です。</p>

<pre>$sudo mysql_secure_installation
</pre>


<p>これで、必要ないテーブルやDBを消してくれたり、rootユーザのパスワードやログイン設定なんかをサクっとやってくれます。案内にしたがって入力するだけなので割愛。とりあえずrootユーザにパスワード設定は忘れないようにしてくださいね。</p>

<p>あとは次項でインストールするwordpressのためのDBとユーザを作成しておきます。</p>

<pre>$mysql -u root -p //password入力
    mysql> create database wordpress;　//wordpress専用のDB作成
    mysql> grant all privileges on wordpress.* to wordpress@localhost identified by 'password'; //wordpress専用のユーザを作成
</pre>


<p>これでOKです。コマンドラインからユーザ作成とか久しぶりにやりました・・・。コマンドラインからなんでも出来るようになってないとダメかなぁ・・・</p>

<h2>6.wordpressを導入する</h2>

<p>これは今までで一番簡単かも。ざっくり簡単に書きます。</p>

<pre>$wget http://ja.wordpress.org/latest-ja.zip //wordpress公式サイトから最新版をダウンロード
$unzip latest-ja.zip  //zipを解凍
$mv latest-ja.zip /usr/share/nginx/html/ //webrootにディレクトリを移動
</pre>


<p>これでOK。ちなみに、僕がこの記事の内容を試したCentOS minimal 6.4にはwgetもunzipもデフォルトでは インストールされていなかったので、必要なら</p>

<pre>$sudo yum install wget unzip
</pre>


<p>してください</p>

<p>wordpressの設定はwordpress/wp-config.phpですので、そちらを開いて、5で設定したDBとユーザを指定してください。※そのファイルが存在しない場合はwp-config-sample.phpをコピーしてwp-config.phpを作成してください。 おそらくデフォルトでwp-config.phpは存在しないです。</p>

<p>ちなみにそれだけで、通常に動作しますが、認証用のユニークキーを変更しておきましょう。</p>

<p><a href="https://api.wordpress.org/secret-key/1.1/salt/">https://api.wordpress.org/secret-key/1.1/salt/</a></p>

<p>ここにアクセスすると、ユニークキーを自動で生成してくれるので、まるごとコピペするだけ</p>

<p>最後に<a href="http://">http://</a>[ipaddress]/wordpress/にブラウザからアクセスして、初期設定を行なってください。</p>

<p>これが完了すれば、wordpressがnginx+php-fpm上で動作していることになります。</p>

<p>こんな感じのページ見えてますかね。</p>

<p><a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-17-at-0.38.54.png" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-17-at-0.38.54.png?resize=955%2C554" alt="Screen Shot 2013-07-17 at 0.38.54" class="alignnone size-large wp-image-650" data-recalc-dims="1" /></a></p>

<hr />

<p>以上で完了です。</p>

<p>インストールして動作させるだけで、非常に長くなってしまったので、検証や、より細かいカスタマイズは 次回以降に書いていこうと思います。</p>

<p>とりあえずこれで、動きますよー。ということだけ伝われば・・・。</p>

<h3>課題</h3>

<ol>
<li>nginxの設定ファイルについて</li>
<li>php-fpmのチューニングについて</li>
<li>mysqlのチューニングについて</li>
<li>APCでwordpressをキャッシュする設定について</li>
</ol>


<p>次回以降、このへんに触れていきたいと思います。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/07/05/wordpress51/">頭が弱すぎてruby + Rbenv + Gem + Bundle + (+rails)の仕組みが理解できない・・・</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-07-05T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>すいません・・・ このへんまったく理解していないまま、<strong>適当</strong>にやってました・・・。</p>

<p>普段は</p>

<ul>
<li>ruby 1.9.3</li>
<li>rails 3.2.13</li>
</ul>


<p>でアプリ開発を行なっていましたが並行して</p>

<ul>
<li>ruby 2.0.0</li>
<li>rails 4.0.0</li>
</ul>


<p>で新規にアプリケーションを作成する必要がありました。</p>

<p>ここで</p>

<ol>
<li>既存のrails3.2.13アプリケーションはruby1.9.3で動作させたいし、開発も継続したい</li>
<li>新規のrails4.0.0アプリケーションはruby2.0.0で動作させ、これから新規開発したい</li>
<li>つまりruby1.9.3と2.0.0、rails3.2.13と4.0.0を同じPC内に共存させ、どちらも動作させる必要がある</li>
</ol>


<p>という課題が発生しました。</p>

<p>これに対する解決策として、rvmまたはrbenvを利用し、複数のバージョンのrubyを管理する、ということが挙げられましたので それで対応することにしました。</p>

<p>最初に、とりあえずrvm、rbenvの両方を導入して、使いやすいほうを使っていくかー、と思ってたのですが 先日のトラしゅで同じチームになってくれた<a href="https://twitter.com/16bit_idol">@16bit_idol</a>さんに</p>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-04-at-9.39.07.png" rel="image_group"><img src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-04-at-9.39.07.png?resize=955%2C608" alt="Screen Shot 2013-07-04 at 9.39.07" class="alignnone size-large wp-image-630" data-recalc-dims="1" /></a></p>

<p>と教えていただいたので、問題がない限り、そちらで運用してみることにしました。ありがとうございます。</p>

<p>そして、インストールが終了し、1.9.3と2.0.0のrubyをダウンロードし、$rbenv global [version]でrubyのバージョンが切り替えられること を自分の環境で確認するところまではOKです。</p>

<p><a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-04-at-16.50.27.png" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-04-at-16.50.27.png?resize=955%2C122" alt="Screen Shot 2013-07-04 at 16.50.27" class="alignnone size-full wp-image-632" data-recalc-dims="1" /></a></p>

<h3>1. gemとは</h3>

<blockquote><p>Rubyで使われるライブラリやアプリケーションはGemと呼ばれる形式のパッケージにすることができます。 多くのライブラリがGem形式でパッケージされ公開されており、これらはRubyGemsと 呼ばれるパッケージ管理ツールを使ってダウンロードを行なったりインストールすることができます。 これらのパッケージのことを単にGemとかGemパッケージなどと呼んだりします。<br/>
RailsもGem形式でパッケージになったもので、Railsをインストールした時も「gem install rails」と RubyGemsを使ってインストールを行いました。<br/>
Railsで作成したアプリケーションは通常Railsだけでなく他の多くのGemパッケージも使います。 例えばSQLiteをRailsから利用するために必要な&#8221;sqlite3&#8243;パッケージもその一つです。</p></blockquote>

<p><a href="http://www.rubylife.jp/rails/ini/index2.html">引用元</a></p>

<p>Railsアプリを作成すると自動的にGemfileというファイルが作成されますが、それは 作成されたRailsアプリの動作に必要なGemパッケージ一覧を記述しておくファイルで、 このファイルがあるメリットが</p>

<ol>
<li>アプリの動作に必要なパッケージが明示的になる</li>
<li>このファイルさえ再配布してしまえば、他の環境でも一度にインストールすることができる(バージョンも含めて同じものを)</li>
<li>同じパッケージでもバージョンの違いを区別して管理することができる</li>
</ol>


<p>の三点だと認識しています。</p>

<h3>2. Bundleとは</h3>

<blockquote><p>Railsのアプリケーション開発を複数のPCで行なおうとした場合を考えてみます。 プログラムファイルはもちろんですが、全てのPCで対象のアプリケーションで使用している Gemパッケージをインストールしておかなければなりません。 またGemパッケージのバージョンも揃える必要があります。<br/>
そこで使われるのがBundlerです。 BundlerはRailsアプリケーションに必要となるGemパッケージの種類やバージョンを管理し、 複数のPCで必要なGemパッケージをインストールする仕組みを提供してくれます。</p></blockquote>

<p><a href="http://www.rubylife.jp/rails/ini/index2.html">引用元</a></p>

<p>上記であげたgem(Gemfile)のメリットの2を実現してくれるためのプログラムですね。</p>

<hr />

<p>ここでちゃんと区別しないといけないな、と理解してからようやく気がついたことが</p>

<ol>
<li>Systemの（ぼくの場合は使ってるMacbookに最初から入っていた）rubyとrbenvでインストールし 管理するrubyはたとえバージョンが同じでも違うもの</li>
<li>1と同様に、$rails -vコマンドで確認できるバージョンはデフォルトのrailsのバージョンであって 本来はGemfileに記述されているrailsのバージョンがアプリケーションの動作に利用される</li>
<li>複数のバージョンのrubyがPC上にインストールされている場合、それぞれのrubyにgemがあり、 自分が$bundle installもしくはgem install [パッケージ名]でインストールしたパッケージは そのときに利用されたrubyに対応してインストールされる。(ruby1.9.3利用時にrails3.2.13をインストールして も、ruby2.0.0でもrails3.2.13がインストールされるわけではない)</li>
</ol>


<p><strong>それじゃどのrubyのどのパッケージがインストールされてるかわからん！！！</strong></p>

<p>というわけでちゃんと確認してみます。rbenvでrubyをsystemのものに変更してから、インストールされているgemのリストを出します。</p>

<p><a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-04-at-17.17.54.png" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-04-at-17.17.54.png?resize=955%2C604" alt="Screen Shot 2013-07-04 at 17.17.54" class="alignnone size-large wp-image-636" data-recalc-dims="1" /></a></p>

<p>systemにインストールされているrubyのバージョンは1.9.3p392で、gemのリストはかなり大量に出て来ました。</p>

<p>今までこれだけでrailsアプリを作成したので、今までにインストールしたものがわちゃわちゃしてますね。</p>

<p>こんどは入れたばかりのruby2.0.0に変更して、同じことをしてみます。</p>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-04-at-17.21.24.png" rel="image_group"><img src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/07/Screen-Shot-2013-07-04-at-17.21.24.png?resize=955%2C439" alt="Screen Shot 2013-07-04 at 17.21.24" class="alignnone size-large wp-image-637" data-recalc-dims="1" /></a></p>

<p>はい、さっき(systemの)ruby1.9.3でわちゃわちゃ表示されたGem達ではなく、2.0.0に対して インストールされたGem達が表示されています</p>

<p>2.0.0を入れてから、すぐにリストを出力したので、これっぽっちです。</p>

<p>こういうことだったのね・・・とようやく理解しました・・・。</p>

<p>これで一番最初に挙げた課題は解決できそうです。(rubyのバージョンはrbenvで、GemはBundleで管理する)</p>

<p>知ってる人からしたら、本当に基礎的な話で「なにを言っているんだこいつは」となっていると思います、 ごめんなさい・・・。</p>

<hr />

<p>課題、というか疑問として</p>

<p>僕の環境では現在、systemのrubyは1.9.3でrailsは4.0.0です。 （複数バージョンのGemがインストールされている場合は最新版がデフォルトになる、っぽい・・・）</p>

<p>では、1.9.3のまま、rails3.2.13のアプリを作りたいときは、どうすればいいでしょう・・・。</p>

<p>今のところの解決方法として</p>

<ol>
<li>適当なフォルダを作成する</li>
<li>そのフォルダ内にGemfileを作成し<br/>
source &#8220;<a href="http://rubygems.org&amp;#8221;  ">http://rubygems.org&amp;#8221;  </a>
gem &#8220;rails&#8221;, &#8220;3.2.13&#8243;<br/>
を記述する</li>
<li>そこでBundle installする</li>
<li>3が終わったら、そこでbundle exec rails new [アプリ名] &#8211;skip-bundleを実行する</li>
<li>[アプリ名]フォルダが作成され、その中にrailsアプリケーションが作成されるので、フォルダごとどこかにコピーする</li>
</ol>


<p>この手順で、一応僕の環境でruby1.9.3とrails3.2.13の環境が構築されますが、1〜3の手順、やらないといけないのかな （この手順を踏まないと4.0.0のrailsアプリケーションが新規作成されてしまう）</p>

<p>んー・・・絶対何か方法あると思うんだけど・・・。</p>

<hr />

<p><a href="https://twitter.com/16bit_idol">16bit_idol</a>さんには、rbenvやbundleに関して色々教えていただきました。本当に助かりました、ありがとうございました。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/06/29/wordpress50/">[Github 検索 ソースコード]Githubのリポジトリから欲しいソースを探しまくる</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-06-29T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前回はGoogleの検索オプションに関して、ざっくり書いたんですが、プログラムを 書く身としては、よりソースコードレベルで、欲しい情報があることはよくあります。</p>

<p>公開されているソースコードはGoogle検索でも見つけることが出来ることもありますが、 公式リファレンスだと、「ちょっとこういうケースじゃないんだよなぁ・・・」ということ はあると思います。</p>

<p>そこでGitのホスティングサービスとして最も巨大なGithubの中の公開されているコードから、 自分の知りたい関数や、記法、などなどを調べることが出来て、一覧に出てきたら便利ですね</p>

<p>いつだったか忘れましたが（確か今年はじめくらい・・・？）Githubの検索機能が大幅にアップ して、ソースコード検索を簡単にできるようになりました。</p>

<p>こちらもGoogleと同じように、オプションが公開されていますので、試しながら紹介していきます。</p>

<hr />

<h2>1. 特定のユーザのリポジトリを検索する</h2>

<p>例：sample @KentaKomai</p>

<p>KentaKomaiというユーザのなかから、sampleというキーワードが 含まれるソースコードを検索します</p>

<h2>2. 特定のリポジトリから検索する</h2>

<p>例： sample repo:KentaKomai/warehouse</p>

<p>これで、KentaKomaiのwarehouseというリポジトリからsampleというキーワード が含まれるソースコードを検索します。</p>

<h2>3. 特定の拡張子を検索する</h2>

<p>例： extention:php sample</p>

<p>拡張子をphpに限定して、そのうちからsampleというキーワードを 含まれるソースコードを検索します。</p>

<h2>4. 特定のパスから検索する</h2>

<p>例： path:docs/ sample</p>

<p>リポジトリ内の docs/というディレクトリ内のsampleというキーワードを 含むソースコードを検索します。</p>

<hr />

<p>Githubの検索は</p>

<ol>
<li>リポジトリ検索</li>
<li>コード検索</li>
<li>Issue検索</li>
<li>ユーザ検索</li>
</ol>


<p><a href="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/06/Screen-Shot-2013-06-29-at-1.14.18.png" rel="image_group"><img src="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/06/Screen-Shot-2013-06-29-at-1.14.18.png?resize=955%2C913" alt="Screen Shot 2013-06-29 at 1.14.18" class="alignnone size-large wp-image-616" data-recalc-dims="1" /></a></p>

<p>の四種類があり、一度に全ての結果を表示はできないので、上記のサンプルを 試すときは、コード検索を選択してくださいね。</p>

<p>他にもユーザ自体を検索したり、ソースコードのサイズを指定したり、更新日時や、fork数、 issueの検索などなど、基本的にパブリックにされているものはなんでも検索できるみたいですが、 今回はソースコードに限定して、より使いやすいものを紹介しました。</p>

<p>Githubで新しい検索方法が実装されたときは、誤ってアップロードされたSSH秘密鍵や SQLインジェクションが通るようなコードがドンピシャで検索されたりと、色々と話題にも なったみたいですが、プログラミングする人にとって、この機能は死ぬほどありがたいですね。</p>

<p>公式リファレンス見て、「んーよくわかんねー」なんて時は、githubで実際に誰かが書いたコード をいくつか見ると、もしかしたら自分のニーズにマッチングしたものが見つかるかもしれません</p>

<p>公式のリンク貼っておきます。色々検索できて面白いです。</p>

<p><a href="https://github.com/search">Github search</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/06/29/wordpress49/">改めてGoogle検索のオプションを使いこなす（ための予習）</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-06-29T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>毎日のように利用させてもらってるGoogle検索ですが、たまに検索結果がたくさん表示されすぎて 一番欲しい情報が、埋もれてしまったり、見つからない（または見つからない情報なのかが判断できない） 場合ってよくありますよね。</p>

<p>Google検索のTOPページで、キーワードを複数入れたりして頑張るのもOKなんですが もっと効率よく検索できたらいいな、と思って検索オプションちゃんと調べてみました。</p>

<p>かなりの数のオプションがあって、全部は書ききれないですが、（あくまで僕が）よく使いそうなものを まとめてみました。 (これ書いてるとき、学校にいて、学校の回線ものすごく低速なんでイライラしてますが・・・・ｗ)</p>

<hr />

<h2>1. 通常の検索</h2>

<p>例：<strong>長澤まさみ　画像</strong></p>

<p>通常、Google検索を利用してページの検索を行うときは、単一、または複数のキーワードを入力 しますが、複数キーワードをスペースで区切って検索することをAND検索といいます。</p>

<p>ページ内のテキストやタイトル、メタ情報などに上記の例だと”長澤まさみ”と”画像”が含まれているドキュメントを 検索結果として表示します。（Google画像検索の結果も表示されます）</p>

<p>ざっくり調べて出てきた情報では、32語までキーワード指定ができるらしいです。（最新情報でない可能性があります）</p>

<h2>2. 特定のキーワードを含まないページを検索</h2>

<p>例：<strong>例外処理 -c# -java</strong></p>

<p>例外処理について調べたいので、【例外処理】でぐぐったらC#とJavaの例外処理のサンプルが表示されたのですが 「知りたいのはJavaとｃ＃以外の例外処理なんじゃ！」というときに。（わかりづらい例ですいません・・・。）</p>

<p>キーワードの前に &#8211; (ハイフン)を付けてあげると、検索結果のうち、ハイフンがつけられたキーワードが含まれるものを 除外します。</p>

<p>※これ最初は、キーワードの例は「わかりやすいように、長澤まさみで統一しよう！」と決めていたのですが オプションを付加していった結果、僕のテンションが下がる検索結果がたくさん表示されたのでやめました。 敢えてサンプルを挙げるなら「長澤まさみ　-伊勢谷 -山P」</p>

<h2>3. 複数のキーワードのうち、最低１つを含むページを検索</h2>

<p>例：<strong>のっち　OR 大本彩乃</strong></p>

<p>Perfumeの、のっち（本名：大本彩乃）について、調べたいときに。 これで調べると「のっち」、もしくは「大本彩乃」がページ内に含まれている場合にヒットします。(いずれかが含まれていればヒット)</p>

<p>他の検索方法と組み合わせて「 Perfume ( のっち OR 大本彩乃 ) 」とすると、「Perfume」というキーワードと 「のっち」か「大本彩乃」のいずれかが含まれているページがヒットします。(AND検索とOR検索を組み合わせている)</p>

<h2>4. 検索したいキーワードが複合語の場合</h2>

<p>例：<strong>&#8220;boys and girls&#8221;</strong></p>

<p>これも検索結果ですぐに効果がわかる、いい例が思いつかなかった・・・・。 例のように複合語で構成されたキーワードを検索するときは　&#8221;(ダブルクオート)でキーワードを囲むことで実現できます。</p>

<p>上記の例をダブルクオートで囲まずに「boys and girls」で検索すると、&#8221;boys&#8221;、&#8221;and&#8221;,&#8221;girls&#8221;の３単語が含まれる ページがヒットしますが、ダブルクオートで囲むことによって&#8221;boys and girls&#8221;という１つのキーワードとして検索が できます。</p>

<hr />

<p>ここまでが基本的なgoogle検索の手法になります。次項から、オプションを利用した 更に絞込みを行える検索の方法についてです。</p>

<h2>5. 特定のファイルタイプのみを検索する</h2>

<p>例：自然言語処理 filetype:pdf</p>

<p>このように検索するとPDFファイルのなかから「自然言語処理」というキーワードが含まれるのを結果として表示します。 僕の場合、オプションではこれを一番使います。filetype:オプションに対応しているのは pdf,html,htm,xml,json,phpなどなど。個人的にはjsonをよく使いますねー。</p>

<h2>6. 特定のサイト内を検索する</h2>

<p>例：<strong>range site:www.python.org/</strong></p>

<p>こうすることで<a href="http://www.python.org/%E5%86%85%E3%81%8B%E3%82%89%E3%80%8Crange%E3%80%8D%E3%81%A8%E3%81%84%E3%81%86%E3%82%AD%E3%83%BC%E3%83%AF%E3%83%BC%E3%83%89%E3%81%8C%E5%90%AB%E3%81%BE%E3%82%8C%E3%82%8B%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%92%E7%B5%90%E6%9E%9C%E3%81%A8%E3%81%97%E3%81%A6%E8%BF%94%E3%81%97%E3%81%BE%E3%81%99%E3%80%82">http://www.python.org/%E5%86%85%E3%81%8B%E3%82%89%E3%80%8Crange%E3%80%8D%E3%81%A8%E3%81%84%E3%81%86%E3%82%AD%E3%83%BC%E3%83%AF%E3%83%BC%E3%83%89%E3%81%8C%E5%90%AB%E3%81%BE%E3%82%8C%E3%82%8B%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%92%E7%B5%90%E6%9E%9C%E3%81%A8%E3%81%97%E3%81%A6%E8%BF%94%E3%81%97%E3%81%BE%E3%81%99%E3%80%82</a> よく、様々なWEBページでサイト内検索を見かけますが、それはデフォルトでこのオプションを自分のドメインに 指定されている場合がよくあります。一応このオプションを利用すれば、簡単にサイト内検索実装できますね。</p>

<h2>7. Googleのサーバ内に保存されているキャッシュを確認する</h2>

<p>例：<strong>cache:tamago.servehttp.com</strong></p>

<p>これで直接URLにアクセスするのではなく、Googleのサーバにキャッシュされているファイルを表示します。 たまにリンク切れになって見ることのできないページで、cacheを確認すると見ることができる場合があります。 見れなくても諦めずに、cacheオプションを試してみましょう。</p>

<h2>8. URLに含まれる文字を検索する</h2>

<p>例：<strong>inurl:search.php</strong></p>

<p>こうすることでURLにsearch.phpという文字列が含まれるページを結果として表示します。 特定のクエリやファイル名をURLにそのまま使ってるページなんかを探すときにいいかもしれません。 filetypeと組み合わせると、URLをだいぶ絞り込めそうです。</p>

<hr />

<p>僕が比較的よく使うなー、っていうのは以上です。他にもいくつかオプションがあったり、計算機になったり 天気や株価がすぐにチェックできたりするので、色々試すと面白いかもしれません。</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/4/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/2/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/12/08/octopressniyi-xing-sitemimasita/">Octopressに移行してみました</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/28/wordpress77/">簡易プロセス死活監視プログラムをc#で</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/25/wordpress76/">xv6のソースコードとテキストを読んでみる1_chapter0_2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/19/wordpress75/">[CSCamp CTF]解けなかった問題forensics1のwriteupを読んでみた</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/18/wordpress74/">Vagrant + Chef solo + Berkshelfを試してみたのでまとめ</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/KentaKomai">@KentaKomai</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'KentaKomai',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 -  Kenta Komai <br/>
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> + <a href="https://github.com/ioveracker/mnml">mnml</a>.
	  
  </span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
