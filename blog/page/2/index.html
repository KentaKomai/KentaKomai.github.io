
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>KentaKomai's BLOG</title>
  <meta name="author" content="Kenta Komai">

  
  <meta name="description" content="今更だけどタイトルとおりです。 MacでもWindowsxでもLinuxでもできます。 僕もそうですが、Firefox + firebugから移行した開発者の方も多いんじゃないかと 思います。 デフォルトだとこんな感じ いじくるとこんな感じ 変更は簡単です。 Chrome Developer &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://KentaKomai.github.io/blog/page/2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="KentaKomai's BLOG" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46297904-1', 'tamago-mago-mago.com');
  ga('send', 'pageview');

  </script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46297904-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner">
	<div class="header-title"><a href="/">KentaKomai's BLOG</a></div>


	<br><div class="header-subtitle">自分用備忘録の延長</div>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss email">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
    <li><a href="kaede06152000@gmail.com" rel="subscribe-email" title="subscribe via email">Email</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:KentaKomai.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/10/10/wordpress68/">Google Chrome Developer Toolsの見た目を変える。</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-10-10T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今更だけどタイトルとおりです。</p>

<p>MacでもWindowsxでもLinuxでもできます。</p>

<p>僕もそうですが、Firefox + firebugから移行した開発者の方も多いんじゃないかと 思います。</p>

<p>デフォルトだとこんな感じ</p>

<p><a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/10/Screen-Shot-2013-10-10-at-15.48.43.png" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/10/Screen-Shot-2013-10-10-at-15.48.43.png?resize=955%2C892" alt="Screen Shot 2013-10-10 at 15.48.43" class="alignnone size-large wp-image-896" data-recalc-dims="1" /></a></p>

<p>いじくるとこんな感じ</p>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/10/Screen-Shot-2013-10-10-at-16.03.06.png" rel="image_group"><img src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/10/Screen-Shot-2013-10-10-at-16.03.06.png?resize=937%2C1024" alt="Screen Shot 2013-10-10 at 16.03.06" class="alignnone size-large wp-image-897" data-recalc-dims="1" /></a></p>

<p>変更は簡単です。</p>

<p>Chrome Developer Toolsの見た目もスタイルシートで定義が可能です。 それぞれの環境で以下のパスが対象ファイルになります。 おそらくデフォルトでは中身はからっぽ。</p>

<ul>
<li>windows: C:/Users/YourUsername/AppData/Local/Google/Chrome/User Data/Default/User StyleSheets/Custom.css</li>
<li>Mac: ~/Library/Application Support/Google/Chrome/Default/User StyleSheets/Custom.css</li>
<li>ubuntu: ~/.config/chromium/Default/User StyleSheets/Custom.css</li>
</ul>


<p>※ちなみに僕はchromium,ironを利用しているので、そういった方は パスの&#8221;Google/Chrome&#8221;の部分は&#8221;chromium&#8221;を置換えれば同じようにスタイルの変更ができます。</p>

<p>Githubにはいろんな人が作ったテーマが公開されています。 これらを使えば簡単にかっこよくできます。</p>

<p><a href="https://github.com/search?p=2&amp;q=Chrome+developer+tools+Custom.css+extension%3Acss&amp;ref=searchresults&amp;type=Code">Github search(関係ないファイルもいっぱい検索ひっかっかってますが・・・)</a></p>

<p>Chrome Develper Toolsを多用するかたは是非。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/10/02/wordpress67/">UPXによるパックとアンパックとか</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-10-02T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>バイナリやリバースエンジニアリングの入門書には 必ずといっていいほど取り上げられているパッカーUPXに関しての 使い方やアンパックの方法なんかをまとめてみます。</p>

<h3>1.参考リンク</h3>

<ul>
<li><a href="http://upx.sourceforge.net/">UPX 公式</a></li>
<li><a href="http://ja.wikipedia.org/wiki/UPX">UPX -wikipedia-</a></li>
<li><a href="http://linux.die.net/man/1/upx">UPX(1) Linux man page</a></li>
</ul>


<h3>2.概要(wikipediaより引用)</h3>

<p>※より詳しい内容はwikipediaを参照してください</p>

<blockquote><p>UPX (ultimate packer for executables)は様々なOSのファイル形式に対応した FLOSSの実行ファイル圧縮ソフトウェアである。</p></blockquote>

<ul>
<li>圧縮にはUCLと呼ばれるデータ圧縮アルゴリズムを用いてる</li>
<li>UCLは解凍用のコードがわずか数百バイトで実装できるようなシンプルな設計となっている。UCLは解凍のための追加のメモリ割り当てを要求しない。このことはUPXで圧縮された実行ファイルが余計なメモリを要求しないことを意味し、明確な優位点となっている。</li>
<li>UPX(2.90 beta以上)では多くのプラットフォームでLZMAが利用可能になっている。</li>
</ul>


<h4>サポートされているフォーマット</h4>

<ul>
<li>ARM/PE</li>
<li>Atari/tos</li>
<li>*BSD/i386</li>
<li>djgpp2/COFF</li>
<li>dos/com</li>
<li>dos/exe</li>
<li>dos/sys</li>
<li>Linux/i386 a.out</li>
<li>i386、x86-64、ARM、PowerPC上のLinux/ELF</li>
<li>i386、x86-64、ARM上のLinux/kernel</li>
<li>Mach-O/ppc32、Mach-O/i386 (Google Goを用いて生成されたものを除く)</li>
<li>rtm32/PE</li>
<li>tmt/adam</li>
<li>PlayStation1/exe</li>
<li>Watcom/le</li>
<li>Win32/PE (.NET Frameworkを用いて作られたファイルを除く)</li>
</ul>


<p>プレステの実行ファイルもかよ！！！</p>

<h4>※補足リンク</h4>

<ul>
<li><a href="http://ja.wikipedia.org/wiki/%E3%83%87%E3%83%BC%E3%82%BF%E5%9C%A7%E7%B8%AE">データ圧縮 -wikipedia-</a></li>
<li><a href="http://ja.wikipedia.org/wiki/LZMA">LZMA -wikipedia-</a></li>
</ul>


<h3>3.実行ファイルをパックしてみる</h3>

<p><a href="http://linux.die.net/man/1/upx">UPX(1) Linux man page</a>より引用</p>

<blockquote><p>Compress: This is the default operation, eg. upx yourfile.exe will compress the file specified on the command line.</p></blockquote>

<p>簡単ですね</p>

<pre>$ upx [filepath]
</pre>


<p>upxコマンド(winならupx.exe)の引数に圧縮したいファイルパスを指定して実行するだけ</p>

<p>サンプルコードはこちら。めっちゃ単純。</p>

<p>&lt;</p>

<p>pre></p>

<h1>include &lt;stdio.h></h1>

<p>int main(int argc, char *argv[]){</p>

<pre><code>int i = 0;
int a = 1;

for(i=0; i&lt;30; i++){
    printf("index:%d\n", i);
}

if(a){
    printf("true");
}else{
    printf("false");
}
</code></pre>

<p>} </pre></p>

<p>これを普通にコンパイルして、ファイルサイズを見てみます。</p>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/10/compile_before_pack.png" rel="image_group"><img src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/10/compile_before_pack.png?resize=639%2C186" alt="compile_before_pack" class="alignnone size-full wp-image-884" data-recalc-dims="1" /></a></p>

<p>約48KBです。 ollydbgでアセンブリコードも見てみます。(実行ファイル全体じゃなくて、 ソースコードに対応する箇所だけ)</p>

<p>ソースコードにそのまんま対応しているのがわかると思います。</p>

<pre>0040138C  /$ 55             PUSH EBP
0040138D  |. 89E5           MOV EBP,ESP
0040138F  |. 83E4 F0        AND ESP,FFFFFFF0
00401392  |. 83EC 20        SUB ESP,20
00401395  |. E8 7A050000    CALL upx_samp.00401914
0040139A  |. C74424 1C 0000>MOV DWORD PTR SS:[ESP+1C],0
004013A2  |. C74424 18 0100>MOV DWORD PTR SS:[ESP+18],1
004013AA  |. C74424 1C 0000>MOV DWORD PTR SS:[ESP+1C],0
004013B2  |. EB 18          JMP SHORT upx_samp.004013CC
004013B4  |> 8B4424 1C      /MOV EAX,DWORD PTR SS:[ESP+1C]           ; |
004013B8  |. 894424 04      |MOV DWORD PTR SS:[ESP+4],EAX            ; |
004013BC  |. C70424 6430400>|MOV DWORD PTR SS:[ESP],upx_samp.0040306>; |ASCII "index:%d"
004013C3  |. E8 84070000    |CALL &lt;JMP.&#038;msvcrt.printf>               ; \printf
004013C8  |. FF4424 1C      |INC DWORD PTR SS:[ESP+1C]
004013CC  |> 837C24 1C 1D    CMP DWORD PTR SS:[ESP+1C],1D            ; |
004013D1  |.^7E E1          \JLE SHORT upx_samp.004013B4             ; |
004013D3  |. 837C24 18 00   CMP DWORD PTR SS:[ESP+18],0              ; |
004013D8  |. 74 0E          JE SHORT upx_samp.004013E8               ; |
004013DA  |. C70424 6E30400>MOV DWORD PTR SS:[ESP],upx_samp.0040306E ; |ASCII "true"
004013E1  |. E8 66070000    CALL &lt;JMP.&#038;msvcrt.printf>                ; \printf
004013E6  |. EB 0C          JMP SHORT upx_samp.004013F4
004013E8  |> C70424 7330400>MOV DWORD PTR SS:[ESP],upx_samp.00403073 ; |ASCII "false"
004013EF  |. E8 58070000    CALL &lt;JMP.&#038;msvcrt.printf>                ; \printf
004013F4  |> C9             LEAVE
004013F5  \. C3             RETN
</pre>


<p>IDAで実行ファイルを解析してみた図がこちら。</p>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/10/before_pack_ida.png" rel="image_group"><img src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/10/before_pack_ida.png?resize=955%2C698" alt="before_pack_ida" class="alignnone size-large wp-image-885" data-recalc-dims="1" /></a></p>

<p>こちらもパッと見でちゃんとソースコードが対応しているのがわかります。 問題なさそうなので、こちらをパックしてみます。</p>

<p><a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/10/pack_exe.png" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/10/pack_exe.png?resize=644%2C211" alt="pack_exe" class="alignnone size-full wp-image-886" data-recalc-dims="1" /></a></p>

<p>ファイルサイズが48kBから約29kBまで圧縮されました。わお。</p>

<p>まずはollydbgで見てみます、が。 さっきのような関数呼び出しや、文字列が見当たらない・・・・。</p>

<p>IDAで見てみると、パック前とくらべて半端じゃなく複雑になったことが わかると思います。</p>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/10/packed_exe.png" rel="image_group"><img src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/10/packed_exe.png?resize=955%2C706" alt="packed_exe" class="alignnone size-large wp-image-887" data-recalc-dims="1" /></a></p>

<p>UPXはupx.exe自体でアンパックもサポートしている上に、アルゴリズムも 単純で手動アンパックも比較的容易ですが、アセンブリコードやバイナリだけを 見れば、圧縮・そして難読化されていることが確認できると思います。</p>

<h3>4.実行ファイルをアンパックしてみる</h3>

<p><a href="http://linux.die.net/man/1/upx">UPX(1) Linux man page</a>より引用</p>

<blockquote><p>Decompress: All UPX supported file formats can be unpacked using the -d switch, eg. upx -d yourfile.exe will uncompress the file you&rsquo;ve just compressed.</p></blockquote>

<p>こちらも簡単。-dオプションをつけて、UPXでパックされてるファイルの パスを渡すだけ。</p>

<p><a href="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/10/unpacke_exe.png" rel="image_group"><img src="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/10/unpacke_exe.png?resize=644%2C208" alt="unpacke_exe" class="alignnone size-full wp-image-888" data-recalc-dims="1" /></a></p>

<p>ファイルサイズが元通りになってますね。 スクリーンショット撮り忘れちゃいましたが、バイナリもIDAやollydbgで ちゃんと読めるようになってます。</p>

<h3>5.upx.exeなしで手動アンパックしてみる</h3>

<p>手順としては以下の通りです。詳細を書こうとおもったんだけど 参考にしてた本、何冊かに載ってた通りにしても再現できなかったので、ざっくり手順だけ</p>

<ol>
<li>パックされた実行ファイルをollydbgにアタッチする</li>
<li>PUSHAD命令に対応するPOPAD命令を見つけてそこにブレークポイント仕掛ける</li>
<li>POPAD命令でブレークしたら、そこからステップ実行を進めて、CALL命令見つける。</li>
<li>CALL命令で移動した先で、プログラムを一時停止</li>
<li>ollydump（Method2:Search DLL &amp; API name string in dumped file）でダンプ</li>
</ol>


<p>これだけ。4のCALL命令は僕の環境だといくつかあって、CALL命令のジャンプ先で ollydumpすれば、どれかしら正解で普通に実行できます。</p>

<p>ちゃーんと読めば、ピンポイントでダンプできると思うんですが、環境によって違うので うまく書けない・・・。</p>

<p>説明できることがあれば、改めてまとめたいと思います。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/10/01/wordpress66/">たのしいバイナリの歩き方、読みました</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-10-01T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>とても読みやすく、わかり易かったです。</p>

<p><a href="http://www.amazon.co.jp/%E3%81%9F%E3%81%AE%E3%81%97%E3%81%84%E3%83%90%E3%82%A4%E3%83%8A%E3%83%AA%E3%81%AE%E6%AD%A9%E3%81%8D%E6%96%B9-%E6%84%9B%E7%94%B2-%E5%81%A5%E4%BA%8C/dp/4774159182">たのしいバイナリの歩き方 amazon</a></p>

<p>簡単ではあるけど、Metasploitの使い方も載っているのは珍しいと思います。 （オライリーの実践Metasploitとハッカージャパン以外で、僕は初めて読みました。）</p>

<p>簡単なC言語の構文をアセンブラにして、読み解くところから始まり、 シューティングゲームのチート、バッファオーバーフローの解説、簡易デバッガ自作、 エクスプロイトコード作成やマルウェア解析のためのツール紹介、 最後に各種ソフトウェアのインストール方法と続いています。</p>

<p>僕個人が書き残しておきたい部分だけをピックアップしてまとめておきます。</p>

<h3>0. 僕が開発ではあんまり見ないけど、便利だなーと思ったソースコード</h3>

<ul>
<li>[c++] execve()によるshell起動</li>
<li>[c++] <strong>asm</strong>()によるインラインアセンブラ</li>
<li>[c++] fprintf()で汎用的な出力(標準出力に限定しない)</li>
<li>[python] python -c &#8220;python code&#8221;でワンライナー</li>
</ul>


<h3>1. ASLR(Address Space Layout Randomization)のon/off</h3>

<p><a href="http://itpro.nikkeibp.co.jp/article/Keyword/20070527/272583/">ASLRとは</a></p>

<blockquote><p>メモリー領域に格納するデータのアドレスをランダム化すること。 セキュリティ技術の一つで、Linuxをはじめ、Windows Vistaでも採用されている。 主にバッファ・オーバーフロー攻撃の対策として利用される。</p></blockquote>

<ol>
<li>[Ubuntu] $ sudo echo 0 > /proc/sys/kernel/randomize&#95;va&#95;space</li>
<li>[CentOS] # echo 0 > /proc/sys/kernel/randomize&#95;va&#95;space</li>
</ol>


<h4>補足 Exec-Shildのon/off</h4>

<p><a href="http://itpro.nikkeibp.co.jp/article/Keyword/20070622/275594/">Exec-Shieldとは</a></p>

<blockquote><p>特定のメモリー領域から命令を実行できないようにするLinuxの機能。 不正侵入を行う手段の1つである、バッファ・オーバーフロ－攻撃に対して有効な防御機能である。</p></blockquote>

<ol>
<li>[Ubuntu] $ sudo echo 0 > /proc/sys/kernel/exec-shield</li>
<li>[CentOS] # echo 0 > /proc/sys/kernel/exec-shield</li>
</ol>


<h3>2. UPXによるパックとアンパック</h3>

<p>詳細は別の記事にちゃんとまとめたいと思ってるので、ざっくりと。</p>

<p><a href="http://upx.sourceforge.net/">UPX公式</a></p>

<p><a href="http://ja.wikipedia.org/wiki/UPX">UPX -wikipedia</a></p>

<blockquote><p>UPX (ultimate packer for executables)は様々なOSのファイル形式に対応した FLOSSの実行ファイル圧縮ソフトウェアである。</p></blockquote>

<p>実行ファイルを実行可能なまま圧縮する美味しい技術。 Ultimate Packer for eXecutablesの略。</p>

<p>使い方</p>

<ol>
<li>UPXによる圧縮：upx.exe [ファイルパス]</li>
<li>UPXに圧縮されたファイルの復元：upx.exe -d [ファイルパス]</li>
</ol>


<p>※-dの『d』はdecompressの略なんですね。unpackなんだから-uのほうが わかりやすいのになー、と勘違いしてた。</p>

<h3>3. デバッガに利用されるAPIや構造体</h3>

<p>ここに全部詳細を列挙すると結構な量になるので構造体と関数名だけでも</p>

<ul>
<li>PROCESS&#95;INFORMATION構造体</li>
<li>STARTUPINFO構造体</li>
<li>DEBUG&#95;EVENT構造体</li>
<li>CreateProcess()関数：プロセスの新規作成</li>
<li>Resume&#95;Thread()関数：スレッドを動作させる</li>
<li>WaitForDebugEvent()関数：デバッグ中のプロセスの監視</li>
</ul>


<p>※他にもありますが、とりあえず基本的な骨組みに利用されているのはこちら</p>

<h3>4. コードインジェクションとDLLインジェクション</h3>

<p>どちらも他のプロセス内で任意のコードを実行させる手法</p>

<p>正直、読んでも現状『ふーん・・・すげぇ』程度で僕がちゃんと理解して 実践できるかと言えば全然です・・・。ここは色々勉強してから もう一度読み直したいです。</p>

<ul>
<li>SetWindowsHookEx()関数</li>
<li>CallNextHookEx()関数</li>
<li>UnhookWindowsHookEx()関数</li>
<li>CreateRemoteThread()関数：他プロセス内でスレッドを生成する(LoadLibraryをスレッドとして実行させて強制的にDLLをロードさせる)</li>
<li>AppInit&#95;DLLsレジストリ：OS起動直後から任意のDLLを他のプロセスへロード可能になる</li>
</ul>


<p>ここは後でちゃんともう一回やってまとめます。</p>

<h3>5. APIフック</h3>

<p>プロセス内で任意のコードを実行する手法であることはコードインジェクションと 同じだが、特にAPIに任意の独自処理を追加することを『APIフック』と呼ぶ</p>

<p>APIフックには２つのタイプがある</p>

<ol>
<li>対象APIの先頭数バイトを書き換えるタイプ</li>
<li>IAT(Import Address Table)を書き換えるタイプ</li>
</ol>


<p>本書ではMicrosoftリサーチチームがリリースしている Detoursというライブラリを用いたサンプルが紹介されています。</p>

<hr />

<p>僕が読んで特に勉強になった箇所を覚書しておきました。 難しい手法を、わかりやすく解説してあり、非常に読みやすかったです。</p>

<h5>補足リンク</h5>

<p><a href="http://msdn.microsoft.com/ja-jp/library/aa384264(v=vs.85).aspx">windows 新しい型 msdn</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/09/09/wordpress65/">Git Flowとgithub Flowざっくりまとめ</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-09-09T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近学校のチーム制作で、gitを使うことになったので 前半は復習も兼ねてgitそのものの基礎的なコマンドや参考リンクの紹介</p>

<p>後半はタイトルとおり、注目されているリポジトリモデルである git flowと、それを簡易的に発展させたgithub flowの簡単な内容を 確認したいと思います。</p>

<h2>1.gitの基礎と使い方</h2>

<p><strong>参考リンク</strong><br/>
* <a href="http://ja.wikipedia.org/wiki/Git">wikipedia git</a><br/>
* <a href="http://git-scm.com/book/ja">Pro git 和訳</a><br/>
* <a href="http://sourceforge.jp/magazine/09/03/16/0831212">gitを使いこなすために20のコマンド</a></p>

<p><strong>概要</strong></p>

<ol>
<li>Linuxの開発者リーナス・トーバルズが開発</li>
<li>分散型バージョン管理システム（svnは集中型）</li>
<li>ネットワークにつながっていないときでも、ログの確認、コミットが可能</li>
<li>代表的なweb上のgitホスティングサービスとしてgithub, bitbucket, 国内ならgitbreakなど。</li>
</ol>


<p><strong>超基本的な使い方</strong></p>

<ol>
<li>git clone &#91;gitのアドレス&#93; で既存リポジトリを自分の環境にコピー</li>
<li>ソースコードを編集</li>
<li>git statusで変更を確認</li>
<li>git add &#91;ソースコードのパス&#93; でコミットするファイルを明示する</li>
<li>git commit -m &#8216;コミットコメント&#8217; でaddしたファイルの変更点をローカルリポジトリにコミット</li>
<li>git push &#91;送信先リモートリポジトリ名&#93; &#91;送信先ブランチ名&#93; でリモートリポジトリに変更点を送信</li>
<li>2-6を繰り返す</li>
</ol>


<p>これが最低限必要なコマンド（だと思います） これ以外だと</p>

<ul>
<li>git diff</li>
<li>git log</li>
<li>git reset</li>
<li>git branch</li>
<li>git merge</li>
<li>git checkout</li>
<li>git init</li>
</ul>


<p>とかが慣れてきてから使えれば、まぁいいと思います。</p>

<p>僕の個人的な意見としては、上記の1-7の流れ程度はコマンドラインから行えることが 最低限だけど、それ以外は各種GUIクライアントを利用したほうが、楽だし効率もいいかな と思ってます。GUIで確認できるコミットログや、brunchのツリーなんかは CUIでは体感できないものかな、と思います。</p>

<p>代表的なクライアントにはsmartGitや、sourceTreeなど。 githubも公式でクライアントをリリースしています。</p>

<ul>
<li><a href="http://www.syntevo.com/smartgithg/">smartGit</a></li>
<li><a href="http://www.sourcetreeapp.com/">sourceTree</a></li>
<li><a href="http://mac.github.com/">github for mac</a></li>
<li><a href="http://windows.github.com/">github for windows</a></li>
</ul>


<p>このブログのメインであるgit flowに関しては、このうちsourceTreeのみ アプリケーション内で、git flowに関する機能を補完してくれる 機能を備えています。 （もちろん補完されないだけで、どのクライアントでもCUIでもgit flowは 使えます。）</p>

<h2>2.git-flowとは</h2>

<p><strong>参考リンク</strong></p>

<ul>
<li><a href="http://nvie.com/posts/a-successful-git-branching-model/">A successful Git branch (git flow 原典)</a></li>
<li><a href="http://danielkummer.github.io/git-flow-cheatsheet/index.ja_JP.html">Git flow cheat seat (日本語)</a></li>
<li><a href="http://www.slideshare.net/KatokichiSoft/git-flow-16616440">Git flowの活用事例 (slideshare)</a></li>
</ul>


<p><strong>概要</strong></p>

<p>ちゃんとした内容は原典や参考リンクを読んでいただければと思いますが ざっくりと説明すると</p>

<ul>
<li>Gitにおけるリポジトリのモデル（こんなふうにbrunchを切って運用すれば便利じゃね？みたいな感じ）</li>
<li>Git flowというコマンドを別途インストールするかsourceTreeの機能を利用すると簡単に実現できる（しなくても運用で実現は可能）</li>
<li>Git flowのリポジトリモデルをそのまま用いず、各所でカスタマイズして利用されている(参考リンク参照)</li>
<li>メインのmasterブランチ、developブランチを主軸に、feature,release,hotfixの補助的なbrunch群で構成される</li>
<li>masterブランチは常にリリースできる状態、開発はdevelpブランチから、更にブランチを作成して行う。(それがfeature,release,hotfix)</li>
<li>featureは機能追加のためのブランチ(通常時はこれがメインになるのかな？)</li>
<li>releaseはリリース直前のためのブランチ</li>
<li>hotfixはリリース直後の緊急対応用のブランチ</li>
</ul>


<p>こんな感じ</p>

<p>基本的な流れは</p>

<ol>
<li>developをベースに開発用ブランチを作成して（これがfeatureにあたる）開発者それぞれが開発をスタート</li>
<li>他の人が開発したコードを自分の開発用ブランチにマージ</li>
<li>開発が終われば編集内容をdevelopにマージして、開発者用ブランチを削除</li>
<li>developブランチをremoteブランチにpush</li>
<li>1-4を繰り返して開発を進める</li>
<li>開発が終了したらリリースのための作業を始める(developをベースにreleaseブランチを利用、 軽微なバグフィックス、リリース向けのコードや設定の編集)</li>
<li>releaseの編集を終えたら、developとmasterに内容をマージして、releaseブランチを削除</li>
<li>リリースを行う(masterブランチのデプロイ)</li>
<li>リリース後に、緊急バグが発生したらmasterをベースにhotfixブランチを作成し、対応</li>
<li>対応できたらmasterにマージし、hotfixブランチを削除</li>
<li>1-10を繰り返してバージョン管理を運用する</li>
</ol>


<p>こんな感じです。developをベースに作成したブランチで基本的に作業を行い、完了したらマージしてブランチ削除、が 基本的な流れです。 developやmasterのコードを直接編集してはいけません。あくまでベースになり、マージ対象になるだけ。</p>

<h2>3.github-flowとは</h2>

<p><strong>参考リンク</strong></p>

<ul>
<li><a href="http://scottchacon.com/2011/08/31/github-flow.html">GitHub Flow (原典)</a></li>
<li><a href="https://gist.github.com/Gab-km/3705015">GitHub Flow (Japanese translation)</a></li>
</ul>


<p>github内（サービスではなくてgithub開発チームの内部、という意味）で運用されている git-flowをベースにしたリポジトリモデルです。</p>

<p>githubの中の人であるscott chacon氏はgit flowを『I always answer that I think that it’s great ( (git flowについて聞かれたときに)素晴らしいものであると、いつも答えている)』 としながらも、ふたつの短所をあげています。</p>

<ol>
<li>ほとんどのチームや開発者が実際に必要とするよりも複雑すぎではないか</li>
<li>1の複雑な操作をGUIツールに操作を強制することができず、 CUIで全操作を行う必要がある(現在はsource treeがあるので、一応GUIでも操作できるけど)</li>
</ol>


<p>これをより単純にすることで解決したものが、github flowらしいです。</p>

<p><strong>特徴</strong></p>

<ul>
<li>masterブランチは常にデプロイ可能な状態にしておく</li>
<li>新しい開発などは、masterからブランチを作成して名前をつけ、そこで行う</li>
<li>作成したブランチにローカルでコミットし、サーバー上の同じ名前のブランチにも定期的に作業内容をpushする</li>
<li>フィードバックや助言が欲しい時、ブランチをマージしてもよいと思ったときは、 プルリクエスト を作成する</li>
<li>他の誰かがレビューをして機能にOKを出してくれたら、あなたはコードをmasterへマージすることができる</li>
<li>マージをしてmasterへpushしたら、直ちにデプロイをする</li>
</ul>


<p>これだけですね。developブランチという概念がなくなったこと、プルリクエストというgithubの独自機能 が運用に用いられていることが、git flowとの大きな違いです。</p>

<p>僕が思う、github flowのもうひとつのメリットとして</p>

<p><strong>プレビュー前にmasterへのマージが発生しない</strong></p>

<p>ということです。これならだれでも気軽に、開発を行い、プルリクエストをして、上級者からのレビューを受けることが 可能になります。（そうすることが上級者にも強制される）</p>

<p>レビューやテストが重要視される昨今にマッチしたモデルであると個人的には思います。</p>

<hr />

<p>git flowは各所で賞賛され、利用されているモデルではあるみたいですが、やはり銀の弾丸ではないので、 プロジェクトや企業によって、カスタマイズされている場合も多くあるようです。</p>

<p>ぼくは　git flowを知るまでは、ブランチをモデル化して運用する、ということすら 考えがなかったので、とても勉強になりました。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/08/31/wordpress64/">[C言語]コールスタック(スタックフレーム)の仕組みを復習する</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-08-31T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>何冊か本を読んだんですが、しっくり来ないのと、 すこし間があくとすぐに忘れてしまうので 自分の中で整理します。</p>

<p>コールスタックとは</p>

<p><a href="http://ja.wikipedia.org/wiki/%E3%82%B3%E3%83%BC%E3%83%AB%E3%82%B9%E3%82%BF%E3%83%83%E3%82%AF">コールスタック -wikipedia-</a>より引用</p>

<p><a href="http://www.asahi-net.or.jp/~wg5k-ickw/html/online/gdb-5.0/gdb-ja_7.html">スタックの検査 -gdb-</a></p>

<blockquote><p>コールスタック (Call Stack)は、プログラムの実行中にサブルーチンに関する情報を格納するスタックである。 実行中のサブルーチンとは、呼び出されたが処理を完了していないサブルーチンを意味する。 実行スタック (Execution Stack)、制御スタック (Control Stack)、関数スタック (Function Stack)など とも呼ばれる。 また、単に「スタック」と言ったときにコールスタックを指していることが多い。 コールスタックを正しく保つことは多くのソフトウェアが正常動作するのに重要であり、 その内容は高水準言語にとっても同じである。</p></blockquote>

<p>つまり、関数の中で関数が呼ばれたときなんかに、 プログラム自体が、次にどこを実行すればいいかわからなくならないように、 きちんと体系的に整理した仕組みで、現在実用されているのがコールスタック ということで大丈夫でしょうか。</p>

<p>第一段階として、main()関数のみの単純なプログラム</p>

<pre>#include &lt;stdio.h>
int main(int argc, char *argv[]){
    int a = 10;
    int b = 20;
    int c = 30;

    return 0;
}
</pre>


<p>実行すれば</p>

<pre>a=10, b=20, c=30
</pre>


<p>と表示されるだけのシンプルなものです。</p>

<p>MACのアセンブラ長くてめんどくさそうだったのでLinux(ubuntu)で コンパイルしたものを用意しました。</p>

<p><a href="https://github.com/KentaKomai/warehouse/blob/master/callstack/sample1.c">sample1.c</a></p>

<p><a href="https://github.com/KentaKomai/warehouse/blob/master/callstack/lnx_sample1.s">sample1.s</a></p>

<p>変数宣言をするだけのプログラムです。それ以外は何もしません。</p>

<p>それをアセンブラにしたソースが上です。</p>

<pre>.file   "sample1.c"
    .text
    .globl  main
    .type   main, @function
main:
.LFB0:
    .cfi_startproc
    pushl   %ebp
    .cfi_def_cfa_offset 8
    .cfi_offset 5, -8
    movl    %esp, %ebp
    .cfi_def_cfa_register 5
    subl    $16, %esp
    movl    $10, -12(%ebp)
    movl    $20, -8(%ebp)
    movl    $30, -4(%ebp)
    movl    $0, %eax
    leave
    .cfi_restore 5
    .cfi_def_cfa 4, 4
    ret
    .cfi_endproc
.LFE0:
    .size   main, .-main
    .ident  "GCC: (Ubuntu/Linaro 4.6.3-1ubuntu5) 4.6.3"
    .section    .note.GNU-stack,"",@progbits
</pre>


<p>.cfiなんちゃらは無視してOKです。</p>

<p>このmain()関数のスタックフレームは</p>

<pre>subl    $16, %esp
    movl    $10, -12(%ebp)
    movl    $20, -8(%ebp)
    movl    $30, -4(%ebp)
</pre>


<p>これによって確保されているようです。 16byte分espが減らされて、ebpから数えてうえから順番に 値(a=10, b=20, c=30)がそれぞれアドレス内に確保されています。</p>

<p>return 0の直前でブレイクさせた状態の情報</p>

<p><a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/Screen-Shot-2013-08-31-at-3.59.48.png" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/Screen-Shot-2013-08-31-at-3.59.48.png?resize=955%2C209" alt="Screen Shot 2013-08-31 at 3.59.48" class="alignnone size-large wp-image-837" data-recalc-dims="1" /></a></p>

<p>次は、簡単な関数を作成してmain()から呼び出してみます。</p>

<pre>#include &lt;stdio.h>
int add(a, b, c){
    int ret = a + b + c;
    return ret;
}

int main(int argc, char *argv[]){
    int a = 10;
    int b = 20;
    int c = 30;
    int d = add(a,b,c);

    printf("a+b+c=%d\n", d);

    return 0;
}
</pre>


<p>アセンブラにしたものがこちら</p>

<pre>.file   "sample2.c"
    .text
    .globl  add
    .type   add, @function
add:
.LFB0:
    .cfi_startproc
    pushl   %ebp
    .cfi_def_cfa_offset 8
    .cfi_offset 5, -8
    movl    %esp, %ebp
    .cfi_def_cfa_register 5
    subl    $16, %esp
    movl    12(%ebp), %eax
    movl    8(%ebp), %edx
    addl    %edx, %eax
    addl    16(%ebp), %eax
    movl    %eax, -4(%ebp)
    movl    -4(%ebp), %eax
    leave
    .cfi_restore 5
    .cfi_def_cfa 4, 4
    ret
    .cfi_endproc
.LFE0:
    .size   add, .-add
    .section    .rodata
.LC0:
    .string "a+b+c=%d\n"
    .text
    .globl  main
    .type   main, @function
main:
.LFB1:
    .cfi_startproc
    pushl   %ebp
    .cfi_def_cfa_offset 8
    .cfi_offset 5, -8
    movl    %esp, %ebp
    .cfi_def_cfa_register 5
    andl    $-16, %esp
    subl    $32, %esp
    movl    $10, 16(%esp) ;main()変数a
    movl    $20, 20(%esp) ;main()変数b
    movl    $30, 24(%esp) ;main()変数c
    movl    24(%esp), %eax
    movl    %eax, 8(%esp)  ;add()仮引数c
    movl    20(%esp), %eax 
    movl    %eax, 4(%esp)  ;add()仮引数b
    movl    16(%esp), %eax
    movl    %eax, (%esp)   ;add()仮引数a
    call    add 
    movl    %eax, 28(%esp)
    movl    $.LC0, %eax
    movl    28(%esp), %edx
    movl    %edx, 4(%esp)
    movl    %eax, (%esp)
    call    printf
    movl    $0, %eax
    leave
    .cfi_restore 5
    .cfi_def_cfa 4, 4
    ret
    .cfi_endproc
.LFE1:
    .size   main, .-main
    .ident  "GCC: (Ubuntu/Linaro 4.6.3-1ubuntu5) 4.6.3"
    .section    .note.GNU-stack,"",@progbits
</pre>


<p>main()とadd()に対応したアセンブラのコードがそれぞれありますね。</p>

<pre>movl    24(%esp), %eax
    movl    %eax, 8(%esp)  ;add()仮引数c
    movl    20(%esp), %eax 
    movl    %eax, 4(%esp)  ;add()仮引数b
    movl    16(%esp), %eax
    movl    %eax, (%esp)   ;add()仮引数a
    call    add 
</pre>


<p>ここがadd()呼び出しの箇所。 引数は後ろからスタックに入れているのがわかります。</p>

<p>この段階では、ソースを見る限りでは</p>

<pre>10  ;esp     add()の仮引数a
20  ;esp + 4 add()の仮引数b
30  ;esp + 8 add()の仮引数c

10  ;esp + 16 main()のa
20  ;esp + 20 main()のb
30  ;esp + 24 main()のc

</pre>


<p>となっています。これがadd()関数呼び出し前の状態(この状態が重要です。)</p>

<p>callでは、関数を呼び出すのと同時に、呼び出された関数が終了した後に、 どこから処理を再開するべきかのアドレス（リターンアドレス）をスタックにプッシュします。 それに伴い、$espも-4されます。</p>

<p>つまりcallされたときのスタックの状態は</p>

<pre>リターンアドレス ;esp
10  ;esp + 4 add()の仮引数a
20  ;esp + 8 add()の仮引数b
30  ;esp + 12 add()の仮引数c

10  ;esp + 20
20  ;esp + 24
30  ;esp + 28

</pre>


<p>となっています。 add関数に入ると、スタックフレームが構築され、関数の処理が実行できるようになります。</p>

<pre>add:
.LFB0:
    .cfi_startproc
    pushl   %ebp            ;準備
    .cfi_def_cfa_offset 8
    .cfi_offset 5, -8
    movl    %esp, %ebp      ;準備
    .cfi_def_cfa_register 5
    subl    $16, %esp       ;準備
    movl    12(%ebp), %eax
    movl    8(%ebp), %edx
    addl    %edx, %eax
    addl    16(%ebp), %eax
    movl    %eax, -4(%ebp)
    movl    -4(%ebp), %eax
    leave
    .cfi_restore 5
    .cfi_def_cfa 4, 4
    ret
    .cfi_endproc
.LFE0:
</pre>


<p>最初の数行で実行の準備が行われます。（ラベルは無視してOK）</p>

<p>まずはpush %ebpでebpの値をスタックにプッシュします。</p>

<pre>add()呼び出し時のebp ; esp
リターンアドレス ;esp + 4
10  ;esp + 8 add()の仮引数a
20  ;esp + 12 add()の仮引数b
30  ;esp + 16 add()の仮引数c

10  ;esp + 24
20  ;esp + 28
30  ;esp + 32

</pre>


<p>とスタックの状態が変更されます。</p>

<p>その後、movl $esp $ebpでespの値をebpに代入します。</p>

<pre>add()呼び出し時のebp ; esp = ebp
リターンアドレス ;esp + 4
10  ;esp + 8 add()の仮引数a
20  ;esp + 12 add()の仮引数b
30  ;esp + 16 add()の仮引数c

10  ;esp + 24
20  ;esp + 28
30  ;esp + 32

</pre>


<p>espとebpの値が同じになりました。 最後にsubl $16 %espで、add()関数のためのスタックフレームを16byte確保します。</p>

<pre>なにが入ってるかは現段階で不明 ; esp (ebp-16)
.
.
.
add()呼び出し時のebp ; ebp
リターンアドレス ;ebp + 4
10  ;ebp + 8 add()の仮引数a
20  ;ebp + 12 add()の仮引数b
30  ;ebp + 16 add()の仮引数c

10  ;ebp + 24
20  ;ebp + 28
30  ;ebp + 32

</pre>


<p>これで準備OKです。関数内の処理を追っていきます。</p>

<pre>movl    12(%ebp), %eax
    movl    8(%ebp), %edx
    addl    %edx, %eax
    addl    16(%ebp), %eax
    movl    %eax, -4(%ebp)
    movl    -4(%ebp), %eax
    leave
    .cfi_restore 5
    .cfi_def_cfa 4, 4
    ret
    .cfi_endproc
</pre>


<p>ebp+12(つまり引数のb)をeaxに格納し、次にebp+8(つまり引数のa)をedxに格納します</p>

<p>addl $edx, $eaxで二つを足したものを$eaxへ代入。</p>

<p>次のaddl16(%ebp), %eaxで、引数のcと二つを足したものを、更にたして$eaxに代入 (a+b+cを実現しています)</p>

<p>そのあとにebp-4の場所に$eax(a+b+cの答え)を格納してから、ebp-4の値をeaxに格納しています。 （一見無駄な処理ですが、関数のreturnはeaxに格納する決まりなので、そのための慣例的なもの）</p>

<p>この段階のスタックの状態は</p>

<pre>なにが入ってるかは現段階で不明 ; esp (ebp-16)
.
.
60(a+b+cの答え) ; ebp-4
add()呼び出し時のebp ; ebp
リターンアドレス ;ebp + 4
10  ;ebp + 8 add()の仮引数a
20  ;ebp + 12 add()の仮引数b
30  ;ebp + 16 add()の仮引数c

10  ;ebp + 24
20  ;ebp + 28
30  ;ebp + 32

</pre>


<p>最後にleaveとretの処理です。</p>

<p>leaveはスタックフレームの破棄に使われる命令です。内部的にはmov %ebp, %espを 行い、その後、pop %ebpが実行されるのと同義です。</p>

<p>つまり、</p>

<pre>なにが入ってるかは現段階で不明 ; 破棄
. 
.
60(a+b+cの答え) ; 破棄
add()呼び出し時のebp ; ebp = esp
リターンアドレス ;ebp + 4
10  ;ebp + 8 add()の仮引数a
20  ;ebp + 12 add()の仮引数b
30  ;ebp + 16 add()の仮引数c

10  ;ebp + 24
20  ;ebp + 28
30  ;ebp + 32
</pre>


<p>この状態にmov $ebp, $espでしてから、pop %ebpします。つまり、add()呼び出し時のebpを 再びebpに戻します。popされたことによって、espは+4ずれ込みます。</p>

<p>これにより</p>

<pre>リターンアドレス ;esp
10  ;esp + 4 add()の仮引数a
20  ;esp + 8 add()の仮引数b
30  ;esp + 12 add()の仮引数c

10  ;esp + 20 main()のa
20  ;esp + 24 main()のb
30  ;esp + 28 main()のc
</pre>


<p>となります。（add()呼び出し時と同じ状態）</p>

<p>最後にretでリターンアドレスに戻ります。pop $eipと同義です。スタックからリターンアドレスを popして、eip(次に実行される命令のアドレスを格納するレジスタ)に代入して、add()関数が 終了します。</p>

<p>スタックの状態は</p>

<pre>10  ;esp add()の仮引数a
20  ;esp + 4 add()の仮引数b
30  ;esp + 8 add()の仮引数c

10  ;esp + 16 main()のa
20  ;esp + 20 main()のb
30  ;esp + 24 main()のc
</pre>


<p>となり、add()呼び出し前と全くおなじになっています。 add()関数から、制御が戻ったmain()関数では</p>

<pre>call    add
    movl    %eax, 28(%esp)
    movl    $.LC0, %eax
    movl    28(%esp), %edx
    movl    %edx, 4(%esp)
    movl    %eax, (%esp)
    call    printf
    movl    $0, %eax
    leave
    .cfi_restore 5
    .cfi_def_cfa 4, 4
    ret
    .cfi_endproc
</pre>


<p>returnされた値が格納されているeaxから値を取り出して、printf()に渡していることがわかります。</p>

<p>printfも、同じ流れでスタックに引数が渡されています。</p>

<p>main()関数の終了時もleaveとretを実行し、同じように終了します。 leaveの前の movl $0, %eaxはreturn 0;を実現しています。</p>

<p>こんな感じです。</p>

<p>参考にしていた本に誤植があり、それに気がつくまでに時間がかかってしまった・・・。 でもちゃんと復習できてよかった。</p>

<hr />

<h5>その他参考リンク</h5>

<p><a href="http://ja.wikibooks.org/wiki/X86%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%A9/GAS%E3%81%A7%E3%81%AE%E6%96%87%E6%B3%95">X86アセンブラ/GASでの文法</a></p>

<p><a href="http://softwaretechnique.web.fc2.com/OS_Development/Tips/IA32_Instructions/LEAVE.html">LEAVE命令</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/08/31/wordpress63/">2013夏休みの記録</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-08-31T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今年の夏休みは、学生最後なのでできるだけ後悔がないよう、予定を詰め込んだ。</p>

<p>家でごろごろしてたら夏休みが終わってた、といういつものパターンは回避できたし、 割りと勉強も遊びも楽しめたと思います。</p>

<p>記録しておきたいので書き残しておきます。</p>

<h2>7.21 終業　帰りにゲーセンでスロット打つ</h2>

<p>この日で学校が終わり、夏休みに入りました。とりあえず予定はなかったので、 帰路へつきました。</p>

<p>時間も早かったので、帰りに地元のゲーセンに入ってガンダムEXVSFBやったり、 スロット打ったりしてました。</p>

<p>僕はスロットに全然詳しくないので、作品が好きというだけでコードギアス 打ってたんですが、一回BIG引いてから、閉店までずーーっと連チャン。</p>

<p><a href="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2208.jpg" rel="image_group"><img src="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2208.jpg?resize=955%2C716" alt="IMG_2208" class="alignnone size-large wp-image-812" data-recalc-dims="1" /></a></p>

<p>ゲーセンなので利益とかはもちろんないですが、コイン2,000枚くらいになって 嬉しかったですｗしょーもないですがｗ</p>

<h2>7.22 学校のセキュリティ学科でバーベキュー &amp; お台場ダイバーシティ</h2>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2213.jpg" rel="image_group"><img src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2213.jpg?resize=768%2C1024" alt="IMG_2213" class="alignnone size-large wp-image-811" data-recalc-dims="1" /></a></p>

<p>学校が夏休みに入って次の日に、同じ学科のみんなでバーベキュー。 暑かったけど、バカみたいに騒いで食って飲んで、水鉄砲とかちゃっちゃいました。</p>

<p>帰りにダイバーシティ寄って、1/1ガンダム見たり、ガンプラミュージアム見て 最高にテンション上がりました。</p>

<p>ここでガンプラ熱再燃。のちのちなにかしらガンプラを作ろう！と決意。</p>

<p>夜は、友達二人が自宅に泊まりに遊びにきてくれました。 FPSがとても得意な友達で、上手すぎてビビりました。（Call Of Duty Black Ops 2やってた）</p>

<h2>7.23 葛飾区花火大会（大雨で中止）</h2>

<p>今年初めての花火大会、ということで結構楽しみにしてたんですが 突然のゲリラ豪雨で中止・・・</p>

<p>僕は私服でしたが、周りでは浴衣がびっしょびしょになってる人もいてかわいそうだった。 仕方ないので会場近くのラーメン食べて、まったりしました。</p>

<p><a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2227.jpg" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2227.jpg?resize=955%2C716" alt="IMG_2227" class="alignnone size-large wp-image-813" data-recalc-dims="1" /></a></p>

<h2>7.30 学校の友人で妙義山登山 &amp; 軽井沢温泉</h2>

<p>以前、初めての登山で高尾山に以前登ったんですが、結構サクサクと進んじゃったので、 登山に慣れた友人に『いかつい山登ってみたい！』と言って、連れて行ってもらいました。</p>

<p>正直なめてました。とりあえずぐぐって登山に必要らしいものは用意してたので、 なんとか登ることはできましたが、落ちたら死ぬかと思うような崖が多かったです。</p>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2240.jpg" rel="image_group"><img src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2240.jpg?resize=955%2C716" alt="IMG_2240" class="alignnone size-large wp-image-814" data-recalc-dims="1" /></a></p>

<p>疲れた、というよりは手や足に力がはいらなくなりました。足はガクガクしっぱなしだったｗ 帰りに軽井沢のほうまで車を回して、でかい温泉はいりました。</p>

<h2>7.31 ふなばし市民まつり</h2>

<p>今年初の花火。来場客数と比べて屋台はとてもすくなくて、どこも行列でした。 かなり長い間並んでいたのですが、自分達の番が来る直前で売り切れ。 もうちょっと早く言って欲しかった・・・一緒に行った知人は結構おこってました（笑）</p>

<p>でも花火はすごいキレイだった。 <a href="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2258.jpg" rel="image_group"><img src="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2258.jpg?resize=768%2C1024" alt="IMG_2258" class="alignnone size-large wp-image-815" data-recalc-dims="1" /></a></p>

<p>写真これしかなかった・・・orz</p>

<h2>8.3-8.7 青森で祖父の三回忌</h2>

<p>キリストの墓と、十和田湖、ねぶた祭り行きました。あとは食べて、飲んで、寝て。 どこに行っても飯がたっくさん出てきて、常に腹いっぱいだった。</p>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2276.jpg" rel="image_group"><img src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2276.jpg?resize=955%2C716" alt="IMG_2276" class="alignnone size-large wp-image-816" data-recalc-dims="1" /></a></p>

<p>行く前の目標だった『カブトムシ見つける』も達成できて満足</p>

<p><a href="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2284.jpg" rel="image_group"><img src="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2284.jpg?resize=768%2C1024" alt="IMG_2284" class="alignnone size-large wp-image-817" data-recalc-dims="1" /></a></p>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2288.jpg" rel="image_group"><img src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2288.jpg?resize=768%2C1024" alt="IMG_2288" class="alignnone size-large wp-image-818" data-recalc-dims="1" /></a></p>

<p>基本的にみんなめっちゃ早く寝るので、布団に入りながらネットやったり アルゴリズムの本読んだりしてました。</p>

<h2>8.10 モンスターズ・ユニバーシティ見にいく</h2>

<p>本当は等々力渓谷行く予定だったんですが、ニュースで猛暑が報道されていたので、近所の映画館へ。</p>

<p>子供向けだから〜・・・という前評判を聴いていましたが、普通に良かったです。 子供も大人楽しめる。pixerのCG技術は世界一ィィイイイ</p>

<p>サリーとマイクがモンスターズインクに入社してからの話も、 映像化してほしいなー。</p>

<p>あとお昼に食べたお好み焼きがすごい美味しかったｗ</p>

<p><a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2318.jpg" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2318.jpg?resize=768%2C1024" alt="IMG_2318" class="alignnone size-large wp-image-819" data-recalc-dims="1" /></a></p>

<h2>8.13 ガンプラ制作スタート HG ガンダムAGE-2 dublle bullet</h2>

<p>ダイバーシティでガンプラミュージアム見てたら、久しぶり（中学生ぶり）にやりたくなりました。 キットを探しにいったお店では、あんまり種類なかったんですが、久しぶりだし、安くてかっこいい HG AGE-2 DOUBLE BULLETにしました。</p>

<p><a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2322.jpg" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2322.jpg?resize=955%2C716" alt="IMG_2322" class="alignnone size-large wp-image-820" data-recalc-dims="1" /></a></p>

<p>最初はいいペースで作ってたんですが、これ以降予定つっこみすぎて 結局完成したのは８月末でした。</p>

<p>夏休みでやたら工具が充実しました・・・(ミニ四駆のときのために買ったものもあるけど)</p>

<ul>
<li>TAMIYA モデラーズナイフ</li>
<li>ガンプラマーカー　黒</li>
<li>ガンプラマーカー　茶</li>
<li>TAMIYA 紙やすり 400 600 800 1000 1200 1500 2000</li>
<li>TAMIYA のちっちゃいトンカチ</li>
<li>TAMIYA タミヤセメント</li>
<li>TAMIYA セミグロスブラックの塗料</li>
<li>つやけしスプレー</li>
</ul>


<p>などなど。工具が揃っちゃえば、あんまりお金かけずに長時間楽しめるいい趣味だと思います。プラモ。</p>

<h2>8.14 MGO(Meta Gear Online)クランのみんなでバーベキュー</h2>

<p>なんだかんだでもう５年くらいの付き合いかな？ ３，４ヶ月に１回くらいは仲のいい面子で集まってます。 今回はメンバーの家の庭でバーベキューやりました。</p>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2326.jpg" rel="image_group"><img src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2326.jpg?resize=768%2C1024" alt="IMG_2326" class="alignnone size-large wp-image-821" data-recalc-dims="1" /></a></p>

<p>その後は、とにかく酒のみながらずっとゲーム。</p>

<p>やってみたかったダークソウルやらせてもらったんですが、センスなさすぎワロタｗ ２体目のボス倒したあたり以降、まったく進めなくなりました・・・ｗ</p>

<p>メンバーのご家族にはいつも優しくしてもらって感謝です。</p>

<h2>8.15 学校の先輩・後輩みんなでバスケ</h2>

<p>ウチの学校は情報処理や、CG、ゲーム開発など、とにかくインドアな学部しかないので、 運動不足は深刻な問題です。</p>

<p>なので、たまに体を動かしたい何人かの人が主催してバスケとかフットサルが開催されます。 知ってる人も知らない人もたくさん参加します。</p>

<p>僕はだいぶ遅くから参加したので、あんまり疲れなかったけど やっぱり体動かすの楽しい。下手くそですけどね。</p>

<p>次の日は始発で出る予定なので、バスケ終了後すぐに帰宅。また誘ってくださーい</p>

<h2>8.16 学校の友人と伊豆ヒゾリ浜でシュノーケリング</h2>

<p>日帰り旅行だったんですが、始発で家を出て、帰りは渋滞のおかげで新宿に着いたのが 午前３時（笑）</p>

<p>でも半端なく楽しかったです。 はじめてシュノーケリングしたんですが、あんなにおもしろいと 思ってなかった・・・。一年中できたらいいのに、って思いました。</p>

<p><a href="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2342.jpg" rel="image_group"><img src="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2342.jpg?resize=955%2C716" alt="IMG_2342" class="alignnone size-large wp-image-822" data-recalc-dims="1" /></a></p>

<p><a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2345.jpg" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2345.jpg?resize=955%2C716" alt="IMG_2345" class="alignnone size-large wp-image-823" data-recalc-dims="1" /></a></p>

<p>普通にキレイな魚とか貝とか、ちょっと潜っただけでごろごろしてるんですね。 僕は見れなかったけどウニとか、サザエとかもいたらしい。</p>

<p>またヒゾリ浜行きたいなぁー・・・。 あとダイビングの資格とりたくなった・・・。沖縄とかにもいきてぇ！！</p>

<h2>8.17 鴨川シーワールドへドライブ</h2>

<p>前日、新宿についたのが午前３時だったので、その日は始発まで満喫。 それから始発で自宅に帰り、そこから少ししてレンタカーで出発。</p>

<p>無事帰ってこれたからよかったけど、クッソきつかったｗｗ 運転中もねむかった・・・ｗ</p>

<p>でも眠気関係なくなるくらい楽しかった！やっぱ動物いいなー、って思いました。 大好きなチンアナゴ見れて、すごい幸せになりました。</p>

<p><a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2346.jpg" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2346.jpg?resize=768%2C1024" alt="IMG_2346" class="alignnone size-large wp-image-829" data-recalc-dims="1" /></a></p>

<p>帰りは近くの浜でたくさん写真を撮ってから、 眠いのを我慢しつつ、perfumeかけて楽しく帰宅しました。</p>

<h2>8.18-8.23 出家合宿 &amp; アルバイト再開</h2>

<p>アルバイト先では、新しいインターン生がたくさん来ていて、自分がインターン 来たのが、もう一年前かー・・・って色々考えるところがありました。 ( 去年の同時期のインターンに参加し、終了後、そのままアルバイトとして働き始めました)</p>

<p>業務自体はいつもどおりでしたが、長い時間入れたので、いつもより 良いコード書けた気がするし、進捗も良かったと思います。 javascriptだけをフルタイム１週間書くのは初めてでした。</p>

<p>家から通うのではなく、知人の家に１週間お世話になりました。 自室から一週間離れると、さすがに違和感ありますねー。</p>

<p>たった一週間だったけど、自宅に帰ったときの『実家かえってきたー』感を 初めて味わうことができたと思う。</p>

<h2>8.24 よかろうもん定例勉強会</h2>

<p>久しぶりの参加。僕はネタナシでしたが・・・ 夏休みの間会ってなかった学校の面子にも久しぶりに会えて嬉しかったです。</p>

<p>iPythonとapp goat、そしてctfの過去問題の一部がとりあげられました。</p>

<p>次回の勉強会は、都合があわず、二ヶ月先。 宿題たっぷり出たので頑張ります。</p>

<p>夕ごはんは地元のワインバーにふらっと行ったんですが、予想以上に美味しかった。 値段もそこそこでまた行きたいなー。特にマリネが最高だった。</p>

<h2>8.25 池袋セキュリティ勉強会#1 / 超久しぶりのバンド練習</h2>

<p>セキュリティ勉強会に関しては前回のブログに書きましたので、そちらで。</p>

<p>勉強会の後、亀戸のリハーサルスタジオへ直行</p>

<p>バンド活動をこの日より再開しました。といってもメンバーは違うし、 月に１回の活動ですが。</p>

<p>練習不足の僕のせいでグダグダしつつも楽しい練習ができたので、これから毎月 頑張ってみようと思います。</p>

<p>次回からはオリジナル曲もやっていくので、機会があれば聴いてほしいです。</p>

<h2>8.27 出校日 ヴァルキリ山(@Wireworks)達とミニ四駆</h2>

<p>新橋のタミヤプラモデルファクトリー行ってきました。ミニ四駆なんて 小学校以来。</p>

<p>値段も手頃で、ついつい色々パーツ買っちゃうのね。</p>

<p>僕はレッツ&amp;ゴー世代なので、烈のミニ四駆買おうと思ってたんですが、 ミニ四駆proの烈のマシン（ロデオソニック）あんまり好みじゃなくて、 しかもいろんな世代が遊べるように、ひと通り各世代の代表的なマシンがproで発売されていたので、 僕はダッシュ１号皇帝（エンペラー）をチョイス。</p>

<p>購入してから、そのまま２階の部屋で作りました。 デカールはタミヤプラモデルファクトリー限定のものを購入して、ぺたぺた貼りました。</p>

<p><a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2376.jpg" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2376.jpg?resize=955%2C716" alt="IMG_2376" class="alignnone size-large wp-image-825" data-recalc-dims="1" /></a></p>

<p><a href="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2381.jpg" rel="image_group"><img src="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/IMG_2381.jpg?resize=955%2C716" alt="IMG_2381" class="alignnone size-large wp-image-824" data-recalc-dims="1" /></a></p>

<p>我ながら、そこそこかっこよく出来たと思いますが、ソニックとか、スピンアックスみたいな ボディでタイヤを覆っていて、車高が低いタイプも捨てがたいなぁ、と。</p>

<p>次買うときは、ソニックにしようかな。</p>

<p>あとでぐぐってみたら、ハイパーダッシュpro + 超速ギア + ベアリングで、スピード自体は 簡単に最高速を実現できるらしいが、そこからのコースアウト対策などのチューニングが難しい、と。</p>

<p>プラモと同じく、気軽に低価格で長く楽しめるいい趣味になりそう。</p>

<p>帰宅してからも少しいじったんですが、予想以上にグリスは重要ですね。 音が全然変わった。</p>

<h2>8.28 AGE-2 DOUBLE BULLET完成</h2>

<p>素組は結構前に終わってたんですが、最後に仕上げとかトップコートとか、まだでしたので、 この日に仕上げました。</p>

<p>トップコートを均一に吹くのめちゃくちゃ難しくて、ムラだらけだし、白くなっちゃったところも 多々ありますが、中学校のときに作ってたガンプラよりはクオリティ上げられたと思う。</p>

<p><a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/photo.jpeg" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/photo.jpeg?resize=480%2C640" alt="photo" class="alignnone size-full wp-image-827" data-recalc-dims="1" /></a></p>

<p>何体か作れば、もっと上手になるかなー。とりあえず買っただけで、まだ未開封のトールギスⅢに、 次は挑戦してみます。</p>

<h2>8.29 CLANNADは人生</h2>

<p>なんとなーく最初から見返しました。最初から全部見直すのは３回目です。 けど、毎度同じところでボロ泣きするｗ</p>

<p>何回見なおしてもやっぱりことみちゃんが一番好き。 アフター、アニメでやってほしかった・・・。</p>

<p>原作やってないけど大好きな作品です。がんばろう、って思いましたｗ</p>

<p>一日中見てたら頭いたくなった。</p>

<hr />

<h2>夏休み中読んだ本</h2>

<p>もっともっと予定には何冊か、読もうと思ってたのですが、結局読めたのは</p>

<ul>
<li>ゲーム理論の基本と考え方がよーくわかる本</li>
<li>Cプログラムの中身がわかる本</li>
<li>最強最速アルゴリズマー養成講座</li>
</ul>


<p>の３冊だけでした・・・この３冊も理解、という意味では、もう何度か見直したい・・・。</p>

<p>空き時間に読もうー、とか思ってると全然読めないですね・・・。もうちょっと積極的に 本を読む時間を作らないと。</p>

<h2>今回の夏休みでできなかったこと</h2>

<ol>
<li>フルマラソン挑戦（参加者の予定合わず）</li>
<li>スライム作成 (なんだかんだで材料を揃えられず)</li>
<li>LPIC Level2対策 (他のことばっかりしてた・・・)</li>
</ol>


<p>この３つは予定してたんですが、全く触れなかった・・・。10月には情報処理技術者試験もあるし・・・。 ぐぬぬ・・・。9月で取り戻さないと・・・。</p>

<hr />

<p>こんな感じです。最初に『遊びも勉強も』と書きましたが、正直勉強は不足してますね・・・。どう見ても・・・。 でも楽しめました、後悔のない夏休みにできました。</p>

<p>写真はガンプラの完成写真以外は全部iPhoneなんで、ちょっとしょぼいですが、総括なのでまぁいっか。 ちゃんとしたカメラで撮った中でお気に入りのものはfacebookにアップロードします。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/08/27/wordpress62/">セキュリティ勉強会#1に参加してきました</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-08-27T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>以下の内容は悪用厳禁です。なにかあっても当ブログ管理人は責任は負えません。 自分の環境で試す場合は自己責任でお願い致します。</p>

<p>また、この記事の内容を用いて、他人に攻撃を行うことは犯罪です。 下記の法律に抵触する可能性がありますので、全PCが自分の管理下である場合のみに限り検証してください。</p>

<pre>不正指令電磁的記録作成等
第百六十八条の二 　正当な理由がないのに、人の電子計算機における実行
の用に供する目的で、次に掲げる電磁的記録その他の記録を作成し、又は
提供した者は、三年以下の懲役又は五十万円以下の罰金に処する。
一 　人が電子計算機を使用するに際してその意図に沿うべき動作をさせず、
又はその意図に反する動作をさせるべき不正な指令を与える電磁的記録
二 　前号に掲げるもののほか、同号の不正な指令を記述した電磁的記録そ
の他の記録
２ 　正当な理由がないのに、前項第一号に掲げる電磁的記録を人の電子
計算機における実行の用に供した者も、同項と同様とする。
３ 　前項の罪の未遂は、罰する。
不正指令電磁的記録取得等
第百六十八条の三 　正当な理由がないのに、前条第一項の目的で、同項各
号に掲げる電磁的記録その他の記録を取得し、又は保管した者は、二年以
下の懲役又は三十万円以下の罰金に処する。
</pre>


<p>また、勉強会の内容は一部省略しております。詳しい使い方などは 公式ドキュメント等を参照していただければと思います。</p>

<hr />

<p>8月の25日に池袋セキュリティ勉強会#1に参加させていただきました。</p>

<p><a href="http://connpass.com/event/3004/">connpass セキュリティ勉強会#1</a></p>

<p>内容はexploitコードの作成や実行を支援するセキュリティツール <a href="http://ja.wikipedia.org/wiki/Metasploit">metasploit</a>の使い方に関してでした。</p>

<p>CTFなどで、数回使ったものの、結局基本のキも知らない状態だったので、 とても参考になりました。復習も兼ねて思い出しながら全体の流れを書いてみます。</p>

<p>勉強会の流れは</p>

<ul>
<li>環境設定 (検証のための古いjreやmetasploit framework本体のインストール)</li>
<li>脆弱性コードの作成と攻撃サーバ立ち上げ</li>
<li>やられOSの乗っ取り(meterpretarの使い方など)</li>
<li>攻撃の自動化</li>
<li>懇親会（僕は私用で参加できませんでした）</li>
</ul>


<p>という感じでした。</p>

<h2>環境設定</h2>

<p>会場はMac半分、windows半分という感じでした。</p>

<p>セットアップ済みの環境が簡単に用意できるペネトレーションテストに 特化したLinuxディストリビューションであるKali linuxのインストールを 仮想環境で準備している方も多かったみたいです。</p>

<p>僕もkali linuxを入れてあったんですが、前日の夜になんとなくMacで動かせたら便利だなー と思ってセットアップを始めたら、なんかいい感じに動いたので勉強会ではMac上で動かしている metasploitを使ってました。</p>

<p>※MacOS Mountain Lionにmetasploit frameworkのインストールは <a href="http://www.phocean.net/2013/05/05/installing-metasploit-on-os-x-mountain-lion.html">こちら</a> を参考にしました。brewを使わずgit cloneで準備しました。 postgresqlのパスワード忘れちゃって結構焦りましたが、それ以外は問題なく進みました。</p>

<p>※ちなみにarmitage(metasploitのGUIみたいなやつ)のインストーラー(.dmg)も公式で 用意されているようなのですが、何故かインストールできず・・・（原因を調べてもいませんが）</p>

<p>kali linuxでもMacOSでも、コマンド $msfconsoleでmetasploit起動です。</p>

<p><a href="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/Screen-Shot-2013-08-27-at-0.23.59.png" rel="image_group"><img src="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/Screen-Shot-2013-08-27-at-0.23.59.png?resize=955%2C898" alt="Screen Shot 2013-08-27 at 0.23.59" class="alignnone size-full wp-image-796" data-recalc-dims="1" /></a></p>

<p>僕の環境ではversion 4.8です。1159種類のexploit 310種類のペイロードなどなどが 含まれているようです。</p>

<p>起動時に表示されてるAAは複数あってランダムで表示されるようです。</p>

<pre>msf > banner
</pre>


<p>bannerコマンドでAA表示を何度も行えます。オリジナルのbannerを作成して 表示させることもできるらしいです。</p>

<h2>脆弱性コードの作成と攻撃サーバ立ち上げ</h2>

<p>metasploitによるexploit作成の基本的なコマンドなどの紹介</p>

<p><strong>基本的な手順</strong></p>

<ol>
<li>exploitを選択 (msf > use [exploit path])</li>
<li>設定を行う (msf > set &#91;option name&#93; &#91;value&#93;)</li>
<li>payloadを選択 (msf > set PAYLOAD &#91;payload path&#93;)</li>
<li>exploitの実行 (msf > exploit)</li>
</ol>


<p><strong>その他、使ったコマンド</strong></p>

<pre>search \[keyword\]  :moduleの検索
jobs                :現在動作しているジョブの表示
kill [job number]   :ジョブの終了
sessions [option]   :exploitで取得したセッション情報の管理 -lで一覧 -i \[session number\]で接続
</pre>


<h2>やられOSの乗っ取り</h2>

<p>今回の勉強会ではjavaappletのexploitを利用して 攻撃サーバにアクセスしてきたマシンを乗っ取る、という演習を行いました。</p>

<p>自分が立てた攻撃サーバにアクセスがあると、セッションの確率を試みます。</p>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/Screen-Shot-2013-08-27-at-1.37.37.png" rel="image_group"><img src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/Screen-Shot-2013-08-27-at-1.37.37.png?resize=955%2C132" alt="Screen Shot 2013-08-27 at 1.37.37" class="alignnone size-large wp-image-797" data-recalc-dims="1" /></a></p>

<p>セッションが確立されると、後はmeterpretar経由で攻撃者が自由に走査すること ができます。</p>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/Screen-Shot-2013-08-27-at-1.38.02.png" rel="image_group"><img src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/Screen-Shot-2013-08-27-at-1.38.02.png?resize=955%2C176" alt="Screen Shot 2013-08-27 at 1.38.02" class="alignnone size-large wp-image-798" data-recalc-dims="1" /></a></p>

<p>一度乗っ取りが成功すると、metasploit consoleからmeterpretar経由で キーロガーを起動させて、キー入力を見たり、スクリーンショットを取ったり</p>

<p>lsコマンドやsysinfoで対象のシステムの中身を除く <a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/Screen-Shot-2013-08-27-at-1.47.19.png" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/Screen-Shot-2013-08-27-at-1.47.19.png?resize=955%2C346" alt="Screen Shot 2013-08-27 at 1.47.19" class="alignnone size-large wp-image-799" data-recalc-dims="1" /></a></p>

<p>プロセスの乗り換え・偽装 <a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/Screen-Shot-2013-08-27-at-1.46.45.png" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/Screen-Shot-2013-08-27-at-1.46.45.png?resize=955%2C174" alt="Screen Shot 2013-08-27 at 1.46.45" class="alignnone size-large wp-image-800" data-recalc-dims="1" /></a></p>

<p>rubyコンソールの起動 <a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/Screen-Shot-2013-08-27-at-1.47.50.png" rel="image_group"><img src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/Screen-Shot-2013-08-27-at-1.47.50.png?resize=800%2C274" alt="Screen Shot 2013-08-27 at 1.47.50" class="alignnone size-full wp-image-801" data-recalc-dims="1" /></a></p>

<p>などが行えることを確認しました。ちなみに、meterpretarによる操作だけでなく、シェルの起動も可能です。</p>

<p>※ターミナルを透過背景にしているため、関係ないものが多々写っていますが気にしないでください。</p>

<h2>攻撃の自動化</h2>

<p>最後に、先ほど実践した手順を自動化してみよう、という内容でした。</p>

<ul>
<li>リソースファイルの作成 (.msfファイル)</li>
</ul>


<p>こちらは簡単です。先ほどの手順を.msfファイルにあらかじめ記入しておき msfconsole起動時に読み込むだけです。</p>

<pre>use [exploit path]
set \[option\] \[value\]
run
</pre>




<pre>$ msfconsole -r auto\_exploit.msf
</pre>


<p>これだけです。</p>

<ul>
<li>exploit選択の自動化(要DBセットアップ、db&#95;autopwnモジュール)</li>
</ul>


<p>※現在ではautopwnの開発・メンテナンスが終了しているため、利用が推奨されていないようです。 あくまで検証用として、お考えください。</p>

<ol>
<li>ネットからdb&#95;autopwnのプラグインをダウンロード</li>
<li>metasploit frameworkのpluginフォルダに移動</li>
<li>msf > db&#95;connectを行う(database.ymlにDBログイン設定の記入をしてから)</li>
<li>msf > load db&#95;autopwn (pluginのロード)</li>
<li>msf > db&#95;nmap -O &#91;target IP address&#93; (targetをnmpaでスキャン 要nmap)</li>
<li>msf > hosts でhostsの情報確認</li>
<li>msf > db&#95;autopwn -p -e -t (exploitの自動選択と実行)</li>
</ol>


<p>※コマンドの使い方がわからないときは msf > help [command] で概要と使い方を調べることができます。</p>

<p>こんな感じでした。</p>

<p>現在はarmitageというmetasploitのGUI版のようなソフトで、同じことが可能です。</p>

<hr />

<p>勉強会の全てではないですが、おおまかにこのような内容でした。 主催の方々、ありがとうございました。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/08/22/wordpress61/">[AngularJS]$scopeを超えてデータ(model)をやりとりする[夏休み企画5]</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-08-22T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>AngularJSでは、コントローラーのネストが可能です。</p>

<p>例えば、よくあるサンプルで</p>

<pre><div id="parentScope" ng-controller="blogCtrl">
  <ul>
    <li ng-repeat="article in articles" ng-controller="articleCtrl">
      
                  <table>
        <!-- 詳細を見るためのview ということにしておきます -->
                        
                            
        
        <tr>
          <td>
            title
          </td>
                                  
          
          <td>
            date
          </td>
                                  
          
          <td>
            description
          </td>
                              
        </tr>
                        
                        
                            
        
        <tr>
          <td>
            
          </td>
                                  
          
          <td>
            
          </td>
                                  
          
          <td>
            
          </td>
                              
        </tr>
                        
                    
      </table>
              
    </li>
        
  </ul>
  
</div>
</pre>


<p>このようにすれば、diaryCtrl内で$scope.articlesを宣言し、 データを配列で格納すれば、li要素が配列の要素数だけ繰り返されます。</p>

<p>ざっくりですが、li要素内のtable要素は、最初に記述されている をクリックすると、詳細が確認できるようになっている、とします。</p>

<p>※イメージが難しければ前回のTodoMVCの解説の記事にあった、実際に 動作させているリンクを確認していただければと思います。ダブルクリックすると todoの内容を編集できるtextboxが表示されますが、あれと同じ要領だと思っていただれば と思います。</p>

<p>通常はこれで問題ないのですが、例えば</p>

<ul>
<li>編集や確認をしたい要素が大量にある</li>
<li>modelのstyle(CSS)を編集するためのformを用意したい</li>
<li>ng-repeatしている要素が大量にある</li>
</ul>


<p>などの理由で、どうにかtableをarticleCtrlの外に出したいときや、 詳細表示用や編集のためのviewをひとつだけにして、 内容だけを切り替えて表示したいとき、なんかがあります。。</p>

<p>※僕の場合は、ng-repeatさせているdiv要素のopacityとz-indexを変更させたかったのですが 、controller内のformやinput要素で編集を行うと、z-indexを変更した瞬間にformごと 全体を囲っているdiv.wrapper後ろにいってしまう、という問題がありました。</p>

<p>なので、こんな感じにしたいんです。</p>

<pre><div id="parentScope" ng-controller="blogCtrl">
  <ul>
    <li ng-repeat="article in articles" ng-controller="articleCtrl">
      
      
              
    </li>
        
  </ul>
      
  
  <table>
    <!-- 詳細を見るためのview 内容は、クリックされたaritlceによって切り替える -->
            
            
    
    <tr>
      <td>
        title
      </td>
                  
      
      <td>
        date
      </td>
                  
      
      <td>
        description
      </td>
              
    </tr>
        
        
            
    
    <tr>
      <td>
        
      </td>
                  
      
      <td>
        
      </td>
                  
      
      <td>
        
      </td>
              
    </tr>
        
        
  </table>
  
</div>
</pre>


<p>こういうときに、クリックされたarticleはarticleCtrl内のscopeに 含まれているので、blogCtrlからアクセスができません。</p>

<p>要するに、クリックされたarticleCtrl内の$scope.articleを、 blogCtrlに渡せれば万事解決です。</p>

<p>結論からいうと、簡単にできます。これだけ</p>

<pre>var parentScope = angular.element($('#parentScope)).scope();
</pre>


<p>angular.element()では、jQueryのlite版(jqLite)のラッパーです。 つまり、jQueryと同様のセレクタを指定できます。</p>

<p>公式リファレンスは<a href="http://docs.angularjs.org/api/angular.element">こちら(angular.element)</a>です</p>

<p>blogCtrlの宣言場所にidを指定しておいたので、それをセレクタで 指定してあげます。</p>

<p>それに対してscope()メソッドを実行することで、対象のscopeが取得できます。 つまり、blogCtrlのスコープが取得できます。</p>

<p>あとは、そのスコープに渡したいデータを渡すだけ。</p>

<p>上記のコードを利用したサンプルを作成してみました。</p>

<p><a href="http://plnkr.co/edit/hHjZEf3AMoJruoDRA2P6?p=preview">sample</a></p>

<p>ネタさえわかってしまえば、特別難しいことはしていません。</p>

<pre>var SampleModule = angular.module('SampleModule', []);

SampleModule.controller('listCtrl', ['$scope', '$http',
  function($scope, $http){
    $scope.users = [
      {id:1, age:20, sex:1, name:'user1'},
      {id:2, age:22, sex:1, name:'user2'},
      {id:3, age:14, sex:2, name:'user3'},
      {id:4, age:29, sex:2, name:'user4'},
      {id:5, age:16, sex:1, name:'user5'},
      {id:6, age:25, sex:2, name:'user6'}
    ];
    $scope.editing = [];  
  
    $scope.editUser = function(user){
      $scope.beforeEdit = angular.extend({},user);
      $scope.editing = user;
    };
    
    $scope.saveEdit = function($event){
      $scope.editing = undefined;
    };
    
    $scope.cancelEdit = function($event){
      //$scope.editing = beforeEdit;
      angular.forEach($scope.users, function(user, key){
        if(user.id == $scope.beforeEdit.id){
          $scope.users[$scope.users.indexOf(user)] = $scope.beforeEdit;
        }
      });
      $scope.editing = undefined; 
    };
  }
]);

SampleModule.controller('userCtrl', ['$scope',
  function($scope){
    
    $scope.editUser = function($event){
      var parentScope = angular.element($('#listScope')).scope();
      parentScope.editUser($scope.user);
    };
    
  }
]);
</pre>


<p>ポイントは</p>

<pre>$scope.beforeEdit = angular.extend({},user);
$scope.editing = user;
</pre>


<p>の箇所です。</p>

<p>angular.extend({}, user)はuserオブジェクトのcloneをしてます。 普通に代入するとcloneではなく、参照がコピーされてしまうので 編集前のuserオブジェクトを保持しておき、編集のキャンセルが されたときに、編集前にオブジェクトを戻すためです。</p>

<p>これで、編集画面のviewを１つだけに、内容は選択されたオブジェクトによって 動的に切り替えています。</p>

<p>しかし、問題としては、本来userCtrl内の$scope.userを、viewの都合で 他のコントローラーに渡して、そこでデータを編集していることです。</p>

<p>これはどうなんだろう・・・・。</p>

<p>これに対する対応策として、僕はmodelの一部をserviceから取得して、 編集・削除などはserviceを介してリクエストを行う、ということを検討しました。 それは機会があれば、おいおい・・・。</p>

<p>ざっくりですが、ここまでです。</p>

<p>とりあえず</p>

<pre>angular.element() //jqLiteを使ってDOMを取得
</pre>


<p>と</p>

<pre>angular.extend() //オブジェクトのcloneを作成
</pre>


<p>この２点を確認できれば、と思います。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/08/02/wordpress60/">[Algorithm]グラフ理論と幅優先探索＆深さ優先探索の入門の入門(夏休み企画4)</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-08-02T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>学校の授業でもアルバイトでもWeb系の開発ばかりしていたので、 数学・物理、そしてアルゴリズムなどとは（少なくとも僕が意識する範囲では） 無縁だったのですが、去年末に、<a href="https://supporterz.jp/">サポーターズ</a>さんに 招待していただいた就活イベントで、お話させていただいた企業の方から</p>

<p><strong>『WEBプログラマーはアルゴリズムに弱い』</strong></p>

<p>というお話をお聴きしました。確かに必要に駆られる場合は、僕の場合、ありませんでした。</p>

<p>それでも、できないよりは、簡単なものから初めてみようと思い、TopCoderやAOJに登録して みました。しかし、すぐにアルゴリズムをちゃんと勉強して、知識として持っていなくては 八方塞がりになることが、頻繁にあったので、空き時間に少しづつ本を読んだりしていました。</p>

<p>今回は、その中で、頻繁に出てくるテクニックとして、深さ優先探索と幅優先検索について グラフ理論の基礎から復習を兼ねて、まとめてみたいと思います。 （※可能であればc++とpythonで実践もしたいと思います。）</p>

<p>概要はwikipediaやグーグル検索すれば、大体わかると思います。 僕も最近知ったもので、グーグル検索ですぐに手に入る程度の知識しかありません。</p>

<h3>グラフ理論とは</h3>

<p>数学の１分野で、ノード(頂点、node)とエッジ(枝、edge)の集合で構成されるグラフの性質について 研究する学問である。</p>

<p>コンピュータのデータ構造やアルゴリズムに広く応用されている。 (※ リスト構造、wwwのハイパーリンク、デッドロックの検出、ファイルシステム、ガベージコレクションなど)</p>

<p>下図はグラフ理論における、グラフの例です。矢印があるほうが<strong>有向グラフ</strong>、 ないものが<strong>無向グラフ</strong>です。</p>

<p><img src="http://i2.wp.com/cdn-ak.f.st-hatena.com/images/fotolife/m/minorio/20070908/20070908145747.png?resize=321%2C249" class="alignnone" data-recalc-dims="1" /></p>

<p><img src="http://i0.wp.com/blog-imgs-13.fc2.com/j/a/v/javaprograming/graf.gif?resize=456%2C281" class="alignnone" data-recalc-dims="1" /></p>

<p>今回、僕が書きたいのが、このようなグラフから任意の条件にマッチするグラフを検索する <strong>幅優先検索</strong>と<strong>深さ優先探索</strong>です。</p>

<p>専門用語等、不明なワードがあれば、　wikipediaを参照してみてください。</p>

<p>経路探索などにも用いられることが多いので、 ゲームを作ったりする方は馴染みがあるかもしれません。</p>

<h3>●幅優先探索とは</h3>

<p>英語でBreadth first search。グラフ理論において、グラフや木構造(ツリー構造)の探索に用いられる。 アルゴリズムは根ノードで始まり隣接した全てのノードを探索する。 それからこれらの最も近いノードのそれぞれに対して同様のことを繰り返して探索対象ノードをみつける。</p>

<blockquote><p>アルゴリズムの観点からだと、ノードの展開により得られる子はキューに追加される。 典型的な実装の場合、未訪のノードは&#8221;open&#8221;と名づけられた(キューや連結リストのような) コンテナに格納され、既訪のノードは&#8221;closed&#8221;と名づけられたコンテナに格納されることになる。</p></blockquote>

<p><img src="http://i1.wp.com/upload.wikimedia.org/wikipedia/commons/b/bc/Breadth-first-tree.png?resize=450%2C311" class="alignnone" data-recalc-dims="1" /></p>

<h4>アルゴリズムの実装手順</h4>

<ol>
<li>根ノードを空のキューに加える。</li>
<li>ノードをキューの先頭から取り出し、以下の処理を行う。

<ul>
<li>ノードが探索対象であれば、探索をやめ結果を返す。</li>
<li>そうでない場合、ノードの子で未探索のものを全てキューに追加する。</li>
</ul>
</li>
<li>もしキューが空ならば、グラフ内の全てのノードに対して処理が行われたので、探索をやめ&#8221;not found&#8221;と結果を返す。</li>
<li>2に戻る。</li>
</ol>


<p>※実際にプログラミング言語による実装は、後ほど・・・。</p>

<h3>●深さ優先探索とは</h3>

<p>英語でdepth first search(DFSと略されることも多い)。別名バックトラック法。 こちらもグラフやツリー構造の探索に用いられるアルゴリズム。</p>

<blockquote><p>アルゴリズムは根から(グラフの場合はどのノードを根にするか決定する)始まり、 バックトラックするまで可能な限り探索を行う。</p></blockquote>

<p><img src="http://i2.wp.com/upload.wikimedia.org/wikipedia/commons/2/2c/Depthfirst.png?resize=471%2C465" class="alignnone" data-recalc-dims="1" /></p>

<h4>深さ優先探索の概要</h4>

<blockquote><p>形式的には、深さ優先探索は、探索対象となる木の最初のノードから、 目的のノードが見つかるか子のないノードに行き着くまで、深く伸びていく探索である。 その後はバックトラックして、最も近くの探索の終わっていないノードまで戻る。 非再帰的な実装では、新しく見つかったノードはスタックに追加される。</p></blockquote>

<p>深さ優先探索の実装には、スタックを用いたものと、再帰を用いたものが代表的です。 検索するノードの順番が一筆書きできる、という特徴があります。</p>

<h4>スタックで実装手順</h4>

<ol>
<li>スタックを用意する</li>
<li>スタックに最初の要素を入れる(push)</li>
<li>スタックから要素を取り出す(pop)</li>
<li>要素に対して処理をする</li>
<li>要素の子供をスタックに入れる(push)</li>
<li>スタックがカラになるまで3～5を繰り返す</li>
</ol>


<p><a href="http://d.hatena.ne.jp/lettas0726/20110418/1303097692">引用元</a></p>

<p>※実際にプログラミング言語による実装は、後ほど・・・。</p>

<h3>●深さ優先探索と幅優先探索のどちらを利用するべきか</h3>

<h4>深さ優先探索を用いるべきケース</h4>

<ul>
<li>前通りのパターンを列挙し、結果をまとめる必要がある場合</li>
<li>文字列などを探索するときに、辞書順であることが求められる場合</li>
</ul>


<h4>幅優先探索を用いるべきケース</h4>

<ul>
<li>始点から最も近いおのを求めたいケース</li>
<li>探索範囲は広いが、ある程度近くに求めたい解が存在することがわかっているケース</li>
<li>探索範囲が広く、深さ優先探索ではスタックが大量に使われてしまうケース</li>
</ul>


<p>上記内容はこちらの書籍を引用しました。実装例なども含まれています。redcoderの方が書いた TopCoderの入門書です。</p>

<p><a href="http://www.amazon.co.jp/%E6%9C%80%E5%BC%B7%E6%9C%80%E9%80%9F%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%9E%E3%83%BC%E9%A4%8A%E6%88%90%E8%AC%9B%E5%BA%A7-%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E3%82%B3%E3%83%B3%E3%83%86%E3%82%B9%E3%83%88TopCoder%E6%94%BB%E7%95%A5%E3%82%AC%E3%82%A4%E3%83%89-%E9%AB%98%E6%A9%8B-%E7%9B%B4%E5%A4%A7/dp/4797367172">最強最速アルゴリズマー養成講座 プログラミングコンテストTopCoder攻略ガイド</a></p>

<h3>プログラミングによる実装</h3>

<p>c++とpython、どちらで実装するか悩みましたが、まずは高レベルのmoduleが 充実していそうなpythonから挑戦してみました。</p>

<p>3*3マスのフィールドを、</p>

<ol>
<li>深さ優先探索で同じ道を通らずにゴールまで進むパターンは何通りあるかを調べる</li>
<li>幅優先探索で最短経路は何歩であるか調べる(1歩1マスとして)</li>
</ol>


<p>という問題を幅優先探索と深さ優先探索を用いて求めてみます。</p>

<p>3*3マスのフィールドは文字列型の配列で</p>

<pre>string map[] =
{
    "...",
    "...",
    "..."
};
</pre>


<p>と表現するとします。障害物のない状態なら、3*3という整数があれば表現できますが、 汎用的にするために、ここではこうしておきます。</p>

<p>startする地点は(0,0)の左上、ゴールは(4,4)つまり右下 とします。</p>

<p>動けるのは上下、左右で、斜めはなし。</p>

<h5>pythonによるBFSとDFSの実装</h5>

<pre># -*- coding:utf-8 -*-

from Queue import Queue
import time

def get_map_info(map = ""):
    map_width = len(map[0])
    map_height = len(map)
    map_info = {'width':map_width, 'height':map_height, 'startX':0, 'startY':0, 'targetX':map_height-1, 'targetY':map_width-1}
    return map_info


# 深さ優先探索でルートの数を調べる
def search_route_by_dfs(map = ""):
    map_info = get_map_info(map)
    map_passed = [[False for j in range(map_info['width'])] for i in range(map_info['height'])]

    return search_route_dfs_recursion(map_info['startX'], map_info['startY'], map_info, map_passed)


def search_route_dfs_recursion(x, y, map_info, map_passed):

    #down up left right の各種動きをリストで表現
    move_x = [1, -1, 0,  0]
    move_y = [0,  0, 1, -1]
    move_pattern = len(move_x)
    count = 0

    #ゴールに到達した場合
    if x == map_info['targetX'] and y == map_info['targetY']:
        # 全ての道を通過した判定をする場合はコメントを外す
        """
        map_passed[x][y] = True
        for i in range(map_info['width']):
            for j in range(map_info['height']):
                if not map_passed[i][j]:
                    return 0
        """
        return 1

    #範囲内、未踏、かつゴールに到達していない場合
    if (0 &lt;= x) and (x &lt; map_info['width']) and ( 0 &lt;= y) and (y &lt; map_info['height']) :
        passed = map_passed[x][y]
        if not passed:
            map_passed[x][y] = True
            for i in range(move_pattern):
                count += search_route_dfs_recursion(x+move_x[i], y+move_y[i], map_info, map_passed)
            map_passed[x][y] = False #走査が終わった道は初期化する
    
    return count


def search_route_by_bfs(map = ""):
    move_x = [1, -1, 0,  0]
    move_y = [0,  0, 1, -1]
    move_pattern = len(move_x)
    map_info = get_map_info(map)
    map_passed = [[-1 for j in range(map_info['width'])] for i in range(map_info['height'])]

    # Queueを利用していることを解りやすくするためにQueueモジュールを使ってますが、listのappend()とpop()で同じことできます。
    queue_x = Queue()
    queue_y = Queue()
    queue_x.put(map_info['startX'])
    queue_y.put(map_info['startY'])
    map_passed[map_info['startX']][map_info['startY']] = 0
    count = 0

    while not queue_x.empty():
        x = queue_x.get()
        y = queue_y.get()

        for i in range(move_pattern):
            nextX = x + move_x[i]
            nextY = y + move_y[i]

            #範囲内、未踏、かつゴールに到達していない場合
            if  (0 &lt;= nextX) and (nextX &lt; map_info['width']) and ( 0 &lt;= nextY) and (nextY &lt; map_info['height']) :
                passed = map_passed[nextX][nextY]
                if not( nextX == map_info['targetX'] and nextY == map_info['targetY'] ) and passed == -1:
                    map_passed[nextX][nextY] = map_passed[x][y] + 1
                    queue_x.put(nextX)
                    queue_y.put(nextY)
    
    for i in range(map_info['width']):
        for j in range(map_info['height']):
            count = max(map_passed[i][j], count)

    return count


def main():
    print("start BFS and DFS sample")

    map = [
            "...",
            "...",
            "..."
        ]

    pattern = search_route_by_dfs(map)
    print(u'ゴールまでのルートの数 : '+ str(pattern) )

    pattern = search_route_by_bfs(map)
    print(u'最短歩数 : ' + str(pattern) )

if __name__ == "__main__":
    main()

</pre>


<p>幅優先探索のほうは、本で見たサンプルまんま・・・って感じですが・・・。 もうちょっと柔軟に、様々な問題をグラフ化して、どちらの検索方法でも さらっと実装したかったです・・・。</p>

<p>問題解決を重ねるしかないですね・・・。</p>

<p>ちなみにc++でもQueueも再帰共に、上記の例であればpythonと同様に利用できるので 同じような流れで実装可能です。</p>

<p>推奨されるかは別として、グローバル変数を利用すれば、更にシンプルに 書くこともできます。</p>

<p>これは数こなすしかないな・・・というのが、とりあえず実装して一番感じたことです。</p>

<p>そしてもうひとつ感じたことは、問題をグラフ化する、ということが、まず問題解決の 第一関門、実装はその次、ということです。</p>

<p>この記事の目的としては、このコードに関して 検索している順番には着目してほしいですが、決して良いコードではありません。</p>

<h3>●余談ですが</h3>

<h4>検索と探索の違い</h4>

<blockquote><p>検索とは、資料や文献の中から目的の情報を探し出すこと。 検索と探索の違いは、検索は目的の情報を探し出す基準が決まっているのに対して、 探索は有効な基準（解析的な解法）がない、あるいは用いないときに、 実際に試行錯誤することによって解を探す方法を取る事。</p></blockquote>

<p>だそうです。<a href="https://ittechinf.wiki.zoho.com/%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0.html">引用元</a></p>

<h4>numpy,scipy,matplotlibを導入しました。</h4>

<p>グラフ理論をプログラミングの観点から勉強したくて、この記事を書いてる途中 pythonの上記moduleを導入してみました。</p>

<p>以前参加した<a href="http://www.zusaar.com/event/383008">プログラミングで数学を楽しむ会(2)</a>の内容 を少しづつ思い出してきました。参加した当時は、ちんぷんかんぷんでしたが、重要性と汎用性を 少しだけ理解することができたかもしれません。</p>

<p>上記モジュールを利用したサンプルなど、機会があればブログ書きたいと思います。</p>

<h3>参考・引用リンク</h3>

<ul>
<li><a href="http://ja.wikipedia.org/wiki/%E3%82%B0%E3%83%A9%E3%83%95%E7%90%86%E8%AB%96">グラフ理論 -wikipedia-</a></li>
<li><a href="http://ja.wikipedia.org/wiki/%E5%B9%85%E5%84%AA%E5%85%88%E6%8E%A2%E7%B4%A2">幅優先探索 -wikipedia-</a></li>
<li><a href="http://ja.wikipedia.org/wiki/%E6%B7%B1%E3%81%95%E5%84%AA%E5%85%88%E6%8E%A2%E7%B4%A2">深さ優先探索 -wikipedia-</a></li>
<li><a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=3&amp;cad=rja&amp;ved=0CEAQFjAC&amp;url=http%3A%2F%2Fchaosweb.complex.eng.hokudai.ac.jp%2F~j_inoue%2Fgraph2007%2FGRAPH2007.pdf&amp;ei=aaD8UdOEGYnwkAW4nIE4&amp;usg=AFQjCNHWfRVvBd3PnP5oWjaVFXU-mcSbQQ&amp;sig2=oiMDlh1FQOkPSXeTE3PkoA">グラフ理論 講義ノート &ndash; 混沌系工学研究室 &ndash; 北海道大学</a></li>
<li><a href="http://javaprograming.blog43.fc2.com/blog-category-8.html">グラフ　幅優先探索</a></li>
<li><a href="http://d.hatena.ne.jp/minorio/touch/searchdiary?word=*%5B%A5%B0%A5%E9%A5%D5%CD%FD%CF%C0%5D">タスクツリーの問題はどう解けばいいのか？</a></li>
<li><a href="http://www.slideshare.net/teruok/2-13550752">2章グラフ理論スピード入門</a></li>
<li><a href="http://d.hatena.ne.jp/lettas0726/20110418/1303097692">深さ優先探索と幅優先探索の簡単な実装方法</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2013/08/01/wordpress59/">[Ruby]ruby Warriorというゲームをクリアしました。</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2013-08-01T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Rubyで、キャラクターを動かして、ダンジョンを進めていく、『Ruby warrior』というWebアプリで遊んでみました。</p>

<p><a href="https://www.bloc.io/ruby-warrior/#/">Ruby warrior</a></p>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/Screen-Shot-2013-08-01-at-18.36.42.png" rel="image_group"><img src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/Screen-Shot-2013-08-01-at-18.36.42.png?resize=955%2C558" alt="Screen Shot 2013-08-01 at 18.36.42" class="alignnone size-large wp-image-760" data-recalc-dims="1" /></a></p>

<p>アルゴリズムの勉強、というよりは、Rubyそのものの基本構文の勉強に良いかな、と思ってます。</p>

<p>制御構文は基本的なものは大体が必要になるので。</p>

<p>レベルが進むごとに、難易度が上がっていきます。レベル１はまっすぐ進み続けるだけ。レベルは９まであります。</p>

<p><a href="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/Screen-Shot-2013-08-01-at-18.41.20.png" rel="image_group"><img src="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/08/Screen-Shot-2013-08-01-at-18.41.20.png?resize=955%2C319" alt="Screen Shot 2013-08-01 at 18.41.20" class="alignnone size-large wp-image-761" data-recalc-dims="1" /></a></p>

<p>画像はレベル１のスクリーンショットです。</p>

<p>レベルにもよりますが、主人公は</p>

<ul>
<li>周りを見る</li>
<li>歩く</li>
<li>攻撃する</li>
<li>回復する</li>
<li>捕虜を助ける</li>
</ul>


<p>の5種類の行動が取れて、周りを見る、以外は、１ターンに１つの行動しかできません。ダンジョンの状況によって、行動を切り替えていくプログラムを書くことで、それぞれのダンジョンをクリアしていきます。</p>

<p>道は全て一本道で、モンスターの種類が変わっていきます。</p>

<p>ちなみにRuby warriorのソースコードは全てGithubに公開されているので、自分のネットワーク環境で動作させることもできるみたいです。（GithubのREADME.mdに手順がありますが、僕は実行していません。）</p>

<p><a href="https://github.com/ryanb/ruby-warrior">Ruby warrior -Github-</a></p>

<p>僕が書いたプログラムはGistに挙げておきましたが、基本的にゴリ押しです。ダメージ食らったら回復して、それ以外は可能な限り攻撃。<a href="https://gist.github.com/KentaKomai">Kenta Komai -Gist-</a></p>

<p>歩いたことがある経路を記憶しておこうと思って、＠map変数を用意したんですが、使いませんでした。ブラッシュアップして、もっとスマートにと思います。</p>

<p>消化ターン数のランキングとかあったら、もっと良かったなぁ、と思いましたが、Gistを検索すると、様々な方のコードを見ることができるので、勉強になると思います。（※ちなみにゲーム内にランダム要素はありません。同じアルゴリズムでは、必ず同じ動作・結果になります。）</p>

<p>僕がクリアできたくらいなので、プログラミング初心者・Ruby初心者でも解ける問題だと思います。 お時間あれば、是非挑戦してみてください。面白かったです。</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/3/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/12/08/octopressniyi-xing-sitemimasita/">Octopressに移行してみました</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/28/wordpress77/">簡易プロセス死活監視プログラムをc#で</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/25/wordpress76/">xv6のソースコードとテキストを読んでみる1_chapter0_2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/19/wordpress75/">[CSCamp CTF]解けなかった問題forensics1のwriteupを読んでみた</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/18/wordpress74/">Vagrant + Chef solo + Berkshelfを試してみたのでまとめ</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/KentaKomai">@KentaKomai</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'KentaKomai',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 -  Kenta Komai <br/>
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> + <a href="https://github.com/ioveracker/mnml">mnml</a>.
	  
  </span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
