
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>CodeGate2012 Forensics 100 解いてみる - KentaKomai's BLOG</title>
  <meta name="author" content="Kenta Komai">

  
  <meta name="description" content="もうすぐCodeGate2013開催ということで全体的に予習してみようと思います。 解いていった順番にブログに手順を書いていこうと思います。 ※注意 ・他の方のwriteupを参考に解いています。（許可とってないのでリンクは貼りませんが、 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://KentaKomai.github.io/blog/2013/02/13/wordpress2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="KentaKomai's BLOG" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46297904-1', 'tamago-mago-mago.com');
  ga('send', 'pageview');

  </script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner">
	<div class="header-title"><a href="/">KentaKomai's BLOG</a></div>


	<br><div class="header-subtitle">自分用備忘録の延長</div>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:KentaKomai.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
  
    
      <h1 class="entry-title">CodeGate2012 Forensics 100 解いてみる</h1>
    
  
    
      <p class="meta">
        








  


<time datetime="2013-02-13T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>もうすぐCodeGate2013開催ということで全体的に予習してみようと思います。</p>

<p>解いていった順番にブログに手順を書いていこうと思います。</p>

<p>※注意</p>

<p>・他の方のwriteupを参考に解いています。（許可とってないのでリンクは貼りませんが、ぐぐってすぐ出てくる海外の方のブログを色々参考にさせていただいています。）</p>

<p>・できれば全問触りたいのでwriteupを見ることを前提で解き初めてます。</p>

<p>まずは問題文</p>

<blockquote><p> In order to steal financial information of Company X, IU got a job under cover. She decided to attack CFO’s computer, and then insert malicious code to his computer in the way of social engineering. She figured out that he didn’t use to turn off his computer, when he gets off work. After he leaves the office, she obtains financial data from his computer to search EXCEL file. By checking installed application program, she can find the information in the file. She lacks the file externally. In order to remove all traces, she erases malicious code, event logs and recent file list.</p>

<p>The company X has to figure out what information she stole correctly to make an appropriate measure. These are files attacked from CFO’s computer. Find the full path and size of the file which she stole. On the day, CFO left the office at 14:00. The time is based on Korea Standard Time(UTC +09:00).<br/>
Answer: strupr(md5(full_path|file_size)) (‘|’ is just a character)</p></blockquote>

<p>簡単に訳（クソすぎる翻訳ですが許してください・・・・）</p>

<blockquote><p>IUはX社の財務情報を盗むために密かに仕事をしていました。彼女はX社のCFOのPCに攻撃することを決め、彼のPCにソーシャルエンジニアリングによって悪意のあるコードをインストールしました。CFOは職場から出るときにPCの電源をOFFにしていませんでした。彼がオフィスから出た後、財務情報のExcelファイルを取得します。インストールされたアプリをチェックし、情報を探すことができます。　全ての痕跡を消すために、彼女はコード、イベントログ、そして最近のファイルのリストを削除します。X社は彼女がどんな情報を盗んだのかを知らなければなりません。これらはCFOのコンピュータから攻撃されたファイルです。彼女が盗んだファイルのサイズとフルパスを見つけてください。その日、CFOは14:00に会社を出ました。時間は韓国標準時間に基づいています(UTC +09:00)　答えはstrupr(md5(対象ファイルのフルパス|ファイルサイズ))です</p>

<p><!--more--></p></blockquote>

<p>まずは対象ファイルをダウンロードします。</p>

<p>恒例のfileコマンド</p>

<p><a href="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/02/Screen-Shot-2013-02-13-at-8.27.11.png" rel="image_group"><img class="alignnone size-large wp-image-25" alt="Screen Shot 2013-02-13 at 8.27.11" src="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/02/Screen-Shot-2013-02-13-at-8.27.11.png?resize=625%2C31" data-recalc-dims="1" /></a></p>

<p>7zipで圧縮されたアーカイブですね。</p>

<p>解凍するとWindowsのファイルシステムがずらり・・・・相当なファイル数だこれ・・・orz</p>

<p>最初に見せてもらったwriteupでは上記の問題文が書いてなくて、最初このファイル郡からどうやって答えにたどり着いたんだ・・・と悩みましたが、問題文を見つけて読んでみたら納得ｗ</p>

<p>解凍したフォルダの中に&#8221;FindTheKey*****&#8221;と書かれたpdbファイルとappxファイルがあり、最初は「これヒントかも」なんてバイナリみたり、拡張子でぐぐったりしたけど、多分これは時間稼ぎだったかも・・・特に有力な情報はナシ。</p>

<p>ちなみにpdbファイルは開発時のデバッグ関連のファイル、appxはwindows app storeの配布形式の拡張子みたいですね。全く関係ないファイルなのかと言われればわかりませんが、解凍したファイル郡と問題文を見る限り、windows上のホームディレクトリが含まれているだけなので、ノータッチでオッケーだと思われます。（※他の方のwriteupでも、このファイルに関しては言及ナシ）</p>

<p>Usersフォルダの中にはAll Userや、Publicと、定番のフォルダのなかにproneerがありますね。</p>

<p>おそらくこれがCFOさんのホームディレクトリなのかな？？この中に盗まれちゃった対象ファイルがあるんじゃないでしょうか？？</p>

<p><a href="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/02/Screen-Shot-2013-02-13-at-13.44.27.png" rel="image_group"><img class="alignnone size-large wp-image-27" alt="Screen Shot 2013-02-13 at 13.44.27" src="http://i2.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/02/Screen-Shot-2013-02-13-at-13.44.27.png?resize=625%2C666" data-recalc-dims="1" /></a></p>

<p>ただ、莫大なファイル量なので、もちろんひとつひとつチェックしていくわけにはいきません。</p>

<p>手がかりは2つですね。１つは対象はExcelファイルであるということ、２つ目はCFOが14:00に会社を出たということ。（これ以降にハッカーの彼女がファイルを盗んだ、と思われる）</p>

<p>この手がかりを元に対象ファイルをすぱっと見つけたいところなんですが</p>

<ol>
<li>.xls(Excelの拡張子)を対象に検索しても対象ファイルなし</li>
<li>更新時間を対象に検索すると、ほとんど全てのファイルが該当する</li>
</ol>


<p>これは困りました・・・。ここでwriteupをカンニング・・・。</p>

<p>一時ファイルを見に行くんですね。具体的には\Users\proneer\AppData\Roaming\Microsoft\Office\Recent\ディレクトリ内</p>

<p>&nbsp;</p>

<p>AppData/Roamingフォルダとは<a href="http://oshiete.goo.ne.jp/qa/6535208.html">http://oshiete.goo.ne.jp/qa/6535208.html</a>を見るとわかるように、バックアップ対象のファイルをアプリケーションが格納しておくファイルみたいですね。</p>

<p>なるほど・・・・。</p>

<p>ここにある、そのまんまヤバそうなファイル[Top-Secret]_2011_Financial_deals.lnkがお目当てのファイルのショートカットになってるみたいです。リンクファイルだから当然.xlsとかで検索しても出てこないですね。</p>

<p>しかしクリックしてもエラーで開けません。当然ですショートカットであって、本体ではないのです。このファイルのプロパティを見れば、対象ファイルへのフルパスはわかります。</p>

<p>C:\INSIGHT\Accounting\Confidential[Top-Secret]_2011_Financial_deals.xlsx</p>

<p>ですね。ただ解答に必要なのはフルパスとファイルサイズ。ファイルサイズはどこで・・・。</p>

<p>これは何かしら、forensicsツールで確認ができるらしいのですが、writeupで紹介されていたのが</p>

<p><a href="http://www.tzworks.net/prototype_page.php?proto_id=11">http://www.tzworks.net/prototype_page.php?proto_id=11</a>でした。用途はショートカットファイルの解析に限定されますが、非常に見やすいです。他のwriteupで紹介されていた010Editorというのもbinaryのテンプレートが豊富で見やすかったです。（こちらは有料で一ヶ月無料体験版アリ）</p>

<p><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/02/Screen-Shot-2013-02-13-at-11.13.06.png" rel="image_group"><img class="alignnone size-large wp-image-26" alt="Screen Shot 2013-02-13 at 11.13.06" src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/02/Screen-Shot-2013-02-13-at-11.13.06.png?resize=625%2C690" data-recalc-dims="1" /></a></p>

<p><a href="http://www.sweetscape.com/010editor/">Sweet Scape 010 Editor</a></p>

<p><a href="http://www.sweetscape.com/010editor/templates/">010 Editor Binary Template</a></p>

<p>▼Sweet Scape 010 Editor + LNK Templateでbinaryを見た様子</p>

<p><a href="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/02/Screen-Shot-2013-02-13-at-13.46.56.png" rel="image_group"><img class="alignnone size-large wp-image-28" alt="Screen Shot 2013-02-13 at 13.46.56" src="http://i1.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/02/Screen-Shot-2013-02-13-at-13.46.56.png?resize=625%2C593" data-recalc-dims="1" /></a></p>

<p>このツールを使って対象ショートカットファイルを開くと情報が出てきます。ファイルサイズは9296byteですね。</p>

<p>一般的に使われているツールでも後ほど解析してみます。</p>

<p>これで準備OKですね。最後にこの２つをmd5でハッシュ化すれば答えみたです！</p>

<p>コードはGithubにあげておきます。writeupがPHPだったのでPythonで書いてみました。　　　<a href="https://github.com/KentaKomai/CodeGate2012/blob/master/codegate2012_forensics100.py">Github forensics 100</a><a href="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/02/Screen-Shot-2013-02-13-at-14.29.12.png" rel="image_group"><img class="alignnone size-large wp-image-33" alt="Screen Shot 2013-02-13 at 14.29.12" src="http://i0.wp.com/tamago.servehttp.com/blog/wp-content/uploads/2013/02/Screen-Shot-2013-02-13-at-14.29.12.png?resize=625%2C37" data-recalc-dims="1" /></a></p>

<p>答え：d3403b2653dbc16bbe1cfce53a417ab1</p>

<p>問題文には大文字で(strcpy(***))と書かれていましたが、なぜか小文字で正解だそうです・・・むむむ・・・</p>

<p>ポイントとしては以下の点を感じました</p>

<ol>
<li>いかに早く一時フォルダの存在に気づき、対象のショートカットファイルを発見できるか（いつまでもExcelのファイルを探さない。更新時間に囚われない）</li>
<li>ショートカットファイルのファイルフォーマットを知っている or 解析手段を用意できるか</li>
</ol>


<p>ですね。この２点が素早くできればすぐに解ける問題だったと思います。</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">k.komai</span></span>

      








  


<time datetime="2013-02-13T00:00:00+09:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/wei-fen-lei/'>未分類</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://KentaKomai.github.io/blog/2013/02/13/wordpress2/" data-via="TAMAGO_MAGO_2" data-counturl="http://KentaKomai.github.io/blog/2013/02/13/wordpress2/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/02/04/wordpress1/" title="Previous Post: 自分専用のサイトとブログ開設しました。">&laquo; 自分専用のサイトとブログ開設しました。</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/02/14/wordpress3/" title="Next Post: CodeGate2012 Forensics 200を解いてみる">CodeGate2012 Forensics 200を解いてみる &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/12/08/octopressniyi-xing-sitemimasita/">Octopressに移行してみました</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/28/wordpress77/">簡易プロセス死活監視プログラムをc#で</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/25/wordpress76/">xv6のソースコードとテキストを読んでみる1_chapter0_2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/19/wordpress75/">[CSCamp CTF]解けなかった問題forensics1のwriteupを読んでみた</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/18/wordpress74/">Vagrant + Chef solo + Berkshelfを試してみたのでまとめ</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 -  Kenta Komai <br/>
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> + <a href="https://github.com/ioveracker/mnml">mnml</a>.
	  
  </span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
