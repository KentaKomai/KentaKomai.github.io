
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>xv6のソースコードとテキストを読んでみる1_chapter0_1 - KentaKomai's BLOG</title>
  <meta name="author" content="Kenta Komai">

  
  <meta name="description" content="前回に書いたとおり、 Unix v6の移植版xv6のソースコードと、テキストを読んでいこうと思います。 本当はchapterごとに１記事書いていこうと思ってたんですが、 思っていた以上に僕の英語力がダメで翻訳にものすごい時間かかってしまっているので、 chapter内でもキリのいいところで、 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://KentaKomai.github.io/blog/2013/11/10/wordpress73">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="KentaKomai's BLOG" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46297904-1', 'tamago-mago-mago.com');
  ga('send', 'pageview');

  </script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46297904-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner">
	<div class="header-title"><a href="/">KentaKomai's BLOG</a></div>


	<br><div class="header-subtitle">自分用備忘録の延長</div>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss email">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
    <li><a href="kaede06152000@gmail.com" rel="subscribe-email" title="subscribe via email">Email</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:KentaKomai.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
  
    
      <h1 class="entry-title">Xv6のソースコードとテキストを読んでみる1_chapter0_1</h1>
    
  
    
      <p class="meta">
        








  


<time datetime="2013-11-10T00:00:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p><a href="http://komaken.me/blog/2013/10/28/xv6%E3%81%AE%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E3%81%A8%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%82%92%E8%AA%AD%E3%82%93%E3%81%A7%E3%81%BF%E3%82%8B-0/">前回</a>に書いたとおり、 Unix v6の移植版xv6のソースコードと、テキストを読んでいこうと思います。</p>

<p>本当はchapterごとに１記事書いていこうと思ってたんですが、 思っていた以上に僕の英語力がダメで翻訳にものすごい時間かかってしまっているので、 chapter内でもキリのいいところで、紹介していこうと思います。</p>

<p>翻訳ははっきりいってかなりお粗末なもので、 僕が独自に解釈したものが多く含まれています。</p>

<p>間違った内容が載っている可能性もあります。ご注意ください。 (※お気づきの方いらっしゃいましたら、教えてくれるととてもありがたいです。)</p>

<p>概要が伝わること、少しでも興味を持つきっかけなんかになれば とても嬉しく思います。</p>

<h2>Chapter 0</h2>

<h3>OSのインターフェース</h3>

<p>OSの仕事は複数のプログラムや複数のサービスを提供し、 低レイヤーのハードウェアの動作を管理して、抽象化します。</p>

<p>またOSはインターフェースを通してユーザが作成したプログラムに OSのサービスを提供します。より良いインターフェースをデザインすることは 難しいことです。私達プログラマは実装を正しく簡単に行うために、 シンプルで簡単なインターフェースを望むこともあれば、 アプリケーションに多くの機能を盛り込みたい場合、複雑で詳細に設定したり命令可能な インターフェースを望むこともあります。この２つの言い分をバランス良く解決する 方法として、多くの一般的な機能を抽出して、それらを結合することもできる、 いくつかのメカニズムに依存するインターフェースをデザインする必要があります。</p>

<p>(中略)</p>

<p>実行されているプログラムはプロセスと呼ばれ、テキスト、データ、 そしてスタックをメモリ上に保持しています。 テキストはプログラムの命令が、データには演算に利用される 変数など、そしてスタックはプログラムのプロシージャが含まれています。 (ここはかなり僕の解釈で原文ままではない、と思います。)</p>

<p>プロセスがカーネルが提供するサービスを利用するときは、OSのインターフェース 経由で呼び出します。そのような命令をシステムコールと呼びます。システムコールは カーネルの内部に入り込み、サービスを実行し結果を返します。このように ユーザプログラムがシステムコールを利用するとき、 プロセスはユーザスペースとカーネルスペースの間を行き来します。</p>

<p>カーネルは、それぞれのプロセスが自身のユーザスペースで実行されることを確実にするために、 CPUのプロテクション機構を利用し、保護を実現するために必要な権限で実行されます。 ユーザプログラムにこの権現はありません。ユーザプログラムがシステムコールを呼び出すときは ハードウェアで権限を上げ、カーネルで準備された機能を実行します。</p>

<p>xv6カーネルが提供するシステムコールは以下の通りです。</p>

<pre>fork()  プロセスを作成する
exit()  現在のプロセスを終了する
wait()  子プロセスが終了するのを待つ
kell(pid)   pidのプロセスを終了する
getpid()    現在実行中のプロセスを返す
sleep(n)    n秒プロセスをスリープする
exec(filename, *argv)   ファイルを読み込み実行する
sbrk(n) プロセスのメモリをn byte拡張する
open(filename, flags)   ファイルを開く。フラグは read / write
read(fd, buf, n)    ファイルを n byte読み込む
write(fd, but, n)   ファイルに n byte書き込む
close(fd)   開いたファイルを閉じる
dup(fd) ファイルコピー
pipe(p) 
chdir(dirname)  カレントディレクトリの変更
mkdir(dirname)  ディレクトリを新規作成する
mknod(name, major, minor)   デバイスファイルを新規作成する
fstat(fd)   ファイルの詳細を返す
link(f1, f2)    f1のリンクをf2に作成する
unlink(filename)    ファイルを削除する
</pre>


<p>シェルはユーザが入力したコマンドを読み込み、実行する通常の ユーザプログラムであり、カーネルの一部ではありません。これはシステムコールの インターフェースのおかげで、シェルは内部的にシステムコールを利用しているだけです。</p>

<p>そのためUnixではシェルをsh,bash,zshなど、それぞれユーザが 好きなものに変更することが可能になっています。</p>

<h3>原文</h3>

<p>後ほど復習と確認のため、今回書いた場所の原文も中略した部分を含めて載せておきます。(図やイメージなどは省略してます。)</p>

<p><a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;ved=0CCoQFjAA&amp;url=http%3A%2F%2Fwww.cs.columbia.edu%2F~junfeng%2F11sp-w4118%2Flectures%2Funix.pdf&amp;ei=nGt-UorzKI2jkgW8kIDQAw&amp;usg=AFQjCNFvDyV-VUcoFSYuBed2Vu090cvxkw&amp;sig2=4hqRhlAF7nIFcZ4PdU1CfA&amp;bvm=bv.56146854,d.dGI">オリジナル</a></p>

<p>The job of an operating system is to share a computer among multiple programs and to provide a more useful set of services than the hardware alone supports. The operating system manages and abstracts the low-level hardware, so that, for example, a word processor need not concern itself with which type of disk hardware is being used. It also multiplexes the hardware, allowing many programs to share the computer and run (or appear to run) at the same time. Finally, operating systems provide con- trolled ways for programs to interact, so that they can share data or work together.</p>

<p>An operating system provides services to user programs through an interface. Designing a good interface turns out to be difficult. On the one hand, we would like the interface to be simple and narrow because that makes it easier to get the imple- mentation right. On the other hand, we may be tempted to offer many sophisticated features to applications. The trick in resolving this tension is to design interfaces that rely on a few mechanisms that can be combined to provide much generality.</p>

<p>This book uses a single operating system as a concrete example to illustrate oper- ating system concepts. That operating system, xv6, provides the basic interfaces intro- duced by Ken Thompson and Dennis Ritchie’s Unix operating system, as well as mim- icking Unix’s internal design. Unix provides a narrow interface whose mechanisms combine well, offering a surprising degree of generality. This interface has been so successful that modern operating systems—BSD, Linux, Mac OS X, Solaris, and even, to a lesser extent, Microsoft Windows—have Unix-like interfaces. Understanding xv6 is a good start toward understanding any of these systems and many others.</p>

<p>As shown in Figure 0-1, xv6 takes the traditional form of a kernel, a special pro- gram that provides services to running programs. Each running program, called a process, has memory containing instructions, data, and a stack. The instructions im- plement the program’s computation. The data are the variables on which the computa- tion acts. The stack organizes the program’s procedure calls.</p>

<p>When a process needs to invoke a kernel service, it invokes a procedure call in the operating system interface. Such procedures are call system calls. The system call enters the kernel; the kernel performs the service and returns. Thus a process al- ternates between executing in user space and kernel space.</p>

<p>The kernel uses the CPU’s hardware protection mechanisms to ensure that each process executing in user space can access only its own memory. The kernel executes with the hardware privileges required to implement these protections; user programs execute without those privileges. When a user program invokes a system call, the hardware raises the privilege level and starts executing a pre-arranged function in the kernel. The collection of system calls that a kernel provides is the interface that user pro- grams see. The xv6 kernel provides a subset of the services and system calls that Unix kernels traditionally offer. The calls are:</p>

<p>he rest of this chapter outlines xv6’s services—processes, memory, file descrip- tors, pipes, and file system—and illustrates them with code snippets and discussions of how the shell uses them. The shell’s use of system calls illustrates how carefully they have been designed. The shell is an ordinary program that reads commands from the user and exe- cutes them, and is the primary user interface to traditional Unix-like systems. The fact that the shell is a user program, not part of the kernel, illustrates the power of the sys- tem call interface: there is nothing special about the shell. It also means that the shell is easy to replace; as a result, modern Unix systems have a variety of shells to choose from, each with its own user interface and scripting features. The xv6 shell is a simple implementation of the essence of the Unix Bourne shell. Its implementation can be found at line (7850).</p>

<h2>感想</h2>

<p>この辺の導入部分は、ひとまず知識としては既に知っていることも多く、内容の理解よりも 翻訳に時間がかかりました。</p>

<p>今回はソースコードを読む箇所はゼロ。</p>

<p>そしてシステムコールの数すくない！ここには載せていませんが、ソースコードも9000行未満です。 頑張って最後まで読みたいなぁ。</p>

<p>結構書き溜めているので、できればサクサク次の記事アップロードしたいです。</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">k.komai</span></span>

      








  


<time datetime="2013-11-10T00:00:00+09:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/wei-fen-lei/'>未分類</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://KentaKomai.github.io/blog/2013/11/10/wordpress73/" data-via="TAMAGO_MAGO_2" data-counturl="http://KentaKomai.github.io/blog/2013/11/10/wordpress73/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/11/10/wordpress72/" title="Previous Post: シェルでコマンド実行するときに使う記号の用法まとめ">&laquo; シェルでコマンド実行するときに使う記号の用法まとめ</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/11/18/wordpress74/" title="Next Post: Vagrant + Chef solo + Berkshelfを試してみたのでまとめ">Vagrant + Chef solo + Berkshelfを試してみたのでまとめ &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/12/08/octopressniyi-xing-sitemimasita/">Octopressに移行してみました</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/28/wordpress77/">簡易プロセス死活監視プログラムをc#で</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/25/wordpress76/">xv6のソースコードとテキストを読んでみる1_chapter0_2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/19/wordpress75/">[CSCamp CTF]解けなかった問題forensics1のwriteupを読んでみた</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/18/wordpress74/">Vagrant + Chef solo + Berkshelfを試してみたのでまとめ</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/KentaKomai">@KentaKomai</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'KentaKomai',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 -  Kenta Komai <br/>
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> + <a href="https://github.com/ioveracker/mnml">mnml</a>.
	  
  </span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
